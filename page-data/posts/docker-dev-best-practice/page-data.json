{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/docker-dev-best-practice/","webpackCompilationHash":"539c93736a11b6b79b58","result":{"data":{"site":{"siteMetadata":{"author":{"name":"Joey Xie","contacts":{"twitter":"xf_joey"}},"disqusShortname":"joeyxf-com","subtitle":"每天进步一点点","title":"Joey的博客","url":"https://joeyxf.com"}},"markdownRemark":{"id":"eb8b6fc6-4528-5727-a7e6-e84395978248","html":"<h1 id=\"docker开发最佳实践\"><a href=\"#docker%E5%BC%80%E5%8F%91%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5\" aria-label=\"docker开发最佳实践 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker开发最佳实践</h1>\n<p>docker 的使用方式有很多，很多发行版都带了 docker 软件包，比如说在 archlinux 上就可以执行</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">sudo</span> pacman -S docker</code></pre></div>\n<p>按照 wiki 上的说法配置好环境然后就能执行命令了，但是这种方法不通用，比如说换了机器或者是本地配置有差，都可能需要重新弄一次，所以有人就出了一个<code class=\"language-text\">docker-machine</code></p>\n<p><code class=\"language-text\">docker-machine</code>的原理是让 docker 跑在本地的虚拟机里面，比如说本地开一个 virtualbox 虚拟机，然后在虚拟机里面操作 docker，这种方式不污染本地环境</p>\n<p>使用很简单，按照官方的教程一步一步来：</p>\n<ol>\n<li><code class=\"language-text\">docker-machine create --driver virtualbox default</code> 创建一台用来操作 docker 的机器</li>\n<li><code class=\"language-text\">docker-machine ls</code> 列出当前电脑上装的所有 docker 宿主机，理论上来说远程的宿主机也能列出来</li>\n<li><code class=\"language-text\">docker-machine start name</code> 开启一台宿主机，然后在宿主机里面跑docker，随意安装镜像，环境玩坏了不想要了直接删除这台机器再建一个新的就好，不用担心本机被玩坏</li>\n<li><code class=\"language-text\">eval (docker-machine env default)</code> 进入default宿主机内，这样就能在宿主机上执行docker命令了</li>\n</ol>\n<h2 id=\"安装-confluent-platform\"><a href=\"#%E5%AE%89%E8%A3%85-confluent-platform\" aria-label=\"安装 confluent platform permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>安装 confluent platform</h2>\n<h3 id=\"运行word-count的示例图\"><a href=\"#%E8%BF%90%E8%A1%8Cword-count%E7%9A%84%E7%A4%BA%E4%BE%8B%E5%9B%BE\" aria-label=\"运行word count的示例图 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>运行word count的示例图</h3>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/107de6264cb09469b0014cd53fbbe535/a987b/docker-with-kafka-streams.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 54.84375%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACDUlEQVQoz32SW3PSUBSF8+CTIjR3LjJDkUKgIATIDUgISKFMLcVWO6MO3sYfQABvlP++3CdBtA/68M3aZ+ecfVb2PtzP7R22ITuweL35imWwwrfvPw7c7Xb0fYvNZoP1eoPVao3lMqB4jWC1QkD7l0EQwg1vPsO//vSHlx/hzSP6TK8+wJ0t4F2+Q/9qQbn3ke7j7ou36BHt8SvcfqGC6WcexLIDvmyAr5hINXzIlItXOjjSHCRKNuJEotxBQqPciUlYB2LHrZAH6Rpaoxm4jP4car1PRXpQ6h7SxhiqPYVgTSBRLLZGSDdHkKsepFMXcqUHiZBZTIhsTfq4YOJyMQcnazZkcsJU2iMaIwjOeahicwC5OYRUcwk6TO5ZHJ2LUMh9PN+CNXkNLm+OodANKjlQQ3WRrPvkOkL5TWMA9YAf7k/WvIMeFW04F2+ooHUe9k2oOhBrHepnFwL1iieEkhPC/6UH9nsY7MzDvIH25BacPpij7E6RMhwouo20HjkQqj2Ip1S8wuhEsDW1Ryxa92BtiuV0GGc34J6aZ3hCQxE1C/yJQU6oh4RQZGszVFGLcv+CzSB23IRJT4erejNkdR/F7gRab4osTTpF7rLkMt8eUexCoML/LUjP7lGuGTn0JtfIN4YodAao+FNkzCkU+r0cTbdkj5GjyzI03STl+EKbihv3YH8lESp9Y4/9F+C8ZEr9szQyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"word count\"\n        title=\"\"\n        src=\"/static/107de6264cb09469b0014cd53fbbe535/f570d/docker-with-kafka-streams.png\"\n        srcset=\"/static/107de6264cb09469b0014cd53fbbe535/0783d/docker-with-kafka-streams.png 240w,\n/static/107de6264cb09469b0014cd53fbbe535/782f4/docker-with-kafka-streams.png 480w,\n/static/107de6264cb09469b0014cd53fbbe535/f570d/docker-with-kafka-streams.png 960w,\n/static/107de6264cb09469b0014cd53fbbe535/8d0ff/docker-with-kafka-streams.png 1440w,\n/static/107de6264cb09469b0014cd53fbbe535/a987b/docker-with-kafka-streams.png 1920w\"\n        sizes=\"(max-width: 960px) 100vw, 960px\"\n      />\n  </span>\n  </a></p>\n<p>截图中最上面一屏是 word count的process程序，第二屏运行的是kafka的消费程序，word count process程序把计算结果写入到输出流，被消费程序读出，第三屏展示的是一个命令行的生产者，把一个一个的单词输入到输入流中，每有一个输入就会被实时消费，这样第二屏中的输出就会立刻被更新。第四屏展示的是<code class=\"language-text\">docker-compose ps</code>的输出，显示当前运行的docker进程，因为使用的官方的配置文件，所以端口映射啥的都不用管，有一个需要注意的点，因为是多个容器组合运行，所以不建议采用手动指明host的方式来访问服务，比如说在<code class=\"language-text\">kafka-console-producer --broker-list localhost:9092 --topic streams-plaintext-input</code>这条命令中不要用<code class=\"language-text\">localhost:9092</code>来访问kafka，要使用<code class=\"language-text\">kafka-console-producer --broker-list broker:9092 --topic streams-plaintext-input</code>，同时运行这么多容器，根本不知道localhost是哪个容器的localhost</p>\n<p>从截图可以看出 kafka streams 用来做实时日志分析很有用</p>\n<h2 id=\"使用ksql\"><a href=\"#%E4%BD%BF%E7%94%A8ksql\" aria-label=\"使用ksql permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>使用ksql</h2>\n<h3 id=\"创建对应的kafka-topic\"><a href=\"#%E5%88%9B%E5%BB%BA%E5%AF%B9%E5%BA%94%E7%9A%84kafka-topic\" aria-label=\"创建对应的kafka topic permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>创建对应的kafka topic</h3>\n<p>创建名为users的topic</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker-compose <span class=\"token function\">exec</span> broker \\\n  kafka-topics --create --zookeeper zookeeper:2181 \\\n  --replication-factor 1 --partitions 1 --topic <span class=\"token function\">users</span></code></pre></div>\n<p>创建名为pageviews的topic</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker-compose <span class=\"token function\">exec</span> broker \\\n  kafka-topics --create --zookeeper zookeeper:2181   \\\n  --replication-factor 1 --partitions 1 --topic pageviews</code></pre></div>\n<p>列出当前kafka所有的topic</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker-compose <span class=\"token function\">exec</span> broker \\\n  kafka-topics --zookeeper zookeeper:2181 --list</code></pre></div>\n<h3 id=\"往上面创建的2个topic里面塞入数据\"><a href=\"#%E5%BE%80%E4%B8%8A%E9%9D%A2%E5%88%9B%E5%BB%BA%E7%9A%842%E4%B8%AAtopic%E9%87%8C%E9%9D%A2%E5%A1%9E%E5%85%A5%E6%95%B0%E6%8D%AE\" aria-label=\"往上面创建的2个topic里面塞入数据 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>往上面创建的2个topic里面塞入数据</h3>\n<p>待定，使用producer cli写入</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker-compose <span class=\"token function\">exec</span> ksql-datagen \\\n  ksql-datagen bootstrap-server<span class=\"token operator\">=</span>broker:9092 quickstart<span class=\"token operator\">=</span>pageviews format<span class=\"token operator\">=</span>delimited topic<span class=\"token operator\">=</span>pageviews maxInterval<span class=\"token operator\">=</span>100</code></pre></div>\n<h3 id=\"创建stream\"><a href=\"#%E5%88%9B%E5%BB%BAstream\" aria-label=\"创建stream permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>创建stream</h3>\n<p>开启ksql</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">docker-compose <span class=\"token function\">exec</span> ksql-cli ksql http://ksql-server:8088</code></pre></div>\n<p>在ksql-cli中执行</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">CREATE STREAM pageviews_original <span class=\"token punctuation\">(</span>viewtime bigint, userid varchar, pageid varchar<span class=\"token punctuation\">)</span> WITH \\\n<span class=\"token punctuation\">(</span>kafka_topic<span class=\"token operator\">=</span><span class=\"token string\">'pageviews'</span>, value_format<span class=\"token operator\">=</span><span class=\"token string\">'DELIMITED'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">CREATE TABLE users_original <span class=\"token punctuation\">(</span>registertime BIGINT, gender VARCHAR, regionid VARCHAR, userid VARCHAR<span class=\"token punctuation\">)</span> WITH \\\n<span class=\"token punctuation\">(</span>kafka_topic<span class=\"token operator\">=</span><span class=\"token string\">'users'</span>, value_format<span class=\"token operator\">=</span><span class=\"token string\">'JSON'</span>, key <span class=\"token operator\">=</span> <span class=\"token string\">'userid'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>查看ktable信息</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">describe users_original<span class=\"token punctuation\">;</span></code></pre></div>\n<p>查看当前的所有stream信息</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">show streams<span class=\"token punctuation\">;</span></code></pre></div>\n<p>查看当前所有table信息</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">show tables<span class=\"token punctuation\">;</span></code></pre></div>\n<h3 id=\"通过restapi接口查询stream\"><a href=\"#%E9%80%9A%E8%BF%87restapi%E6%8E%A5%E5%8F%A3%E6%9F%A5%E8%AF%A2stream\" aria-label=\"通过restapi接口查询stream permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>通过restapi接口查询stream</h3>\n<p>接口文档见<a href=\"https://docs.confluent.io/current/ksql/docs/api.html\">https://docs.confluent.io/current/ksql/docs/api.html</a></p>\n<p>如果别的语言要访问ksql目前看来只能自己实现一套restapi的封装了，遇到过提示stream/table找不到的，按照文档说明给加上bootstrap.servers就行了\n8088是ksql-server监听的端口，默认的broker监听的是9092端口</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">curl</span> -XPOST http://localhost:8088/query/ \\\n    -H <span class=\"token string\">'Accept: application/json'</span> \\\n    -H <span class=\"token string\">'Content-Type: application/json'</span> \\\n    -d <span class=\"token string\">'{\n        \"ksql\": \"SELECT * FROM users_original limit 10;\",\n        \"streamsProperties\": {\n            \"ksql.streams.auto.offset.reset\": \"earliest\"\n        }\n    }'</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">CREATE TABLE pageviews_regions WITH <span class=\"token punctuation\">(</span>value_format<span class=\"token operator\">=</span><span class=\"token string\">'avro'</span><span class=\"token punctuation\">)</span> AS SELECT gender, regionid , COUNT<span class=\"token punctuation\">(</span>*<span class=\"token punctuation\">)</span> AS numusers \\\nFROM pageviews_enriched WINDOW TUMBLING <span class=\"token punctuation\">(</span>size 30 second<span class=\"token punctuation\">)</span> GROUP BY gender, regionid HAVING COUNT<span class=\"token punctuation\">(</span>*<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> 1<span class=\"token punctuation\">;</span>\n\nCREATE STREAM pageviews_enriched AS SELECT users_original.userid AS userid, pageid, regionid, gender \\\nFROM pageviews_original LEFT JOIN users_original ON pageviews_original.userid <span class=\"token operator\">=</span> users_original.userid<span class=\"token punctuation\">;</span>\n\nCREATE STREAM pageviews_female AS SELECT * FROM pageviews_enriched WHERE gender <span class=\"token operator\">=</span> <span class=\"token string\">'FEMALE'</span><span class=\"token punctuation\">;</span>\n\nCREATE STREAM pageviews_female_like_89 WITH <span class=\"token punctuation\">(</span>kafka_topic<span class=\"token operator\">=</span><span class=\"token string\">'pageviews_enriched_r8_r9'</span>, \\\nvalue_format<span class=\"token operator\">=</span><span class=\"token string\">'DELIMITED'</span><span class=\"token punctuation\">)</span> AS SELECT * FROM pageviews_female WHERE regionid LIKE <span class=\"token string\">'%_8'</span> OR regionid LIKE <span class=\"token string\">'%_9'</span><span class=\"token punctuation\">;</span>\n\nSELECT gender, regionid, numusers FROM pageviews_regions LIMIT 5<span class=\"token punctuation\">;</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">CREATE TABLE ontime\n<span class=\"token punctuation\">(</span>\n    Year UInt16,\n    Quarter UInt8,\n    Month UInt8,\n    DayofMonth UInt8,\n    DayOfWeek UInt8,\n    FlightDate Date,\n    UniqueCarrier FixedString<span class=\"token punctuation\">(</span>7<span class=\"token punctuation\">)</span>,\n    AirlineID Int32,\n    Carrier FixedString<span class=\"token punctuation\">(</span>2<span class=\"token punctuation\">)</span>,\n    TailNum String,\n    FlightNum String,\n    OriginAirportID Int32,\n    OriginAirportSeqID Int32,\n    OriginCityMarketID Int32,\n    Origin FixedString<span class=\"token punctuation\">(</span>5<span class=\"token punctuation\">)</span>,\n    OriginCityName String,\n    OriginState FixedString<span class=\"token punctuation\">(</span>2<span class=\"token punctuation\">)</span>,\n    OriginStateFips String,\n    OriginStateName String,\n    OriginWac Int32,\n    DestAirportID Int32,\n    DestAirportSeqID Int32,\n    DestCityMarketID Int32,\n    Dest FixedString<span class=\"token punctuation\">(</span>5<span class=\"token punctuation\">)</span>,\n    DestCityName String,\n    DestState FixedString<span class=\"token punctuation\">(</span>2<span class=\"token punctuation\">)</span>,\n    DestStateFips String,\n    DestStateName String,\n    DestWac Int32,\n    CRSDepTime Int32,\n    DepTime Int32,\n    DepDelay Int32,\n    DepDelayMinutes Int32,\n    DepDel15 Int32,\n    DepartureDelayGroups String,\n    DepTimeBlk String,\n    TaxiOut Int32,\n    WheelsOff Int32,\n    WheelsOn Int32,\n    TaxiIn Int32,\n    CRSArrTime Int32,\n    ArrTime Int32,\n    ArrDelay Int32,\n    ArrDelayMinutes Int32,\n    ArrDel15 Int32,\n    ArrivalDelayGroups Int32,\n    ArrTimeBlk String,\n    Cancelled UInt8,\n    CancellationCode FixedString<span class=\"token punctuation\">(</span>1<span class=\"token punctuation\">)</span>,\n    Diverted UInt8,\n    CRSElapsedTime Int32,\n    ActualElapsedTime Int32,\n    AirTime Int32,\n    Flights Int32,\n    Distance Int32,\n    DistanceGroup UInt8,\n    CarrierDelay Int32,\n    WeatherDelay Int32,\n    NASDelay Int32,\n    SecurityDelay Int32,\n    LateAircraftDelay Int32,\n    FirstDepTime String,\n    TotalAddGTime String,\n    LongestAddGTime String,\n    DivAirportLandings String,\n    DivReachedDest String,\n    DivActualElapsedTime String,\n    DivArrDelay String,\n    DivDistance String,\n    Div1Airport String,\n    Div1AirportID Int32,\n    Div1AirportSeqID Int32,\n    Div1WheelsOn String,\n    Div1TotalGTime String,\n    Div1LongestGTime String,\n    Div1WheelsOff String,\n    Div1TailNum String,\n    Div2Airport String,\n    Div2AirportID Int32,\n    Div2AirportSeqID Int32,\n    Div2WheelsOn String,\n    Div2TotalGTime String,\n    Div2LongestGTime String,\n    Div2WheelsOff String,\n    Div2TailNum String,\n    Div3Airport String,\n    Div3AirportID Int32,\n    Div3AirportSeqID Int32,\n    Div3WheelsOn String,\n    Div3TotalGTime String,\n    Div3LongestGTime String,\n    Div3WheelsOff String,\n    Div3TailNum String,\n    Div4Airport String,\n    Div4AirportID Int32,\n    Div4AirportSeqID Int32,\n    Div4WheelsOn String,\n    Div4TotalGTime String,\n    Div4LongestGTime String,\n    Div4WheelsOff String,\n    Div4TailNum String,\n    Div5Airport String,\n    Div5AirportID Int32,\n    Div5AirportSeqID Int32,\n    Div5WheelsOn String,\n    Div5TotalGTime String,\n    Div5LongestGTime String,\n    Div5WheelsOff String,\n    Div5TailNum String\n<span class=\"token punctuation\">)</span>\nENGINE <span class=\"token operator\">=</span> MergeTree<span class=\"token punctuation\">(</span>FlightDate, <span class=\"token punctuation\">(</span>Year, FlightDate<span class=\"token punctuation\">)</span>, 8192<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">for</span> i <span class=\"token keyword\">in</span> *.zip<span class=\"token punctuation\">;</span> <span class=\"token keyword\">do</span> <span class=\"token keyword\">echo</span> <span class=\"token variable\">$i</span><span class=\"token punctuation\">;</span> <span class=\"token function\">unzip</span> -cq <span class=\"token variable\">$i</span> <span class=\"token string\">'*.csv'</span> <span class=\"token operator\">|</span> <span class=\"token function\">sed</span> <span class=\"token string\">'s/\\.00//g'</span> <span class=\"token operator\">|</span> clickhouse-client --host<span class=\"token operator\">=</span>example-perftest01j --query<span class=\"token operator\">=</span><span class=\"token string\">\"INSERT INTO ontime FORMAT CSVWithNames\"</span><span class=\"token punctuation\">;</span> <span class=\"token keyword\">done</span></code></pre></div>","fields":{"slug":"/posts/docker-dev-best-practice/","tagSlugs":["/tag/docker/","/tag/devops/"]},"frontmatter":{"date":"2018-07-19","description":"最近需要使用到confluent的kafka streams，由于他们是使用docker提供服务的，所以重新规划了一下本地的docker环境，和上游保持一致，避免环境不一致导致太大的差异","tags":["Docker","Devops"],"title":"docker开发最佳实践"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/posts/docker-dev-best-practice/"}}}