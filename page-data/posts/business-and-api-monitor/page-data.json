{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/business-and-api-monitor","result":{"data":{"site":{"siteMetadata":{"author":{"name":"Joey Xie","contacts":{"twitter":"xf_joey"}},"disqusShortname":"joeyxf-com","subtitle":"每天进步一点点","title":"Joey的博客","url":"https://joeyxf.com"}},"markdownRemark":{"id":"c97fb499-103c-5ddb-b9ee-1177fb480d19","html":"<p>本文将介绍使用vector + nginx + clickhouse + superset 来实现自己的统一监控系统</p>\n<h2 id=\"nginx\" style=\"position:relative;\"><a href=\"#nginx\" aria-label=\"nginx permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>nginx</h2>\n<p>nginx作为日志来源是非常重要的一个环节，为了方便解析，在保存日志的时候用json的形式保存，以下是一个典型的配置示例</p>\n<div class=\"gatsby-highlight\" data-language=\"nginx\"><pre class=\"language-nginx\"><code class=\"language-nginx\"><span class=\"token keyword\">log_format</span> json_combined escape<span class=\"token operator\">=</span>json <span class=\"token string\">'{\"localtime\":\"$time_iso8601\",'</span>\n\t<span class=\"token string\">'\"source\":\"$server_addr\",'</span>\n\t<span class=\"token string\">'\"remote_addr\":\"$remote_addr\",'</span>\n\t<span class=\"token string\">'\"request_time\":\"$request_time\",'</span>\n\t<span class=\"token string\">'\"status\":\"$status\",'</span>\n\t<span class=\"token string\">'\"host\":\"$host\",'</span>\n\t<span class=\"token string\">'\"uri\":\"$uri\",'</span>\n\t<span class=\"token string\">'\"server\":\"$server_name\",'</span>\n\t<span class=\"token string\">'\"protocol\":\"$server_protocol\",'</span>\n\t<span class=\"token string\">'\"request_uri\":\"$request_uri\",'</span>\n\t<span class=\"token string\">'\"args\":\"$args\",'</span>\n\t<span class=\"token string\">'\"request_method\":\"$request_method\",'</span>\n\t<span class=\"token string\">'\"http_referrer\":\"$http_referer\",'</span>\n\t<span class=\"token string\">'\"http_x_forwarded_for\":\"$http_x_forwarded_for\",'</span>\n\t<span class=\"token string\">'\"http_user_agent\":\"$http_user_agent\"}'</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">server</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">server_name</span> log<span class=\"token punctuation\">.</span>example<span class=\"token punctuation\">.</span>com<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">access_log</span> <span class=\"token operator\">/</span>var<span class=\"token operator\">/</span>log<span class=\"token operator\">/</span>nginx<span class=\"token operator\">/</span>example<span class=\"token punctuation\">.</span>access<span class=\"token punctuation\">.</span>log json_combined<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">location</span> <span class=\"token operator\">/</span>a<span class=\"token punctuation\">.</span>gif <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">empty_gif</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n\t<span class=\"token keyword\">root</span> <span class=\"token operator\">/</span>srv<span class=\"token operator\">/</span><span class=\"token keyword\">http</span><span class=\"token operator\">/</span>example<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">index</span> <span class=\"token keyword\">index</span><span class=\"token punctuation\">.</span>html<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>在这里自定义了日志格式，并且指明了access<em>log使用这种日志格式保存，具体的日志配置可以见\n<a href=\"http://nginx.org/en/docs/http/ngx_http_log_module.html#example\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">nginx log config</a>\n有个有意思的点，在配置一像素gif图的时候可以用 <em>empty</em>gif</em> ，这样访问的时候是内存操作而不需要去硬盘读取文件，这种方式实现的统计接口能达到很高的QPS，因为nginx实在是太快了</p>\n<p>有时候前端为了性能在上报统计数据的时候会使用浏览器的beacon接口，这个接口只能发送post请求，我们知道默认静态文件是不支持post请求的，会返回405方法错误，为了解决这个问题需要把post重定向为get，可以使用如下的配置：</p>\n<div class=\"gatsby-highlight\" data-language=\"nginx\"><pre class=\"language-nginx\"><code class=\"language-nginx\"><span class=\"token keyword\">location</span> <span class=\"token operator\">/</span>a<span class=\"token punctuation\">.</span>gif <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">empty_gif</span><span class=\"token punctuation\">;</span>\n\tetag off<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">add_header</span> Pragma no<span class=\"token operator\">-</span>cache<span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">add_header</span> Cache<span class=\"token operator\">-</span>Control <span class=\"token string\">\"private, no-cache, no-store, must-revalidate\"</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token keyword\">error_page</span> <span class=\"token number\">405</span> <span class=\"token operator\">=</span><span class=\"token number\">200</span> <span class=\"token variable\">$uri</span><span class=\"token variable\">$is_args</span><span class=\"token variable\">$args</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>最关键的是下面那条重写语句，检测到405错误会把请求重写为GET，要注意把args也带上，不然日志记录会丢失这个字段</p>\n<h2 id=\"vector\" style=\"position:relative;\"><a href=\"#vector\" aria-label=\"vector permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>vector</h2>\n<p>vector 是一个日志收集系统，和fluentd类似，核心目的就是读取数据源的数据，经过transform和聚合后再写入到一个sink中，具体的使用可以见<a href=\"https://github.com/timberio/vector\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/timberio/vector</a>，vector目前很强大的一点就是支持lua扩展，很多核心还没做的功能通过lua可以将就这做一下，比如说时间转换功能，我想把iso8601时间转为本地时间，可以用如下lua函数</p>\n<div class=\"gatsby-highlight\" data-language=\"lua\"><pre class=\"language-lua\"><code class=\"language-lua\"><span class=\"token keyword\">function</span> <span class=\"token function\">convertIso8601</span><span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">local</span> p<span class=\"token operator\">=</span><span class=\"token string\">'(%d+)-(%d+)-(%d+)T(%d+):(%d+):(%d+)'</span>\n  <span class=\"token keyword\">local</span> year<span class=\"token punctuation\">,</span>month<span class=\"token punctuation\">,</span>day<span class=\"token punctuation\">,</span>hour<span class=\"token punctuation\">,</span>min<span class=\"token punctuation\">,</span>sec<span class=\"token punctuation\">,</span>tz<span class=\"token operator\">=</span>s<span class=\"token punctuation\">:</span><span class=\"token function\">match</span><span class=\"token punctuation\">(</span>p<span class=\"token punctuation\">)</span>\n  <span class=\"token keyword\">return</span> os<span class=\"token punctuation\">.</span><span class=\"token function\">date</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"%Y-%m-%d %T\"</span><span class=\"token punctuation\">,</span>os<span class=\"token punctuation\">.</span><span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>day<span class=\"token operator\">=</span>day<span class=\"token punctuation\">,</span>month<span class=\"token operator\">=</span>month<span class=\"token punctuation\">,</span>year<span class=\"token operator\">=</span>year<span class=\"token punctuation\">,</span>hour<span class=\"token operator\">=</span>hour<span class=\"token punctuation\">,</span>min<span class=\"token operator\">=</span>min<span class=\"token punctuation\">,</span>sec<span class=\"token operator\">=</span>sec<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">end</span></code></pre></div>\n<p>vector目前还处于很初级的阶段，很多时候要自己改代码重新编译，因为官方不一定会采用你提交的pull request，要注意因为vector用到一些C的动态库，所以当想要编译静态库的时候还不能简单用musl编译，需要按照官方的打包脚本来做，曾经我花了很多时间去尝试编译，最后放弃了</p>\n<p>要注意配置clickhouse sink的时候，一定不要传入不存在的字段，不然会写入失败</p>\n<ul>\n<li>给他们提新功能的issue：<a href=\"https://github.com/timberio/vector/issues/867\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/timberio/vector/issues/867</a></li>\n<li>编译时遇到的问题：<a href=\"https://github.com/timberio/vector/issues/877\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/timberio/vector/issues/877</a></li>\n</ul>\n<p>vector这个项目挺有意思的，而且代码库也不难懂，关于用vscode编译调试vector又可以写另一篇博客。要让vector跑起来最好创建一个systemd启动脚本</p>\n<h2 id=\"clickhouse\" style=\"position:relative;\"><a href=\"#clickhouse\" aria-label=\"clickhouse permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>clickhouse</h2>\n<p>去年曾经介绍过这个数据库，用来做大量数据的分析查询非常快速和方便。在这里我们使用docker来运行服务端和客户端</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker run --rm -d --name gt-clickhouse -p <span class=\"token number\">8123</span>:8123 --ulimit <span class=\"token assign-left variable\">nofile</span><span class=\"token operator\">=</span><span class=\"token number\">262144</span>:262144 -v /var/lib/clickhouse:/var/lib/clickhouse -v /etc/localtime:/etc/localtime -v /etc/clickhouse-server/config.xml:/etc/clickhouse-server/config.xml yandex/clickhouse-server\n\ndocker run -it --rm --link gt-clickhouse:clickhouse-server yandex/clickhouse-client --host clickhouse-server</code></pre></div>\n<p>要比较注意的一点是配置默认用户和时区，因为是用docker跑的，所以在这里我们先把docker container的时区设置为与本机保持一致，然后设置superset的时区，默认是UTC，在<code class=\"language-text\">config.xml</code>中把时区设置为北京时间</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\">  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>timezone</span><span class=\"token punctuation\">></span></span>Asia/Shanghai<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>timezone</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>配置好时区后默认写入的时间就会按照这个时区来，比如说写入一个<code class=\"language-text\">2018-01-01 01:00:00</code>，这个时间会直接被当作北京时间存。</p>\n<p>默认clickhouse是不支持写入带时区的时间的，但是有个配置可以开启，见：<a href=\"https://clickhouse.yandex/docs/en/operations/settings/settings/#settings-date_time_input_format\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://clickhouse.yandex/docs/en/operations/settings/settings/#settings-date<em>time</em>input_format</a></p>\n<h2 id=\"superset\" style=\"position:relative;\"><a href=\"#superset\" aria-label=\"superset permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>superset</h2>\n<p>之前也介绍过superset的用法，并且还写过一篇调试superset的文章，目前来说开源的报表软件superset算是最强大的了，优点暂且不提我想列举下superset目前的缺点</p>\n<ol>\n<li>不支持下钻，这个问题在github issue提了很久了但是作者说下钻功能不会放到superset里面，因为这个和业务紧密相关，superset是一个业务无关的软件，具体见<a href=\"https://github.com/apache/incubator-superset/issues/2890#issuecomment-305819244\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/apache/incubator-superset/issues/2890#issuecomment-305819244</a></li>\n<li>不支持数据级别的权限控制，目前实现了角色级别的权限控制，即不同角色的人可访问的表格，dashboard不一样，但是对于更加精细的权限控制，比如说区域经理只能访问本区域下的数据，目前看来不支持这个实现</li>\n</ol>\n<h2 id=\"整体设计\" style=\"position:relative;\"><a href=\"#%E6%95%B4%E4%BD%93%E8%AE%BE%E8%AE%A1\" aria-label=\"整体设计 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>整体设计</h2>\n<p>数据流图如下：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 880px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4d254dcf39fe3b8d00c9d293d0e2b0eb/9c177/chart1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAABibAAAYmwFJdYOUAAAA0ElEQVQoz4WS2w6DIBBE+f+v9MVE20S03lAEe2QiMU2s87Auww47LJpt26aEcRyXZdlPTBdkkgLKVIzQKCPO89x1HXFdV5bkmaQAsu97a630zjniIf6cYO+dUNd127ZN0xARV1UFWRQFPGJ47/0h5mw+RA4bhiHGiL0QAhqXQMISki06qb8kBhb3PkFKxUyijCc0C1yozOz3CAl5mQ+lrZhbMSN4JZBcebzg/FlsEzBJK25eliXzg2c0D2INRtPGPE+lV8yj+SdGoD/keu0ffAEP40fVoM5FPwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/4d254dcf39fe3b8d00c9d293d0e2b0eb/8ac56/chart1.webp 240w,\n/static/4d254dcf39fe3b8d00c9d293d0e2b0eb/d3be9/chart1.webp 480w,\n/static/4d254dcf39fe3b8d00c9d293d0e2b0eb/fd35f/chart1.webp 880w\"\n          sizes=\"(max-width: 880px) 100vw, 880px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/4d254dcf39fe3b8d00c9d293d0e2b0eb/8ff5a/chart1.png 240w,\n/static/4d254dcf39fe3b8d00c9d293d0e2b0eb/e85cb/chart1.png 480w,\n/static/4d254dcf39fe3b8d00c9d293d0e2b0eb/9c177/chart1.png 880w\"\n          sizes=\"(max-width: 880px) 100vw, 880px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/4d254dcf39fe3b8d00c9d293d0e2b0eb/9c177/chart1.png\"\n          alt=\"dataflow chart\"\n          title=\"dataflow chart\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>nginx和vector部署在同一台web server上，这样日志写入后能及时被vector处理，一般来说clickhouse服务器压力不会太大，因为vector写入的时候是批量写入的，可能攒了几百条记录一次性写。到superset这级压力就更小了，数据随便查，clickhouse是出了名的高性能。另外superset可以配置多个数据源，所以可以把postgresql也加上，这样所有系统报表都从superset出，避免了统计口径混乱与重复工作的问题</p>\n<p>这套统计平台最大的好处就是clickhouse和Postgresql都是基于SQL的，所以对使用人员来说学习成本很低，不像ELK查询起来不方便用户也没法自定义</p>\n<p>一个简单的监控例子：</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/4596563b72f5594f92294e5b88eeb126/6c68b/superset-demo1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 26.25%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA7ElEQVQY001OTUvEQAzt31/xF7gXvSp486ooHkRcFvWiFnZbBcu208620/nKTCZmVgRfDuHl5eWlEG3b9/2sdTwgHOCcwz/+2zEG8BnAcswLxpjiYzdO2hBRSgkTenAAoNQkx/2s58kaKaVW6nOYGtFOHOI8Fx9gS3H51tmA2YtsJ45AxETknavWa/20Ch5477oa6rkmcvQPxdnLTlqWcywgxBQQI5upF+boGBcLahpmtdSnr5uT5+1VKe62YvW9j5iKjVCjsyHyK9ZHb8FAyFFlpx6WF4/L85uy+1J5sh3se6sqae9reVtJiPgDfNUZoa0JY40AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <picture>\n        <source\n          srcset=\"/static/4596563b72f5594f92294e5b88eeb126/8ac56/superset-demo1.webp 240w,\n/static/4596563b72f5594f92294e5b88eeb126/d3be9/superset-demo1.webp 480w,\n/static/4596563b72f5594f92294e5b88eeb126/e46b2/superset-demo1.webp 960w,\n/static/4596563b72f5594f92294e5b88eeb126/f992d/superset-demo1.webp 1440w,\n/static/4596563b72f5594f92294e5b88eeb126/e4a01/superset-demo1.webp 1888w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/webp\"\n        />\n        <source\n          srcset=\"/static/4596563b72f5594f92294e5b88eeb126/8ff5a/superset-demo1.png 240w,\n/static/4596563b72f5594f92294e5b88eeb126/e85cb/superset-demo1.png 480w,\n/static/4596563b72f5594f92294e5b88eeb126/d9199/superset-demo1.png 960w,\n/static/4596563b72f5594f92294e5b88eeb126/07a9c/superset-demo1.png 1440w,\n/static/4596563b72f5594f92294e5b88eeb126/6c68b/superset-demo1.png 1888w\"\n          sizes=\"(max-width: 960px) 100vw, 960px\"\n          type=\"image/png\"\n        />\n        <img\n          class=\"gatsby-resp-image-image\"\n          src=\"/static/4596563b72f5594f92294e5b88eeb126/d9199/superset-demo1.png\"\n          alt=\"superset demo\"\n          title=\"superset demo\"\n          loading=\"lazy\"\n          style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        />\n      </picture>\n  </a>\n    </span></p>\n<p>如此开发人员和运营人员用同一个后台就能同时监控服务器数据和业务数据，而且只要懂sql就可以自己创建报表，不需要麻烦别人，稍微培训下运营就能成为数据分析师</p>","fields":{"slug":"/posts/business-and-api-monitor","tagSlugs":["/tag/programming/","/tag/web/"]},"frontmatter":{"date":"2019-10-02 20:51","description":"监控对初创企业来说非常重要，服务器性能监控可以提醒我们是否访问量激增，接口性能是否够用，业务监控可以告诉我们某个业务、活动是否得到了预期的效果，一般来说服务器监控属于Devops的事，业务监控属于BI的事，但是对初创企业来说二者都是研发部门要做的事","tags":["Programming","Web"],"title":"使用clickhouse来做业务和性能监控"}}},"pageContext":{"slug":"/posts/business-and-api-monitor"}}}