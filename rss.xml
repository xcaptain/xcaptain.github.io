<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Joey的博客]]></title><description><![CDATA[每天进步一点点]]></description><link>https://joeyxf.com</link><generator>RSS for Node</generator><lastBuildDate>Wed, 24 Jul 2019 04:12:01 GMT</lastBuildDate><item><title><![CDATA[使用vscode来进行开发与调试]]></title><description><![CDATA[vscode是一个很流行的代码编辑器，轻量但是插件丰富，稍加扩展就能成为一款强大的IDE，对编码效率有很大的提升]]></description><link>https://joeyxf.com/posts/vscode-debug-tutorial</link><guid isPermaLink="false">https://joeyxf.com/posts/vscode-debug-tutorial</guid><pubDate>Tue, 23 Jul 2019 20:56:00 GMT</pubDate><content:encoded>&lt;p&gt;本文主要将介绍如何用vscode进行各种语言的项目进行调试，在没有好的工具链的远古时代，人们一般是用gdb,pdb来调试C/C++,python代码，后来有了IDE，可以在IDE里面进行调试，但是一般来说IDE和编程语言绑定太严重了，没法做到随意切换，后来有了vscode，微软牵头搞了LSP，CDP，使得在不同平台下编辑调试体验都很一致了&lt;/p&gt;
&lt;p&gt;大体上来说调试程序的过程包括：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;生成带调试信息的二进制文件&lt;/li&gt;
&lt;li&gt;把这个二进制文件加载到调试器中运行&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;不管是过去的gdb命令行模式调，还是现在的vscode图形界面调，这2个基本原则都没变。接下来将举例说明如何用vscode配合语言扩展调试不同语言的项目&lt;/p&gt;
&lt;h2 id=&quot;python&quot;&gt;&lt;a href=&quot;#python&quot; aria-label=&quot;python permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;python&lt;/h2&gt;
&lt;p&gt;Python是被vscode官方支持的语言，进入扩展市场搜索python，然后安装排名最靠前的微软官方的那个扩展就行了&lt;/p&gt;
&lt;h3 id=&quot;调试一个简单的flask-app&quot;&gt;&lt;a href=&quot;#%E8%B0%83%E8%AF%95%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84flask-app&quot; aria-label=&quot;调试一个简单的flask app permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;调试一个简单的flask app&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;mkdir&lt;/span&gt; flask_demo
&lt;span class=&quot;token function&quot;&gt;cd&lt;/span&gt; flask_demo
python3 -m venv venv
&lt;span class=&quot;token keyword&quot;&gt;.&lt;/span&gt; venv/bin/activate.fish &lt;span class=&quot;token comment&quot;&gt;# 可能是bash文件是视当前shell环境的定&lt;/span&gt;
pip &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; Flask&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;创建一个简单的&lt;code class=&quot;language-text&quot;&gt;app.py&lt;/code&gt;文件，包含的内容如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; flask &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Flask
app &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Flask&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;__name__&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

@app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;route&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hello_world&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Hello World!&apos;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; __name__ &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;__main__&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;run&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;用vscode打开这个项目，按下&lt;code class=&quot;language-text&quot;&gt;F5&lt;/code&gt;开始调试，遇到的界面如下：&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/e7a04b8316e9bd90e1f20c361c9147c2/ff12a/python-flask-1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 37.50819672131147%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAA2UlEQVQY052PW27DIBBFWUjB5TEQB2IwhEdxYllV97+mTqykavuTqkdXCI10uANZll5rLaWWeiPnnFLw/pRLa/1SW++X63Xd8GxvC07OpaYUU5ydc2R732JM84yJePEhGqMN6KmtfvmwebVlg9hFaMI3EfpgHKUvjDFKKcmtOHey9h53dIoL0BBxgXieQpzCDGaUYJQ+KD1yIdFjO0QqacxBa3MPaMG5EGq0VgNIIdjwEzawB0RKBVj0iFLAd6RSr8MTCJZg4Tcfbq/vX2LP+N38Jf8FlOHf8ieufEeLtNQzCwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;flask app&quot;
        title=&quot;&quot;
        src=&quot;/static/e7a04b8316e9bd90e1f20c361c9147c2/f570d/python-flask-1.png&quot;
        srcset=&quot;/static/e7a04b8316e9bd90e1f20c361c9147c2/0783d/python-flask-1.png 240w,
/static/e7a04b8316e9bd90e1f20c361c9147c2/782f4/python-flask-1.png 480w,
/static/e7a04b8316e9bd90e1f20c361c9147c2/f570d/python-flask-1.png 960w,
/static/e7a04b8316e9bd90e1f20c361c9147c2/8d0ff/python-flask-1.png 1440w,
/static/e7a04b8316e9bd90e1f20c361c9147c2/ff12a/python-flask-1.png 1525w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;选择flask，vscode会自动生成调试配置文件，具体见&lt;code class=&quot;language-text&quot;&gt;.vscode/launch.json&lt;/code&gt;，默认生成的flask 调试配置文件如下：&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b6ad96fbf76c0469d3f7ef08216b8070/dc619/python-flask-2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 72.3360655737705%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAIAAACgpqunAAAACXBIWXMAAA7EAAAOxAGVKw4bAAABFElEQVQoz42R/W7DIAzE8yAFjDHYQJp+bZP2z97/sXYla6tuk5rTCVlRfvhspsvb6Xg87mddltqaSkoiWXDAKP46P+qJiFTxKaUSYwosMQqlwizk/tXO+ZuuMAWKifrF9h+1vxkKnUUMfBx3Rc7Do0CPJziEkFKa565WzDQyu+CIAzHFYRq+1w8Y5MrjFDWMVDEOM4IH7x0yPts9UvspDl1L52rvtfVm2lvFhf6VJmb+gb23/cHmBQvH+hAGfgHfO4fx63x+P3x+IcK56WLKkdxGWHIRq2KNc44v+/6KnXLppkicNgx8hfFI4NfOWJKKnHpdrGyCQd6eKkhRziVE2Tm3Fc6YEJshWvtv1wRgxYY2jXrXN8GDa8RKwfiUAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;flask vscode launch file&quot;
        title=&quot;&quot;
        src=&quot;/static/b6ad96fbf76c0469d3f7ef08216b8070/f570d/python-flask-2.png&quot;
        srcset=&quot;/static/b6ad96fbf76c0469d3f7ef08216b8070/0783d/python-flask-2.png 240w,
/static/b6ad96fbf76c0469d3f7ef08216b8070/782f4/python-flask-2.png 480w,
/static/b6ad96fbf76c0469d3f7ef08216b8070/f570d/python-flask-2.png 960w,
/static/b6ad96fbf76c0469d3f7ef08216b8070/dc619/python-flask-2.png 976w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这样就以调试模式把代码跑起来了，相当于这个flask app是在调试器内运行，所以可以监控当前变量，单步执行等&lt;/p&gt;
&lt;h2 id=&quot;调试rust代码&quot;&gt;&lt;a href=&quot;#%E8%B0%83%E8%AF%95rust%E4%BB%A3%E7%A0%81&quot; aria-label=&quot;调试rust代码 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;调试rust代码&lt;/h2&gt;
&lt;p&gt;rust语言没有被vscode官在支持，但是社区做了很多工作，基本算是可用。首先建议安装&lt;a href=&quot;https://github.com/rust-analyzer/rust-analyzer&quot;&gt;rust-analyzer&lt;/a&gt;，这是rust的lsp，用来进行代码跳转补齐。其次安装&lt;a href=&quot;https://marketplace.visualstudio.com/items?itemName=vadimcn.vscode-lldb&quot;&gt;lldb&lt;/a&gt;，用于把rust二进制文件放调试器运行&lt;/p&gt;
&lt;h3 id=&quot;调试一个简单的rust项目&quot;&gt;&lt;a href=&quot;#%E8%B0%83%E8%AF%95%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84rust%E9%A1%B9%E7%9B%AE&quot; aria-label=&quot;调试一个简单的rust项目 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;调试一个简单的rust项目&lt;/h3&gt;
&lt;p&gt;测试项目见：&lt;a href=&quot;https://github.com/xcaptain/rust-algorithms&quot;&gt;https://github.com/xcaptain/rust-algorithms&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;调试效果图如下：&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f8ecfcaf26067983669a4c096f1150a4/7e1bc/rust-vscode-debug-1.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 53.16011235955056%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAAMCBf/EABQBAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhADEAAAAeVmkgD/xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAEFAl//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAUEAEAAAAAAAAAAAAAAAAAAAAg/9oACAEBAAY/Al//xAAaEAABBQEAAAAAAAAAAAAAAAAAEBEhQXGR/9oACAEBAAE/IZH06Uv/2gAMAwEAAgADAAAAEHMP/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxABAAICAwAAAAAAAAAAAAAAAQAREEEhMWH/2gAIAQEAAT8QTrTEUDyl+wBGtY//2Q==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;rust-vscode-debug-demo&quot;
        title=&quot;&quot;
        src=&quot;/static/f8ecfcaf26067983669a4c096f1150a4/b3ee8/rust-vscode-debug-1.jpg&quot;
        srcset=&quot;/static/f8ecfcaf26067983669a4c096f1150a4/3bc27/rust-vscode-debug-1.jpg 240w,
/static/f8ecfcaf26067983669a4c096f1150a4/98431/rust-vscode-debug-1.jpg 480w,
/static/f8ecfcaf26067983669a4c096f1150a4/b3ee8/rust-vscode-debug-1.jpg 960w,
/static/f8ecfcaf26067983669a4c096f1150a4/7e1bc/rust-vscode-debug-1.jpg 1424w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;很显然，调试器上部可以看到当前变量的值，下部可以看调的堆栈&lt;/p&gt;
&lt;h2 id=&quot;调试java代码&quot;&gt;&lt;a href=&quot;#%E8%B0%83%E8%AF%95java%E4%BB%A3%E7%A0%81&quot; aria-label=&quot;调试java代码 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;调试java代码&lt;/h2&gt;
&lt;p&gt;安装vscode的java扩展之后，套路是一样的，上一张调试spring boot项目的图&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6f256cc67c0d27ae296a4146e93c8225/92e4f/java-vscode-debug-1.jpg&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 53.23590814196242%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAECAwX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHlTeQxB//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEAAQUCX//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQMBAT8BP//EABQRAQAAAAAAAAAAAAAAAAAAABD/2gAIAQIBAT8BP//EABQQAQAAAAAAAAAAAAAAAAAAACD/2gAIAQEABj8CX//EABoQAAICAwAAAAAAAAAAAAAAAAABEWEQMVH/2gAIAQEAAT8hc2N2S+j3n//aAAwDAQACAAMAAAAQc8//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/ED//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/ED//xAAdEAACAAcBAAAAAAAAAAAAAAAAARARITFRcZGx/9oACAEBAAE/EKkwx29mBujNaR//2Q==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;vscode-springboot-debug-demo&quot;
        title=&quot;&quot;
        src=&quot;/static/6f256cc67c0d27ae296a4146e93c8225/b3ee8/java-vscode-debug-1.jpg&quot;
        srcset=&quot;/static/6f256cc67c0d27ae296a4146e93c8225/3bc27/java-vscode-debug-1.jpg 240w,
/static/6f256cc67c0d27ae296a4146e93c8225/98431/java-vscode-debug-1.jpg 480w,
/static/6f256cc67c0d27ae296a4146e93c8225/b3ee8/java-vscode-debug-1.jpg 960w,
/static/6f256cc67c0d27ae296a4146e93c8225/b97fe/java-vscode-debug-1.jpg 1440w,
/static/6f256cc67c0d27ae296a4146e93c8225/92e4f/java-vscode-debug-1.jpg 1916w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;调试go代码&quot;&gt;&lt;a href=&quot;#%E8%B0%83%E8%AF%95go%E4%BB%A3%E7%A0%81&quot; aria-label=&quot;调试go代码 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;调试go代码&lt;/h2&gt;
&lt;p&gt;这回不用框架，手写一个简单的例子演示如何调试&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;go&quot;&gt;&lt;pre class=&quot;language-go&quot;&gt;&lt;code class=&quot;language-go&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;package&lt;/span&gt; main

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
	&lt;span class=&quot;token string&quot;&gt;&quot;fmt&quot;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	a &lt;span class=&quot;token operator&quot;&gt;:=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
	fmt&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;Println&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;a=&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;func&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;a &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; b &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
	&lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; a &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; b
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这段是一个非常简单的go代码，用vscode打开这个项目，然后按下&lt;code class=&quot;language-text&quot;&gt;F5&lt;/code&gt;，编辑器会自动检测到项目类型而生成一个&lt;code class=&quot;language-text&quot;&gt;.vscode/launch.json&lt;/code&gt;的文件，有了这个文件编辑器就知道该怎么调试整个项目了&lt;/p&gt;
&lt;p&gt;效果图如下：&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f448884ed3604a46804af8c2567cc357/2d15a/go-vscode-debug-1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 23.674242424242422%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAIAAADKYVtkAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAiElEQVQY033LYQ6DIAwFYA6ihZbCnHZDcATd/Q8mZGZZTObL96NN+1Qpa855bdnqXEpZljSn+AwytcivOaaYUpzDZ1Xj9PDe31qGyjlHlv0ohAb6c0BDA8dFEXEtO3ewxFobQlu/ug6uKWv526w88+DwlYf3dg/BiIBI/8+5zOwQDREQ6QoRLuyS7yu7Yy4xCwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;go-vscode-debug&quot;
        title=&quot;&quot;
        src=&quot;/static/f448884ed3604a46804af8c2567cc357/f570d/go-vscode-debug-1.png&quot;
        srcset=&quot;/static/f448884ed3604a46804af8c2567cc357/0783d/go-vscode-debug-1.png 240w,
/static/f448884ed3604a46804af8c2567cc357/782f4/go-vscode-debug-1.png 480w,
/static/f448884ed3604a46804af8c2567cc357/f570d/go-vscode-debug-1.png 960w,
/static/f448884ed3604a46804af8c2567cc357/8d0ff/go-vscode-debug-1.png 1440w,
/static/f448884ed3604a46804af8c2567cc357/2d15a/go-vscode-debug-1.png 1584w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;高级用法&quot;&gt;&lt;a href=&quot;#%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95&quot; aria-label=&quot;高级用法 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;高级用法&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;如何调试mono repo(包含多个入口程序的项目)&lt;/li&gt;
&lt;li&gt;如何调试运行中的程序&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[配置nginx tcp ssl负载均衡]]></title><description><![CDATA[配置nginx tcp ssl负载均衡]]></description><link>https://joeyxf.com/posts/setup-nginx-tcp-ssl-proxy</link><guid isPermaLink="false">https://joeyxf.com/posts/setup-nginx-tcp-ssl-proxy</guid><pubDate>Tue, 02 Jul 2019 00:02:00 GMT</pubDate><content:encoded>&lt;h2 id=&quot;生成自签发证书&quot;&gt;&lt;a href=&quot;#%E7%94%9F%E6%88%90%E8%87%AA%E7%AD%BE%E5%8F%91%E8%AF%81%E4%B9%A6&quot; aria-label=&quot;生成自签发证书 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;生成自签发证书&lt;/h2&gt;
&lt;p&gt;要做ssl代理必须要有证书，很多人会从第三方认证机构购买，有些人会直接使用lets encrypt的免费证书，但因为我们只是服务端通信用，所以不必要使用权威认证机构签发的证书，自己签发一个就行，参考了下面这篇文章生成自签发证书&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://zonena.me/2016/02/creating-ssl-certificates-in-3-easy-steps/&quot;&gt;https://zonena.me/2016/02/creating-ssl-certificates-in-3-easy-steps/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;生成使用ed25519加密算法的证书，第一行生成密钥，第二行生成证书&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;openssl ecparam -out /etc/ssl/private/ss1-nginx.key -name prime256v1 -genkey
openssl req -new -days 3650 -nodes -x509 \
    -subj &lt;span class=&quot;token string&quot;&gt;&quot;/C=US/ST=Denial/L=Springfield/O=Dis/CN=www.example.com&quot;&lt;/span&gt; \
    -key /etc/ssl/private/ss1-nginx.key -out /etc/ssl/certs/ss1-nginx.cert&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;重新编译nginx&quot;&gt;&lt;a href=&quot;#%E9%87%8D%E6%96%B0%E7%BC%96%E8%AF%91nginx&quot; aria-label=&quot;重新编译nginx permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;重新编译nginx&lt;/h2&gt;
&lt;p&gt;因为要到nginx 1.9之后才开始支持tcp代理，所以如果要用这个功能必须要使用高版本nginx，如果有docker镜像是最好的，没有的话就得自己重新编译，具体编译步骤如下，我用的是archlinux，所以我下了我本地版本的nginx，然后使用了如下的编译选项，&lt;code class=&quot;language-text&quot;&gt;--with-stream&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;--with-stream_ssl_module&lt;/code&gt;这2个选项必须要有&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; https://nginx.org/download/nginx-1.16.0.tar.gz
&lt;span class=&quot;token function&quot;&gt;tar&lt;/span&gt; zxf nginx-1.16.0.tar.gz
&lt;span class=&quot;token function&quot;&gt;cd&lt;/span&gt; nginx-1.16.0

./configure \
--sbin-path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/usr/bin/nginx \
--conf-path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/etc/nginx/nginx.conf \
--pid-path&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/var/run/nginx.pid \
--with-http_ssl_module \
--with-stream \
--with-stream_ssl_module

&lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;make&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;配置nginx&quot;&gt;&lt;a href=&quot;#%E9%85%8D%E7%BD%AEnginx&quot; aria-label=&quot;配置nginx permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;配置nginx&lt;/h2&gt;
&lt;p&gt;总的来说就是2台服务器，前面的这台服务器叫反向代理服务器，后面的这台叫作上游服务器，为了安全起见反代和上游服务器之间的数据报要加密，所以引入一个ssl来给tcp包一层&lt;/p&gt;
&lt;p&gt;以下是反代服务器的配置&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nginx&quot;&gt;&lt;pre class=&quot;language-nginx&quot;&gt;&lt;code class=&quot;language-nginx&quot;&gt;stream &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;upstream&lt;/span&gt; backend &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;129.181&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;.12&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;.5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;92345&lt;/span&gt; weight&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt; max_fails&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; fail_timeout&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;129.181&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;.12&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;.6&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;92345&lt;/span&gt; weight&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt; max_fails&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt; fail_timeout&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;5&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;listen&lt;/span&gt;     &lt;span class=&quot;token number&quot;&gt;12345&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;proxy_pass&lt;/span&gt; backend&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        proxy_ssl  on&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        proxy_ssl_certificate         &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;etc&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;ssl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;certs&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;nginx1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cert&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        proxy_ssl_certificate_key     &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;etc&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;ssl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;private&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;nginx1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;配置很显然，指定了证书和密钥的位置，指定了上游服务的ip端口，指定了2个服务的权重，意思就是本机的12345收到请求（非ssl加密），再经过ssl加密后转到后面的2台服务器的92345端口&lt;/p&gt;
&lt;p&gt;接下来配置上游服务器，也需要用到nginx，还要用到相同的证书进行解密&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;nginx&quot;&gt;&lt;pre class=&quot;language-nginx&quot;&gt;&lt;code class=&quot;language-nginx&quot;&gt;stream &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;upstream&lt;/span&gt; backend &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;127.0&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;.0&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;.1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;8598&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;server&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;listen&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;92345&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;ssl&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;proxy_pass&lt;/span&gt; backend&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;ssl_certificate&lt;/span&gt;         &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;etc&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;ssl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;certs&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;nginx1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;cert&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;ssl_certificate_key&lt;/span&gt;     &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;etc&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;ssl&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;private&lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt;nginx1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;key&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这个配置也很好理解，监听92345端口，并且只接受ssl加密后了连接，收到请求后拿配置在证书和密就进行解密，解密完后把数据转发给后的的8598应用，一加密一解密，中间谁也不知道传了什么数据，除非攻击者厉害到能破解ecc算法，建议走外网的代理都使是ssl加密再传，提高安全性&lt;/p&gt;
&lt;p&gt;需要注意这2个stream配置都要放到&lt;code class=&quot;language-text&quot;&gt;nginx.conf&lt;/code&gt;，千万别放到&lt;code class=&quot;language-text&quot;&gt;sites-available&lt;/code&gt;这种地方，不然就会进入到&lt;code class=&quot;language-text&quot;&gt;http&lt;/code&gt;部分&lt;/p&gt;</content:encoded></item><item><title><![CDATA[使用与调试superset]]></title><description><![CDATA[superset是一个强大的数据可视化软件，可以很方便的创建报表，并且支持多维度查询，最近在项目中直接使用到了superset，并且还对它进行了二次开发，以下将总结下使用心得]]></description><link>https://joeyxf.com/posts/how-to-use-superset</link><guid isPermaLink="false">https://joeyxf.com/posts/how-to-use-superset</guid><pubDate>Mon, 01 Jul 2019 00:01:00 GMT</pubDate><content:encoded>&lt;p&gt;在选型的时候还考虑过redash，这个软件也很强大，但是似乎是个人项目，只有一个核心开发者，而superset是airbnb孵化的，apache基金会运营的，所以研发实力还是信得过的，应该会持续提供维护。简单看了一下superset的代码，前端是用react开发的，后端使用flask开发，整体架构还是比较简单清晰的&lt;/p&gt;
&lt;h2 id=&quot;快速部署&quot;&gt;&lt;a href=&quot;#%E5%BF%AB%E9%80%9F%E9%83%A8%E7%BD%B2&quot; aria-label=&quot;快速部署 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;快速部署&lt;/h2&gt;
&lt;p&gt;看快速部署上线解决客户的问题最简单的办法就是使用docker镜像，官方的docker太简陋了，缺少很多数据源驱动，本地元数据存储也需在自己配置，使用起来不方便，我使用的是&lt;a href=&quot;https://github.com/amancevice/docker-superset&quot;&gt;https://github.com/amancevice/docker-superset&lt;/a&gt;重新打包的镜像，做了很多自定义设置，使用起来很方便&lt;/p&gt;
&lt;p&gt;使用很简单，这个项目就是个docker-compose的配置，包含了如何本地构建superset镜像（默认配置，默认数据源驱动等），设置缓存和元数据数据库，我的数据是是&lt;code class=&quot;language-text&quot;&gt;SQL Server&lt;/code&gt;，选择的本地存储数据库是&lt;code class=&quot;language-text&quot;&gt;PostgreSQL&lt;/code&gt;，缓存当然是&lt;code class=&quot;language-text&quot;&gt;Redis&lt;/code&gt;，很快就跑起来了&lt;/p&gt;
&lt;h2 id=&quot;快速上手&quot;&gt;&lt;a href=&quot;#%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B&quot; aria-label=&quot;快速上手 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;快速上手&lt;/h2&gt;
&lt;p&gt;按照上述步骤部署完成后会得到一个管理员账号，浏览器访问superset后台，输入帐号密码进入，看到的界面如下：
&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c4822e5402f40ad1db1aebf8cf7edba3/51c08/superset-overview.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 42.58793969849247%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAIAAAC9o5sfAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAvUlEQVQoz5WQOQ7CMBBFc/9LpcoV0kGRBpqQgLeZ8caXLaOwBMQrLPnnP9uZblkWa61zzhijtDZlo5SqYfhKhwZ6MLGu6nZZ16tShpwjYmbCSp9BvzMNHKCJFmZJKW9I2JYEV3nvUwN+k7W2Im4cpe/zMKR5Rj3FCM0hZ4Ys3qNYzYj8SSa6nU/6eMjTlKyt8qNaEZHYws3N5dkqBJtzLE99B9quDFiEgw8xph3i5tOrjMnvzfbHtMuP/wH6d3s/C5JvuNMBAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;superset-overview&quot;
        title=&quot;&quot;
        src=&quot;/static/c4822e5402f40ad1db1aebf8cf7edba3/f570d/superset-overview.png&quot;
        srcset=&quot;/static/c4822e5402f40ad1db1aebf8cf7edba3/0783d/superset-overview.png 240w,
/static/c4822e5402f40ad1db1aebf8cf7edba3/782f4/superset-overview.png 480w,
/static/c4822e5402f40ad1db1aebf8cf7edba3/f570d/superset-overview.png 960w,
/static/c4822e5402f40ad1db1aebf8cf7edba3/8d0ff/superset-overview.png 1440w,
/static/c4822e5402f40ad1db1aebf8cf7edba3/51c08/superset-overview.png 1592w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;和大部分BI系统一样，一个是控制面板列表，一个是报表列表，要做的事就是&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;写SQL&lt;/li&gt;
&lt;li&gt;创建报表&lt;/li&gt;
&lt;li&gt;把报表添加到控制面板，并设置访问权限&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;superset内置了一个很强大的&lt;code class=&quot;language-text&quot;&gt;SQL Lab&lt;/code&gt;，在这里可以调试自己的sql，当然大部分人都是在本地用编辑器是sql然后放到sql lab运行。在sql lab测试没问的的sql可以把查询结果视为一个数据源（datasource），sql lab支持把这个数据源创建为报表（chart）&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ea7b17b634c45c02024bbc123ebd1ec1/de6c6/sqllab-result.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 27.78489116517286%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAIAAABM9SnKAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAp0lEQVQY032PUQ6DIAxAvf9FdiGTmWWJzv1Ml1CgpSBCHXMz+9G9kKah7StUCgAdETuLaAlLQsyO2YegEEOMkg+pyHv0DOwMO80MhAPAU2ulFBhN7h8VEcYpLiLl5JzIWmdM13V1XZdYOuiYMvy2z/OcRVJKg1KX4XHr++bctG0LALbojjYvG7LGO9rTtSmP57U8jmOxi+x//De8OSSF4KYgX9vnbp8XHb5Z7l3bucoAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;sqllab-result&quot;
        title=&quot;&quot;
        src=&quot;/static/ea7b17b634c45c02024bbc123ebd1ec1/f570d/sqllab-result.png&quot;
        srcset=&quot;/static/ea7b17b634c45c02024bbc123ebd1ec1/0783d/sqllab-result.png 240w,
/static/ea7b17b634c45c02024bbc123ebd1ec1/782f4/sqllab-result.png 480w,
/static/ea7b17b634c45c02024bbc123ebd1ec1/f570d/sqllab-result.png 960w,
/static/ea7b17b634c45c02024bbc123ebd1ec1/8d0ff/sqllab-result.png 1440w,
/static/ea7b17b634c45c02024bbc123ebd1ec1/de6c6/sqllab-result.png 1562w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;点这里的explore就能把数据结果创建为报表&lt;/p&gt;
&lt;p&gt;接下来对报表的操作都很显然，界面设计的很直观，看一眼基本就知道怎么用，不知道的地方查看一下官方文档就行了。这里要注意一点，在是sql的时候我们喜欢使用别名，比如说&lt;code class=&quot;language-text&quot;&gt;select name as 姓名&lt;/code&gt;类似这样的写法，为了方便阅读结果，但是目前superset只支持别名是ascii字符，如果要导出普通人可读的报表（字段名都是中文）那该怎么办呢？&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/53396e3da8934fc25b76518b58bef756/005f0/edit-datasource.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 59.958791208791204%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAB8ElEQVQoz1VSTW/aQBDl91atRB1TFpsaLNSiGE6hB5BScWjVW8CUf1ECOQASh6pVmiZpaEmxY+z9tPvM0q8nezSW9817szMF0zRJmdi2Xa1WEQkhjUZjMpl8mEzOp+dILmaz2XR6MZ0in8/ny+VysVisVqtOp1MglkVsy7JtzQe52WxyJXma3tFEZhlNVSR4JEWaHaCUQuz3+wXQSCXHc8BxKrbtHR8nlIZBIJX6cn17u/6eMBZRuotjytjDbsc4F0rlykXDePT4iXFkFo9M0zDsMmm32/idJImScv1js90G0JFSCrwKUaAoyK9ALhMC8Xq9XqvV3FrNqVbbnhes10EYgs85Z4zFcZz8A0oTlOucdAro03EcTUZiWVbL88L7+81mEwQBxcH89F/ozzRNc9ulZ+XiUwM010WFOmrBdhRFYYiuA8Zywn+6exeZJpdJxSyVtLjruri1VquFngGl5M9tED5ESLiGEGwfD8r7Oz7Y1sqaDGU09uny6uZujYRLyfdXxYTAzWFsvV4v71m3rUtockwpehacf/x8+fXmG0xiWniY4DGjIGPQ3W63oBdL60Mcued5GIreh3yynP/ejkzvyXUSiyx7fXqa2/4D7QLrORqNxuPxcDgc5fAHg4HvD/093vv+yds3787Omi9e/gIyZCKuXy0HWwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;edit-datasource&quot;
        title=&quot;&quot;
        src=&quot;/static/53396e3da8934fc25b76518b58bef756/f570d/edit-datasource.png&quot;
        srcset=&quot;/static/53396e3da8934fc25b76518b58bef756/0783d/edit-datasource.png 240w,
/static/53396e3da8934fc25b76518b58bef756/782f4/edit-datasource.png 480w,
/static/53396e3da8934fc25b76518b58bef756/f570d/edit-datasource.png 960w,
/static/53396e3da8934fc25b76518b58bef756/8d0ff/edit-datasource.png 1440w,
/static/53396e3da8934fc25b76518b58bef756/005f0/edit-datasource.png 1456w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;在这里给每个列添加一个别名就行了，然后刷新结果就能看到对应的中文字段&lt;/p&gt;
&lt;h2 id=&quot;权限控制&quot;&gt;&lt;a href=&quot;#%E6%9D%83%E9%99%90%E6%8E%A7%E5%88%B6&quot; aria-label=&quot;权限控制 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;权限控制&lt;/h2&gt;
&lt;p&gt;对于一个BI系统来说，权限控制当然很重要，不然谁都能看核心数据就乱套了。核心也就是RBAC，先创建一个帐号，再创建一个角色，把角色赋予这个帐号，然后把每个报表（数据源）的权限赋的对应角色就行了&lt;/p&gt;
&lt;h2 id=&quot;调试&quot;&gt;&lt;a href=&quot;#%E8%B0%83%E8%AF%95&quot; aria-label=&quot;调试 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;调试&lt;/h2&gt;
&lt;p&gt;因为superset后端代码是用flask框架写的，所以改起来还算方便，我最近遇到个问题需要在导出csv文件的时候让表头变为中文，也就是使用上面设置的列名别名，分享下我修改源码的经历&lt;/p&gt;
&lt;p&gt;首先要在本地跑起superset来，按照官方的文档做就行，简单说就是：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;创建virtual environment&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;python3 -m venv venv&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;激活当前虚拟环境&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;. venv/bin/activate.fish&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;安装依赖&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;pip install -r requirements.txt; pip install -r requirements-dev.txt&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;构建superset&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;pip install -e .&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;运行superset&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;superset run -p 8088 --with-threads --reload --debugger -h 0.0.0.0&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;光跑起来还不够，想要知道系统内部是怎么运行的还需要配置好调试器，然后单步执行才能理解系统如何处理每个请求的，因为是flask app，我用的编辑器vscode的支持比较好，microsoft对python有官方支持，对flask 也有官方支持，所以在添加调试配置的时候选择flask app，就行，最后编辑&lt;code class=&quot;language-text&quot;&gt;launch.json&lt;/code&gt;把&lt;code class=&quot;language-text&quot;&gt;flask_app&lt;/code&gt;设置为&lt;code class=&quot;language-text&quot;&gt;superset&lt;/code&gt;就行，然后按下&lt;kbd&gt;F5&lt;/kbd&gt;就能以调试模式运行superset了，接下来的套路就很简单，设置端点，单步执行，检查变量值。如果没有调试器的话对这么大型的项目要一步一步print查看变量值，简直没法执行。&lt;/p&gt;
&lt;p&gt;最后我给官方提的补丁见&lt;a href=&quot;https://github.com/apache/incubator-superset/pull/7795&quot;&gt;https://github.com/apache/incubator-superset/pull/7795&lt;/a&gt;，很简单很清晰的改动，但还没有被合并进去。为了让我自己的服务器体验最新的补丁，我直写修改了docker容器里的代码，非常机智，这样就不用等上游合并了&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;docker &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; 5ede569d1a0a:/usr/local/lib/python3.6/site-packages/superset/viz.py &lt;span class=&quot;token keyword&quot;&gt;.&lt;/span&gt;
docker &lt;span class=&quot;token function&quot;&gt;cp&lt;/span&gt; 5ede569d1a0a:/etc/superset/superset-config.py &lt;span class=&quot;token keyword&quot;&gt;.&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;把这2个文件从容器中复制出来，修改完再复制回去，然后重启docker容器就行，啥不会重启？执行&lt;code class=&quot;language-text&quot;&gt;docker-compose restart&lt;/code&gt;搞定&lt;/p&gt;</content:encoded></item><item><title><![CDATA[博客更新]]></title><description><![CDATA[对博客界面和功能做了一些更新，希望能激励自己写作]]></description><link>https://joeyxf.com/posts/blog-updates</link><guid isPermaLink="false">https://joeyxf.com/posts/blog-updates</guid><pubDate>Sun, 23 Jun 2019 03:48:00 GMT</pubDate><content:encoded>&lt;p&gt;花了一晚上时间优化了一下界面，添加了一些功能，并且给写作制定一些标准&lt;/p&gt;
&lt;h2 id=&quot;功能更新&quot;&gt;&lt;a href=&quot;#%E5%8A%9F%E8%83%BD%E6%9B%B4%E6%96%B0&quot; aria-label=&quot;功能更新 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;功能更新&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;加入disqus评论支持&lt;/p&gt;
&lt;p&gt;博客一直都没加评论也没有做SEO，现在看来是时候好好优化下了，目前disqus国内还用不了，很遗憾&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;加入google analysis统计&lt;/p&gt;
&lt;p&gt;在谷歌后台把原来老的统计更新到新的网站域名，实时统计功能还不错&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;使用travis-ci自动构建静态站点&lt;/p&gt;
&lt;p&gt;目前这个网站&lt;a href=&quot;https://joeyxf.com&quot;&gt;https://joeyxf.com&lt;/a&gt;是用netlify来构建的，如果要deploy到github pages则需要手动部署，目前通过&lt;code class=&quot;language-text&quot;&gt;.travis.yml&lt;/code&gt;部署效果不错&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;katex支持&lt;/p&gt;
&lt;p&gt;启用了katex支持，方便把markdown转化为美观的数学公式，通过&lt;code class=&quot;language-text&quot;&gt;$$&lt;/code&gt;，或者&lt;code class=&quot;language-text&quot;&gt;$$ $$&lt;/code&gt;来包裹公式&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;algolia搜索&lt;/p&gt;
&lt;p&gt;虽然文章不算多，但是搜个功能还是很有用的，目前只会索引发布的的文章，每次&lt;code class=&quot;language-text&quot;&gt;yarn deploy&lt;/code&gt;的时候会自动更新索引&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;写作规范&quot;&gt;&lt;a href=&quot;#%E5%86%99%E4%BD%9C%E8%A7%84%E8%8C%83&quot; aria-label=&quot;写作规范 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;写作规范&lt;/h2&gt;
&lt;p&gt;在markdown头部定义了很多元数据，每篇文的都应该包含这部分头，以便后续更新&lt;/p&gt;
&lt;p&gt;目前markdown结构和netlify cms后台的目录结构不兼容，应该按目前的目录结构来，即使用本地相对路径图片地址而不是netlify cms的media path&lt;/p&gt;
&lt;p&gt;写作我文章要有深度有内涵&lt;/p&gt;
&lt;h2 id=&quot;seo优化&quot;&gt;&lt;a href=&quot;#seo%E4%BC%98%E5%8C%96&quot; aria-label=&quot;seo优化 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;SEO优化&lt;/h2&gt;
&lt;p&gt;目前网站谷歌统计(google analysis)，谷歌搜索控制台(google search console)，在谷歌搜索控制台后台提交了sitemap和rss，页面上暂时没加太多seo优化代码，没有robot协议文件&lt;/p&gt;
&lt;h2 id=&quot;注意&quot;&gt;&lt;a href=&quot;#%E6%B3%A8%E6%84%8F&quot; aria-label=&quot;注意 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;注意&lt;/h2&gt;
&lt;p&gt;github personal page 只能把master分支当作gh-pages分支，所以不要白费劲去设置别的分支了，netlify后台配置了source分支更新的hook，travis监听的也是source分支，一改都得改&lt;/p&gt;</content:encoded></item><item><title><![CDATA[linux桌面设置]]></title><link>https://joeyxf.com/posts/linux-desktop-setup/</link><guid isPermaLink="false">https://joeyxf.com/posts/linux-desktop-setup/</guid><pubDate>Tue, 11 Dec 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;从大二开始使用 linux 系统，最早接触的系统是 ubuntu 11.10，那会儿刚买到自己的笔记本厌倦了普通的 windows 系统所以装了 ubuntu 双系统把玩，不得不说体验很好，导致接下来一直都在用 linux，直到现在物理机上只有 linux。类似话题的博客写过好几篇了，这篇当作个总结吧，之前写的零散的文章就可以删掉了&lt;/p&gt;
&lt;h2 id=&quot;我的-linux-历程&quot;&gt;&lt;a href=&quot;#%E6%88%91%E7%9A%84-linux-%E5%8E%86%E7%A8%8B&quot; aria-label=&quot;我的 linux 历程 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;我的 linux 历程&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;11 年 3 月上大一的时候买了第一台 Acer 笔记本，一开始只有 windows 系统&lt;/li&gt;
&lt;li&gt;11 年 10 月份左右因为沉迷游戏，觉得很羞愧开始把游戏都卸载了，并且了解到了 ubuntu 操作系统，开始安装 linux&lt;/li&gt;
&lt;li&gt;体验各色 linux，ubuntu 11.10 unity, mint, opensuse, gentoo/funtoo, sentific linux, calculate linux, antergos, arch, netbsd, freebsd, chromeos&lt;/li&gt;
&lt;li&gt;体验了各色桌面环境，unity, gnome3, gnome2, kde5, mate, lxde, xfce4, xmonad&lt;/li&gt;
&lt;li&gt;安装方式经历了嵌入到 windows 之中，双系统，虚拟机，单独的系统&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;到目前为止我在一台 xps 15 9570 上面使用 arch，使用 gnome3+wayland 桌面&lt;/p&gt;
&lt;h2 id=&quot;基础配置&quot;&gt;&lt;a href=&quot;#%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE&quot; aria-label=&quot;基础配置 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;基础配置&lt;/h2&gt;
&lt;h3 id=&quot;shell&quot;&gt;&lt;a href=&quot;#shell&quot; aria-label=&quot;shell permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;SHELL&lt;/h3&gt;
&lt;p&gt;安装完系统之后，首先需要配置的是 fish，之前也用过 zsh，但是觉得不如 fish 好用，配置也简单，一键安装就行&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; pacman -S fish

chsh -s /usr/bin/fish&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;终端&quot;&gt;&lt;a href=&quot;#%E7%BB%88%E7%AB%AF&quot; aria-label=&quot;终端 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;终端&lt;/h3&gt;
&lt;p&gt;默认的 gnome terminal 就很好&lt;/p&gt;
&lt;h3 id=&quot;终端复用器&quot;&gt;&lt;a href=&quot;#%E7%BB%88%E7%AB%AF%E5%A4%8D%E7%94%A8%E5%99%A8&quot; aria-label=&quot;终端复用器 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;终端复用器&lt;/h3&gt;
&lt;p&gt;最早的时候没概念只知道使用&lt;code class=&quot;language-text&quot;&gt;Ctrl+Alt+T&lt;/code&gt;让终端生成新的标签，后来使用了 tmux，发现功能非常强大，很提高效率&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; pacman -S tmux&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这个软件安装完了之后需要额外配置，不然默认界面非常丑&lt;/p&gt;
&lt;h3 id=&quot;输入法&quot;&gt;&lt;a href=&quot;#%E8%BE%93%E5%85%A5%E6%B3%95&quot; aria-label=&quot;输入法 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;输入法&lt;/h3&gt;
&lt;p&gt;最早的时候用 ibus+sunpinyin，现在用 fcitx+rime,sougou-pinyin,google-pinyin，配置比较简单但是很繁琐，linux 下的拼音输入法还是太落后了，有时间想自己写一个&lt;/p&gt;
&lt;h3 id=&quot;代码编辑器&quot;&gt;&lt;a href=&quot;#%E4%BB%A3%E7%A0%81%E7%BC%96%E8%BE%91%E5%99%A8&quot; aria-label=&quot;代码编辑器 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;代码编辑器&lt;/h3&gt;
&lt;p&gt;最早是 vim 党，后来用 emacs，现在用 code，因为 code 也是开箱即用，不需要额外配置，方便的很&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;aurman -S visual-studio-code-bin&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;浏览器&quot;&gt;&lt;a href=&quot;#%E6%B5%8F%E8%A7%88%E5%99%A8&quot; aria-label=&quot;浏览器 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;浏览器&lt;/h3&gt;
&lt;p&gt;最早的时候 linux 内置的浏览器只有 firefox，后来发现 chromium 支持也很好，所以现在一直在用 chromium，因为可以使用谷歌帐号同步信息&lt;/p&gt;
&lt;h3 id=&quot;非对称加密&quot;&gt;&lt;a href=&quot;#%E9%9D%9E%E5%AF%B9%E7%A7%B0%E5%8A%A0%E5%AF%86&quot; aria-label=&quot;非对称加密 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;非对称加密&lt;/h3&gt;
&lt;p&gt;我使用 ed25519 的加密算法生成的密钥对，我用这对密钥来进行ssh身份认证，git也配置了自动签名，也是用的这对密钥&lt;/p&gt;
&lt;h2 id=&quot;性能优化&quot;&gt;&lt;a href=&quot;#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96&quot; aria-label=&quot;性能优化 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;性能优化&lt;/h2&gt;
&lt;h3 id=&quot;挂起与休眠&quot;&gt;&lt;a href=&quot;#%E6%8C%82%E8%B5%B7%E4%B8%8E%E4%BC%91%E7%9C%A0&quot; aria-label=&quot;挂起与休眠 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;挂起与休眠&lt;/h3&gt;
&lt;p&gt;这个特性可以节省很多电量，但是需要额外的配置，首先一个就是要配置一个比ram稍大的swap分区，我目前是32G的内存，配置了34G的swap，在配置swap的时候要注意不要把swap配置到root分区的左边，这样不好做未来的扩容，最好是把swap放到整个硬盘的最右边。然后配置hibernate，需要配置grub指定resume分区，并且给cpio加上resume的hook。配置完之后编辑 &lt;code class=&quot;language-text&quot;&gt;/etc/systemd/sleep.conf&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;[Sleep]
AllowSuspend=yes
AllowHibernation=yes
AllowSuspendThenHibernate=yes
AllowHybridSleep=yes
HibernateDelaySec=180min
SuspendMode=suspend
SuspendState=disk
HibernateMode=suspend
HibernateState=disk&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这样就省电了，可以通过 &lt;code class=&quot;language-text&quot;&gt;sudo systemctl suspend&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;sudo systemctl hibernate&lt;/code&gt; 测试挂起和休眠&lt;/p&gt;
&lt;h3 id=&quot;使用nvidia-gpu&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8nvidia-gpu&quot; aria-label=&quot;使用nvidia gpu permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用nvidia GPU&lt;/h3&gt;
&lt;p&gt;最早为了省电是把gpu禁用了，但是后来发现把这块1050Ti的GPU禁用掉太浪费了，启用的话可以用cuda来做计算，或者可以配置本地的软件使用gpu，提高性能。目前我是设置是开机默认禁用nvidia，关机的时候也自动把nvidia关掉。从arch wiki上面找了2个自动启用gpu和自动关闭gpu的脚本，按需使用&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; enablegpu.sh
&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; disablegpu.sh

lsmod &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;grep&lt;/span&gt; nvidia &lt;span class=&quot;token comment&quot;&gt;# 查询是否正确加载了驱动&lt;/span&gt;
nvidia-smi &lt;span class=&quot;token comment&quot;&gt;# nvidia 的命令行控制面板，显示当前显存使用情况等&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;测试了简单的cuda程序，以及安装测试了gpu版本的tensorflow，确实速度很快，但是很遗憾截止目前（2019-07-08），wayland, chromium, virtualbox都还不支持nvidia显卡&lt;/p&gt;
&lt;h3 id=&quot;使用super键切换工作区&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8super%E9%94%AE%E5%88%87%E6%8D%A2%E5%B7%A5%E4%BD%9C%E5%8C%BA&quot; aria-label=&quot;使用super键切换工作区 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用super键切换工作区&lt;/h3&gt;
&lt;p&gt;这是一个gnome的bug，&lt;a href=&quot;https://gitlab.gnome.org/GNOME/gnome-shell/issues/1250&quot;&gt;https://gitlab.gnome.org/GNOME/gnome-shell/issues/1250&lt;/a&gt;，新版本已经修复了，如把本地遇到这个bug要通过&lt;code class=&quot;language-text&quot;&gt;dconf-editor&lt;/code&gt;重置这几个按键，或者根据issue里面的方式使用一个脚本更新&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;1&lt;span class=&quot;token punctuation&quot;&gt;..&lt;/span&gt;9&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; gsettings &lt;span class=&quot;token keyword&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;org.gnome.shell.keybindings&quot;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;switch-to-application-&lt;span class=&quot;token variable&quot;&gt;$i&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;[]&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;优化rime输入法&quot;&gt;&lt;a href=&quot;#%E4%BC%98%E5%8C%96rime%E8%BE%93%E5%85%A5%E6%B3%95&quot; aria-label=&quot;优化rime输入法 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;优化rime输入法&lt;/h3&gt;
&lt;p&gt;自定义词库，配置颜文字&lt;/p&gt;
&lt;h3 id=&quot;更换网卡&quot;&gt;&lt;a href=&quot;#%E6%9B%B4%E6%8D%A2%E7%BD%91%E5%8D%A1&quot; aria-label=&quot;更换网卡 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;更换网卡&lt;/h3&gt;
&lt;p&gt;使用intel AX200，5.1以上内核不需要额外安装驱动 &lt;a href=&quot;https://wireless.wiki.kernel.org/en/users/drivers/iwlwifi&quot;&gt;https://wireless.wiki.kernel.org/en/users/drivers/iwlwifi&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;连接vpn&quot;&gt;&lt;a href=&quot;#%E8%BF%9E%E6%8E%A5vpn&quot; aria-label=&quot;连接vpn permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;连接vpn&lt;/h2&gt;
&lt;p&gt;用过pptp, openvpn，这2者都算是标准的vpn协议，最近要用北大的vpn，使用的是第三方的某种小众vpn协议，费了一番手脚，最后用&lt;code class=&quot;language-text&quot;&gt;openconnect&lt;/code&gt;这个软件成功连上了&lt;/p&gt;</content:encoded></item><item><title><![CDATA[使用azure devops]]></title><link>https://joeyxf.com/posts/azure-devops-tutorial/</link><guid isPermaLink="false">https://joeyxf.com/posts/azure-devops-tutorial/</guid><pubDate>Thu, 06 Dec 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;介绍一下如何使用 azure devops pipeline 实现自己的 CI/CD&lt;/p&gt;
&lt;h2 id=&quot;整体步骤&quot;&gt;&lt;a href=&quot;#%E6%95%B4%E4%BD%93%E6%AD%A5%E9%AA%A4&quot; aria-label=&quot;整体步骤 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;整体步骤&lt;/h2&gt;
&lt;h3 id=&quot;注册账号&quot;&gt;&lt;a href=&quot;#%E6%B3%A8%E5%86%8C%E8%B4%A6%E5%8F%B7&quot; aria-label=&quot;注册账号 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;注册账号&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;注册 azure.com 的账号&lt;/li&gt;
&lt;li&gt;开通 devops 服务&lt;/li&gt;
&lt;li&gt;访问 &lt;a href=&quot;https://dev.azure.com&quot;&gt;https://dev.azure.com&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;创建组织&lt;/li&gt;
&lt;li&gt;创建项目&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;创建-build-pipeline&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA-build-pipeline&quot; aria-label=&quot;创建 build pipeline permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建 build pipeline&lt;/h3&gt;
&lt;p&gt;用于CI使用，会自动生成一个yml文件&lt;/p&gt;
&lt;h3 id=&quot;创建-deploy-pipeline&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA-deploy-pipeline&quot; aria-label=&quot;创建 deploy pipeline permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建 deploy pipeline&lt;/h3&gt;
&lt;p&gt;部署的时候用，基本流程是&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;在azure管理后台创建一个部署组&lt;/li&gt;
&lt;li&gt;把这个部署组关联指定的机器，在第一步的时候会生成一段命令，粘贴到自己的部署服务器上就行&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[flowable工作流引擎使用入门]]></title><link>https://joeyxf.com/posts/flowable-bpm-tutorial/</link><guid isPermaLink="false">https://joeyxf.com/posts/flowable-bpm-tutorial/</guid><pubDate>Sun, 02 Dec 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;业务流程引擎（business process engine, bpm）在很多地方都有很广泛的应用，尤其是处理复杂多变的业务场景更是方便，因为对于很明确的需求可以硬编码实现业务逻辑，但是对于未知的复杂多变的业务场景，就需要上bpm了，这样能根据实际业务流程建模，从而处理更加复杂的任务&lt;/p&gt;
&lt;p&gt;bpm和workflow engine有相似之处，但是bpm偏向于处理大规模业务逻辑，而workflow engine比较适合处理单一工作流，因为实际业务中经常是多条工作流交织在一起，所以还是bpm比较强大。最近因为工作原因调研了一下这个领域，有点收获做个笔记&lt;/p&gt;
&lt;h2 id=&quot;开源的bpm套件&quot;&gt;&lt;a href=&quot;#%E5%BC%80%E6%BA%90%E7%9A%84bpm%E5%A5%97%E4%BB%B6&quot; aria-label=&quot;开源的bpm套件 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;开源的bpm套件&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;jbpm 红帽公司负责研发的&lt;/li&gt;
&lt;li&gt;activity 从jbpm出来的那波人搞得&lt;/li&gt;
&lt;li&gt;flowable activity核心人员离职出来搞的&lt;/li&gt;
&lt;li&gt;camunda 德国一家公司开发的，最初也是从activity fork出来的，不过现在已经偏离很大了&lt;/li&gt;
&lt;li&gt;zeebe camunda这家公司开发的新项目，据说性能更高，但是目前（2018-12-02）还处于开发阶段&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;开源的workflow-engine&quot;&gt;&lt;a href=&quot;#%E5%BC%80%E6%BA%90%E7%9A%84workflow-engine&quot; aria-label=&quot;开源的workflow engine permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;开源的workflow engine&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;airflow 最流行的workflow engine，不过主要是用于大数据场景，用来执行各种复杂的构建任务或者ETL&lt;/li&gt;
&lt;li&gt;cadence uber开源的go语言实现的工作流引擎，支持解析yml文件生成工作流&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;云服务&quot;&gt;&lt;a href=&quot;#%E4%BA%91%E6%9C%8D%E5%8A%A1&quot; aria-label=&quot;云服务 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;云服务&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;kissflow 最有名的云服务莫过于这家了，印度厂商，基于GAE部署的，国内肯定是用不了，而且每人每月9刀也太贵了&lt;/li&gt;
&lt;li&gt;qingflow 国内类似kissflow的一家创业公司搞的，目前看来功能还比较初级，但是在国内来说做得算比较好了&lt;/li&gt;
&lt;li&gt;aws step functions 亚马逊云的一个服务，不是专门处理企业级业务流程的，但是因为实现了一个状态机，如果配合aws其他服务比如api gateway, lambda function也能实现分步业务流程，不过目前（2018-12-02）中国区还没有开启step function这个服务&lt;/li&gt;
&lt;li&gt;azure logic apps 微软云的服务，类似于aws step functions的实现，但是噱头是更适合企业应用开发，我注册了账号体验但是感觉不如aws简单&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;在我进行技术选型的时候，首先就把kissflow排除了，因为国内访问不了GAE，而qingflow太小的创业公司，数据交给他们不放心，aws和azure虽然是大厂数据安全有保障但是毕竟提供的服务太原始，要基于它们开发自己的应用还是有比较大工作量的。cadence我仔细研究了一下，功能还是比较强大的，代码很简单使用很方便，但是目前来说最大的问题是没法查询进行中的工作流的内部状态，比如说一个审批流执行到第二阶段了，cadence就知道流程在进行中但是不知道进行到哪一步了，具体可见&lt;a href=&quot;https://github.com/uber/cadence/issues/350&quot;&gt;https://github.com/uber/cadence/issues/350&lt;/a&gt;这个issue，都一年了还没解决这个问题，对于我来说审批流程可视化是基础功能，缺少这个功能就暂时不考虑了。剩下在bpm套件中选择，zeebe不考虑，太初级不稳定，jbpm和activity也不考虑，毕竟核心人员都跳槽到flowable团队去了，我试用了flowable和camunda，虽然camunda算是业内比较牛逼的公司客户也很多，但是这软件做得不太敢苟同，界面很丑陋，本地化功能没做好，而且开发版功能缺失而企业版又需要花钱买授权所以也不考虑。flowable试用之后挺震撼的，虽然是一个完全开源的项目，但是代码质量很高，而且开发节奏也很稳定，在youtube搜到一个他们17年的演讲视频，是介绍如何引入AI做一些决策辅助操作的，做bpm的也要与时俱进，佩服。&lt;/p&gt;
&lt;p&gt;接下来简单说说如何使用flowable&lt;/p&gt;
&lt;h2 id=&quot;使用flowable&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8flowable&quot; aria-label=&quot;使用flowable permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用flowable&lt;/h2&gt;
&lt;h3 id=&quot;使用docker安装&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8docker%E5%AE%89%E8%A3%85&quot; aria-label=&quot;使用docker安装 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用docker安装&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;docker run -p 8080:8080 flowable/all-in-one&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;从docker hub下载全部服务一体包，里面包含：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;http://localhost:8080/flowable-idm&quot;&gt;Flowable IDM&lt;/a&gt; 身份管理服务&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://localhost:8080/flowable-modeler&quot;&gt;Flowable Modeler&lt;/a&gt; 建模器&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://localhost:8080/flowable-task&quot;&gt;Flowable Task&lt;/a&gt; 任务管理服务&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://localhost:8080/flowable-admin&quot;&gt;Flowable Admin&lt;/a&gt; 管理员平台&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;添加用户&quot;&gt;&lt;a href=&quot;#%E6%B7%BB%E5%8A%A0%E7%94%A8%E6%88%B7&quot; aria-label=&quot;添加用户 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;添加用户&lt;/h3&gt;
&lt;p&gt;以管理员身份访问IDM创建用户，或者是添加组，把用户分配到组，默认账号是admin密码是test&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/00c3ee2fb6b915cdad2347c4fc545e91/ce9fa/flowable-idm-1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 52.16068167985392%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABCUlEQVQoz+WPS0+DQBSF+f8aU60GWyW2xKIuDCt/gCs3uvAV01KbUQoqBUorMCwKxztFyPhKuvcmX859zZkZZautQ7DZ7sIwTfROz6AeHGG3c4LGnkH5Mba1HnY0g9RYanP/kPZ1rKkaGq0O1lUdG2oLTa0LxfNDlATwwwDBNMKEcua8wbzo4+bBwvV9HxYbY/jk1DwKnl2MCIvZOL+6xeXdAAqk4ClHvljILTIPMRgyMDrovExg00Vj16sRte14sEY23FcfSlEUkBFR50TKM8RxCk76HieYRvNlnaZlP5rNkSTlnGdZaSibVPUX45Wj+GlY5ZXmeY7vv/gLsbuSodz79V2fs39q+AEGMvi35yvfoQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;用户管理平台&quot;
        title=&quot;&quot;
        src=&quot;/static/00c3ee2fb6b915cdad2347c4fc545e91/f570d/flowable-idm-1.png&quot;
        srcset=&quot;/static/00c3ee2fb6b915cdad2347c4fc545e91/0783d/flowable-idm-1.png 240w,
/static/00c3ee2fb6b915cdad2347c4fc545e91/782f4/flowable-idm-1.png 480w,
/static/00c3ee2fb6b915cdad2347c4fc545e91/f570d/flowable-idm-1.png 960w,
/static/00c3ee2fb6b915cdad2347c4fc545e91/8d0ff/flowable-idm-1.png 1440w,
/static/00c3ee2fb6b915cdad2347c4fc545e91/ce9fa/flowable-idm-1.png 1643w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;创建流程模型&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA%E6%B5%81%E7%A8%8B%E6%A8%A1%E5%9E%8B&quot; aria-label=&quot;创建流程模型 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建流程模型&lt;/h3&gt;
&lt;p&gt;创建好用户分配好角色与权限后再创建流程模型，flowable支持bpmn2.0标准来建模业务流程&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5ba67e32add059c29f5caded54e89968/e1c95/flowable-modeler-1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 42.09511568123393%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsSAAALEgHS3X78AAAA+0lEQVQoz61QTWvCQBDdX96eilSkxsRS1GiltQUvHnpuf0EV+mHQWLpNDiHJIf6ARPe5M2oIIXrqg8ebmX3zYEfUjB4Mu4/heIJ2/xlG5wGW/cQ0eyO0uo+50vvN3RCN2wGuzA6urS5q5j0uGxYumm3UWzaEs/rD58LF7MvBt/urKZlzPZ8flDysP17eOytdu6QSo7cPGC/veJ0uIaCRKSDdKPwHhFIKm+2eVJcZRRGklPA8D0EQcB+GIWuWZdqDg3evHHhEOYwQxzF83+dACkqSBMl6zUqB5T1RHFTVtJSmKeuR1BOLvvzLp25RNJ1D2SfOmapuWnWWYugO5clWTCNYKQIAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;模型构建器&quot;
        title=&quot;&quot;
        src=&quot;/static/5ba67e32add059c29f5caded54e89968/f570d/flowable-modeler-1.png&quot;
        srcset=&quot;/static/5ba67e32add059c29f5caded54e89968/0783d/flowable-modeler-1.png 240w,
/static/5ba67e32add059c29f5caded54e89968/782f4/flowable-modeler-1.png 480w,
/static/5ba67e32add059c29f5caded54e89968/f570d/flowable-modeler-1.png 960w,
/static/5ba67e32add059c29f5caded54e89968/8d0ff/flowable-modeler-1.png 1440w,
/static/5ba67e32add059c29f5caded54e89968/e1c95/flowable-modeler-1.png 1556w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;建模的时候会要关联表单，通过这种图形化的操作，设计各个环节的表单很方便&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5b47ce20d9ae547953e17692c1fd54be/9cb53/flowable-modeler-2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 59.32423651721898%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAABSklEQVQoz6WS207CQBCG+/JGDYaTxQCVEERNvPDGCxOfwBgiIAISS/RKaApJoZQeaOF3Z7CNh4sCTvJnd6bTb2d2RzrMKEgqJVSvb5CvXOEoV0aqcIa0UCpfQVY5x/HpBa9y6RKZYhXJkzIOZAX72QISYr+XLiKRk3kvPb/0cffQQq2joqu+o95+Re2pi8dWD81uHw3hNzprNUUO+XWOqWv/61u794bb+zYkCFsGAUzTRGiDwQemkwmwWmFbY+BsNhOQITzPE4wVbNuG4zi8Usz3/VgtFgsEorAIOBxqDCNZlsUwSiLgJnJdl8EMJICu6+KEJQPn8zmLknYCUnuGYXBFZHSfdMimFYZ5EZAAo9Hozx3u3DIBNE2LKqTq6JBt2v4BpB/pUeiVwkf6F5AqG4/HHKSWaf3edjgWcYrGhhyqKhyb3xbG40T2CYWHjNwaGHaaAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;表单设计界面&quot;
        title=&quot;&quot;
        src=&quot;/static/5b47ce20d9ae547953e17692c1fd54be/f570d/flowable-modeler-2.png&quot;
        srcset=&quot;/static/5b47ce20d9ae547953e17692c1fd54be/0783d/flowable-modeler-2.png 240w,
/static/5b47ce20d9ae547953e17692c1fd54be/782f4/flowable-modeler-2.png 480w,
/static/5b47ce20d9ae547953e17692c1fd54be/f570d/flowable-modeler-2.png 960w,
/static/5b47ce20d9ae547953e17692c1fd54be/8d0ff/flowable-modeler-2.png 1440w,
/static/5b47ce20d9ae547953e17692c1fd54be/9cb53/flowable-modeler-2.png 1539w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;发起一个流程&quot;&gt;&lt;a href=&quot;#%E5%8F%91%E8%B5%B7%E4%B8%80%E4%B8%AA%E6%B5%81%E7%A8%8B&quot; aria-label=&quot;发起一个流程 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;发起一个流程&lt;/h3&gt;
&lt;h3 id=&quot;在任务平台处理各自的任务&quot;&gt;&lt;a href=&quot;#%E5%9C%A8%E4%BB%BB%E5%8A%A1%E5%B9%B3%E5%8F%B0%E5%A4%84%E7%90%86%E5%90%84%E8%87%AA%E7%9A%84%E4%BB%BB%E5%8A%A1&quot; aria-label=&quot;在任务平台处理各自的任务 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;在任务平台处理各自的任务&lt;/h3&gt;
&lt;h3 id=&quot;在管理平台查看任务状态&quot;&gt;&lt;a href=&quot;#%E5%9C%A8%E7%AE%A1%E7%90%86%E5%B9%B3%E5%8F%B0%E6%9F%A5%E7%9C%8B%E4%BB%BB%E5%8A%A1%E7%8A%B6%E6%80%81&quot; aria-label=&quot;在管理平台查看任务状态 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;在管理平台查看任务状态&lt;/h3&gt;</content:encoded></item><item><title><![CDATA[docker开发最佳实践]]></title><description><![CDATA[最近需要使用到confluent的kafka streams，由于他们是使用docker提供服务的，所以重新规划了一下本地的docker环境，和上游保持一致，避免环境不一致导致太大的差异]]></description><link>https://joeyxf.com/posts/docker-dev-best-practice/</link><guid isPermaLink="false">https://joeyxf.com/posts/docker-dev-best-practice/</guid><pubDate>Thu, 19 Jul 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;docker 的使用方式有很多，很多发行版都带了 docker 软件包，比如说在 archlinux 上就可以执行&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; pacman -S docker&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;按照 wiki 上的说法配置好环境然后就能执行命令了，但是这种方法不通用，比如说换了机器或者是本地配置有差，都可能需要重新弄一次，所以有人就出了一个&lt;code class=&quot;language-text&quot;&gt;docker-machine&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;docker-machine&lt;/code&gt;的原理是让 docker 跑在本地的虚拟机里面，比如说本地开一个 virtualbox 虚拟机，然后在虚拟机里面操作 docker，这种方式不污染本地环境&lt;/p&gt;
&lt;p&gt;使用很简单，按照官方的教程一步一步来：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;docker-machine create --driver virtualbox default&lt;/code&gt; 创建一台用来操作 docker 的机器&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;docker-machine ls&lt;/code&gt; 列出当前电脑上装的所有 docker 宿主机，理论上来说远程的宿主机也能列出来&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;docker-machine start name&lt;/code&gt; 开启一台宿主机，然后在宿主机里面跑docker，随意安装镜像，环境玩坏了不想要了直接删除这台机器再建一个新的就好，不用担心本机被玩坏&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;eval (docker-machine env default)&lt;/code&gt; 进入default宿主机内，这样就能在宿主机上执行docker命令了&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;安装-confluent-platform&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85-confluent-platform&quot; aria-label=&quot;安装 confluent platform permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装 confluent platform&lt;/h2&gt;
&lt;h3 id=&quot;运行word-count的示例图&quot;&gt;&lt;a href=&quot;#%E8%BF%90%E8%A1%8Cword-count%E7%9A%84%E7%A4%BA%E4%BE%8B%E5%9B%BE&quot; aria-label=&quot;运行word count的示例图 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;运行word count的示例图&lt;/h3&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/107de6264cb09469b0014cd53fbbe535/a987b/docker-with-kafka-streams.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 54.84375%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAACDUlEQVQoz32SW3PSUBSF8+CTIjR3LjJDkUKgIATIDUgISKFMLcVWO6MO3sYfQABvlP++3CdBtA/68M3aZ+ecfVb2PtzP7R22ITuweL35imWwwrfvPw7c7Xb0fYvNZoP1eoPVao3lMqB4jWC1QkD7l0EQwg1vPsO//vSHlx/hzSP6TK8+wJ0t4F2+Q/9qQbn3ke7j7ou36BHt8SvcfqGC6WcexLIDvmyAr5hINXzIlItXOjjSHCRKNuJEotxBQqPciUlYB2LHrZAH6Rpaoxm4jP4car1PRXpQ6h7SxhiqPYVgTSBRLLZGSDdHkKsepFMXcqUHiZBZTIhsTfq4YOJyMQcnazZkcsJU2iMaIwjOeahicwC5OYRUcwk6TO5ZHJ2LUMh9PN+CNXkNLm+OodANKjlQQ3WRrPvkOkL5TWMA9YAf7k/WvIMeFW04F2+ooHUe9k2oOhBrHepnFwL1iieEkhPC/6UH9nsY7MzDvIH25BacPpij7E6RMhwouo20HjkQqj2Ip1S8wuhEsDW1Ryxa92BtiuV0GGc34J6aZ3hCQxE1C/yJQU6oh4RQZGszVFGLcv+CzSB23IRJT4erejNkdR/F7gRab4osTTpF7rLkMt8eUexCoML/LUjP7lGuGTn0JtfIN4YodAao+FNkzCkU+r0cTbdkj5GjyzI03STl+EKbihv3YH8lESp9Y4/9F+C8ZEr9szQyAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;word count&quot;
        title=&quot;&quot;
        src=&quot;/static/107de6264cb09469b0014cd53fbbe535/f570d/docker-with-kafka-streams.png&quot;
        srcset=&quot;/static/107de6264cb09469b0014cd53fbbe535/0783d/docker-with-kafka-streams.png 240w,
/static/107de6264cb09469b0014cd53fbbe535/782f4/docker-with-kafka-streams.png 480w,
/static/107de6264cb09469b0014cd53fbbe535/f570d/docker-with-kafka-streams.png 960w,
/static/107de6264cb09469b0014cd53fbbe535/8d0ff/docker-with-kafka-streams.png 1440w,
/static/107de6264cb09469b0014cd53fbbe535/a987b/docker-with-kafka-streams.png 1920w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;截图中最上面一屏是 word count的process程序，第二屏运行的是kafka的消费程序，word count process程序把计算结果写入到输出流，被消费程序读出，第三屏展示的是一个命令行的生产者，把一个一个的单词输入到输入流中，每有一个输入就会被实时消费，这样第二屏中的输出就会立刻被更新。第四屏展示的是&lt;code class=&quot;language-text&quot;&gt;docker-compose ps&lt;/code&gt;的输出，显示当前运行的docker进程，因为使用的官方的配置文件，所以端口映射啥的都不用管，有一个需要注意的点，因为是多个容器组合运行，所以不建议采用手动指明host的方式来访问服务，比如说在&lt;code class=&quot;language-text&quot;&gt;kafka-console-producer --broker-list localhost:9092 --topic streams-plaintext-input&lt;/code&gt;这条命令中不要用&lt;code class=&quot;language-text&quot;&gt;localhost:9092&lt;/code&gt;来访问kafka，要使用&lt;code class=&quot;language-text&quot;&gt;kafka-console-producer --broker-list broker:9092 --topic streams-plaintext-input&lt;/code&gt;，同时运行这么多容器，根本不知道localhost是哪个容器的localhost&lt;/p&gt;
&lt;p&gt;从截图可以看出 kafka streams 用来做实时日志分析很有用&lt;/p&gt;
&lt;h2 id=&quot;使用ksql&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8ksql&quot; aria-label=&quot;使用ksql permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用ksql&lt;/h2&gt;
&lt;h3 id=&quot;创建对应的kafka-topic&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BA%E5%AF%B9%E5%BA%94%E7%9A%84kafka-topic&quot; aria-label=&quot;创建对应的kafka topic permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建对应的kafka topic&lt;/h3&gt;
&lt;p&gt;创建名为users的topic&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;docker-compose &lt;span class=&quot;token function&quot;&gt;exec&lt;/span&gt; broker \
  kafka-topics --create --zookeeper zookeeper:2181 \
  --replication-factor 1 --partitions 1 --topic &lt;span class=&quot;token function&quot;&gt;users&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;创建名为pageviews的topic&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;docker-compose &lt;span class=&quot;token function&quot;&gt;exec&lt;/span&gt; broker \
  kafka-topics --create --zookeeper zookeeper:2181   \
  --replication-factor 1 --partitions 1 --topic pageviews&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;列出当前kafka所有的topic&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;docker-compose &lt;span class=&quot;token function&quot;&gt;exec&lt;/span&gt; broker \
  kafka-topics --zookeeper zookeeper:2181 --list&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;往上面创建的2个topic里面塞入数据&quot;&gt;&lt;a href=&quot;#%E5%BE%80%E4%B8%8A%E9%9D%A2%E5%88%9B%E5%BB%BA%E7%9A%842%E4%B8%AAtopic%E9%87%8C%E9%9D%A2%E5%A1%9E%E5%85%A5%E6%95%B0%E6%8D%AE&quot; aria-label=&quot;往上面创建的2个topic里面塞入数据 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;往上面创建的2个topic里面塞入数据&lt;/h3&gt;
&lt;p&gt;待定，使用producer cli写入&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;docker-compose &lt;span class=&quot;token function&quot;&gt;exec&lt;/span&gt; ksql-datagen \
  ksql-datagen bootstrap-server&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;broker:9092 quickstart&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;pageviews format&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;delimited topic&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;pageviews maxInterval&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;100&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;创建stream&quot;&gt;&lt;a href=&quot;#%E5%88%9B%E5%BB%BAstream&quot; aria-label=&quot;创建stream permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;创建stream&lt;/h3&gt;
&lt;p&gt;开启ksql&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;docker-compose &lt;span class=&quot;token function&quot;&gt;exec&lt;/span&gt; ksql-cli ksql http://ksql-server:8088&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在ksql-cli中执行&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;CREATE STREAM pageviews_original &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;viewtime bigint, userid varchar, pageid varchar&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; WITH \
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;kafka_topic&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;pageviews&apos;&lt;/span&gt;, value_format&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;DELIMITED&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;CREATE TABLE users_original &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;registertime BIGINT, gender VARCHAR, regionid VARCHAR, userid VARCHAR&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; WITH \
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;kafka_topic&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;users&apos;&lt;/span&gt;, value_format&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;JSON&apos;&lt;/span&gt;, key &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;userid&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看ktable信息&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;describe users_original&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看当前的所有stream信息&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;show streams&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看当前所有table信息&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;show tables&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;通过restapi接口查询stream&quot;&gt;&lt;a href=&quot;#%E9%80%9A%E8%BF%87restapi%E6%8E%A5%E5%8F%A3%E6%9F%A5%E8%AF%A2stream&quot; aria-label=&quot;通过restapi接口查询stream permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;通过restapi接口查询stream&lt;/h3&gt;
&lt;p&gt;接口文档见&lt;a href=&quot;https://docs.confluent.io/current/ksql/docs/api.html&quot;&gt;https://docs.confluent.io/current/ksql/docs/api.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;如果别的语言要访问ksql目前看来只能自己实现一套restapi的封装了，遇到过提示stream/table找不到的，按照文档说明给加上bootstrap.servers就行了
8088是ksql-server监听的端口，默认的broker监听的是9092端口&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;curl&lt;/span&gt; -XPOST http://localhost:8088/query/ \
    -H &lt;span class=&quot;token string&quot;&gt;&apos;Accept: application/json&apos;&lt;/span&gt; \
    -H &lt;span class=&quot;token string&quot;&gt;&apos;Content-Type: application/json&apos;&lt;/span&gt; \
    -d &lt;span class=&quot;token string&quot;&gt;&apos;{
        &quot;ksql&quot;: &quot;SELECT * FROM users_original limit 10;&quot;,
        &quot;streamsProperties&quot;: {
            &quot;ksql.streams.auto.offset.reset&quot;: &quot;earliest&quot;
        }
    }&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;CREATE TABLE pageviews_regions WITH &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;value_format&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;avro&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; AS SELECT gender, regionid , COUNT&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;*&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; AS numusers \
FROM pageviews_enriched WINDOW TUMBLING &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;size 30 second&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; GROUP BY gender, regionid HAVING COUNT&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;*&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; 1&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

CREATE STREAM pageviews_enriched AS SELECT users_original.userid AS userid, pageid, regionid, gender \
FROM pageviews_original LEFT JOIN users_original ON pageviews_original.userid &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; users_original.userid&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

CREATE STREAM pageviews_female AS SELECT * FROM pageviews_enriched WHERE gender &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;FEMALE&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

CREATE STREAM pageviews_female_like_89 WITH &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;kafka_topic&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;pageviews_enriched_r8_r9&apos;&lt;/span&gt;, \
value_format&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;DELIMITED&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; AS SELECT * FROM pageviews_female WHERE regionid LIKE &lt;span class=&quot;token string&quot;&gt;&apos;%_8&apos;&lt;/span&gt; OR regionid LIKE &lt;span class=&quot;token string&quot;&gt;&apos;%_9&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

SELECT gender, regionid, numusers FROM pageviews_regions LIMIT 5&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;CREATE TABLE ontime
&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
    Year UInt16,
    Quarter UInt8,
    Month UInt8,
    DayofMonth UInt8,
    DayOfWeek UInt8,
    FlightDate Date,
    UniqueCarrier FixedString&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;7&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;,
    AirlineID Int32,
    Carrier FixedString&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;,
    TailNum String,
    FlightNum String,
    OriginAirportID Int32,
    OriginAirportSeqID Int32,
    OriginCityMarketID Int32,
    Origin FixedString&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;5&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;,
    OriginCityName String,
    OriginState FixedString&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;,
    OriginStateFips String,
    OriginStateName String,
    OriginWac Int32,
    DestAirportID Int32,
    DestAirportSeqID Int32,
    DestCityMarketID Int32,
    Dest FixedString&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;5&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;,
    DestCityName String,
    DestState FixedString&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;2&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;,
    DestStateFips String,
    DestStateName String,
    DestWac Int32,
    CRSDepTime Int32,
    DepTime Int32,
    DepDelay Int32,
    DepDelayMinutes Int32,
    DepDel15 Int32,
    DepartureDelayGroups String,
    DepTimeBlk String,
    TaxiOut Int32,
    WheelsOff Int32,
    WheelsOn Int32,
    TaxiIn Int32,
    CRSArrTime Int32,
    ArrTime Int32,
    ArrDelay Int32,
    ArrDelayMinutes Int32,
    ArrDel15 Int32,
    ArrivalDelayGroups Int32,
    ArrTimeBlk String,
    Cancelled UInt8,
    CancellationCode FixedString&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;1&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;,
    Diverted UInt8,
    CRSElapsedTime Int32,
    ActualElapsedTime Int32,
    AirTime Int32,
    Flights Int32,
    Distance Int32,
    DistanceGroup UInt8,
    CarrierDelay Int32,
    WeatherDelay Int32,
    NASDelay Int32,
    SecurityDelay Int32,
    LateAircraftDelay Int32,
    FirstDepTime String,
    TotalAddGTime String,
    LongestAddGTime String,
    DivAirportLandings String,
    DivReachedDest String,
    DivActualElapsedTime String,
    DivArrDelay String,
    DivDistance String,
    Div1Airport String,
    Div1AirportID Int32,
    Div1AirportSeqID Int32,
    Div1WheelsOn String,
    Div1TotalGTime String,
    Div1LongestGTime String,
    Div1WheelsOff String,
    Div1TailNum String,
    Div2Airport String,
    Div2AirportID Int32,
    Div2AirportSeqID Int32,
    Div2WheelsOn String,
    Div2TotalGTime String,
    Div2LongestGTime String,
    Div2WheelsOff String,
    Div2TailNum String,
    Div3Airport String,
    Div3AirportID Int32,
    Div3AirportSeqID Int32,
    Div3WheelsOn String,
    Div3TotalGTime String,
    Div3LongestGTime String,
    Div3WheelsOff String,
    Div3TailNum String,
    Div4Airport String,
    Div4AirportID Int32,
    Div4AirportSeqID Int32,
    Div4WheelsOn String,
    Div4TotalGTime String,
    Div4LongestGTime String,
    Div4WheelsOff String,
    Div4TailNum String,
    Div5Airport String,
    Div5AirportID Int32,
    Div5AirportSeqID Int32,
    Div5WheelsOn String,
    Div5TotalGTime String,
    Div5LongestGTime String,
    Div5WheelsOff String,
    Div5TailNum String
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
ENGINE &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; MergeTree&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;FlightDate, &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Year, FlightDate&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;, 8192&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; i &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt; *.zip&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;unzip&lt;/span&gt; -cq &lt;span class=&quot;token variable&quot;&gt;$i&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;*.csv&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sed&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;s/\.00//g&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; clickhouse-client --host&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;example-perftest01j --query&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;INSERT INTO ontime FORMAT CSVWithNames&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[The hitchhiker's guide to python 读书笔记]]></title><description><![CDATA[速读了《The hitchhiker's guide to python》这本书的英文影印版，记录一下读书笔记]]></description><link>https://joeyxf.com/posts/the-hitchhikers-guide-to-python-note/</link><guid isPermaLink="false">https://joeyxf.com/posts/the-hitchhikers-guide-to-python-note/</guid><pubDate>Fri, 09 Mar 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;这不是一本初学者的教程，里面没有涉及太多语法特性，作者主要精力用于描述python编程中的一些最佳实践，以及开发高质量应用的一些经验，如使用pip管理依赖，把组件以vendor的形式发布到网络上，如何跨平台开发，组织代码等&lt;/p&gt;
&lt;h1 id=&quot;目录结构&quot;&gt;&lt;a href=&quot;#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84&quot; aria-label=&quot;目录结构 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;目录结构&lt;/h1&gt;
&lt;h2 id=&quot;13章&quot;&gt;&lt;a href=&quot;#13%E7%AB%A0&quot; aria-label=&quot;13章 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;1~3章&lt;/h2&gt;
&lt;p&gt;前3章讲的是工具性的内容，开发环境，python版本，编辑器，实用小工具等，对于有生产软件开发经验的人基本可以跳过&lt;/p&gt;
&lt;h2 id=&quot;第四章如何写好代码&quot;&gt;&lt;a href=&quot;#%E7%AC%AC%E5%9B%9B%E7%AB%A0%E5%A6%82%E4%BD%95%E5%86%99%E5%A5%BD%E4%BB%A3%E7%A0%81&quot; aria-label=&quot;第四章如何写好代码 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第四章如何写好代码&lt;/h2&gt;
&lt;p&gt;这块的内容也比较浅显通用，如果有几年软件开发经验应该都能体会到，举几个例子：&lt;/p&gt;
&lt;h3 id=&quot;函数定义要保持简短，返回值要尽量保持简单。&quot;&gt;&lt;a href=&quot;#%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89%E8%A6%81%E4%BF%9D%E6%8C%81%E7%AE%80%E7%9F%AD%EF%BC%8C%E8%BF%94%E5%9B%9E%E5%80%BC%E8%A6%81%E5%B0%BD%E9%87%8F%E4%BF%9D%E6%8C%81%E7%AE%80%E5%8D%95%E3%80%82&quot; aria-label=&quot;函数定义要保持简短，返回值要尽量保持简单。 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;函数定义要保持简短，返回值要尽量保持简单。&lt;/h3&gt;
&lt;p&gt;这个很好理解，太长的函数不便于复用，如果返回值太过于复杂了可以考虑抽象&lt;/p&gt;
&lt;h3 id=&quot;函数参数定义要明确，尽量避免传列表和字典&quot;&gt;&lt;a href=&quot;#%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E5%AE%9A%E4%B9%89%E8%A6%81%E6%98%8E%E7%A1%AE%EF%BC%8C%E5%B0%BD%E9%87%8F%E9%81%BF%E5%85%8D%E4%BC%A0%E5%88%97%E8%A1%A8%E5%92%8C%E5%AD%97%E5%85%B8&quot; aria-label=&quot;函数参数定义要明确，尽量避免传列表和字典 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;函数参数定义要明确，尽量避免传列表和字典&lt;/h3&gt;
&lt;p&gt;这个也好理解，因为简单类型可以用类型推导，复杂的类型没法类型推导而且第一眼看过去不知道是什么类型，影响可读性&lt;/p&gt;
&lt;h3 id=&quot;相信开发者都是理性人&quot;&gt;&lt;a href=&quot;#%E7%9B%B8%E4%BF%A1%E5%BC%80%E5%8F%91%E8%80%85%E9%83%BD%E6%98%AF%E7%90%86%E6%80%A7%E4%BA%BA&quot; aria-label=&quot;相信开发者都是理性人 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;相信开发者都是理性人&lt;/h3&gt;
&lt;p&gt;python是一门很灵活的语言，没有提供私有方法私有属性的语法特性，是因为作者相信每个开发者都是理性的，不会滥用语言给开的后门，当然作者给了最佳实践就是用下划线来区分私有，这样看到代码就知道这是个私有方法，别轻易调用后果自负。而且语言给了开发者自由
修改库方法默认行为的权利，所以要自己对自己负责。&lt;/p&gt;
&lt;h3 id=&quot;一些开发中遇到的陷阱&quot;&gt;&lt;a href=&quot;#%E4%B8%80%E4%BA%9B%E5%BC%80%E5%8F%91%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%99%B7%E9%98%B1&quot; aria-label=&quot;一些开发中遇到的陷阱 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;一些开发中遇到的陷阱&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;append_to&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;element&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; to&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    to&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;append&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;element&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; to&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;append_to&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$element&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$to&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token variable&quot;&gt;$to&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$element&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$to&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在python中默认参数是在函数创建时被初始化一次，以后多次调用都使用这一个值
而php不一样，默认参数随着函数每次调用都使用传入的值，在这个例子中是空，个人感觉php的行为更合理点&lt;/p&gt;
&lt;h3 id=&quot;python的装饰器语法&quot;&gt;&lt;a href=&quot;#python%E7%9A%84%E8%A3%85%E9%A5%B0%E5%99%A8%E8%AF%AD%E6%B3%95&quot; aria-label=&quot;python的装饰器语法 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;python的装饰器语法&lt;/h3&gt;
&lt;p&gt;和装饰器模式的概念类似，已有一个咖啡对象，可以通过装饰器模式生成一个加糖的开发对象，也可以生成一个加牛奶的咖啡对象，具体例子见下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;p_decorate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;func&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;func_wrapper&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
       &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&amp;lt;p&gt;{0}&amp;lt;/p&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;func&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; func_wrapper

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;strong_decorate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;func&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;func_wrapper&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&amp;lt;strong&gt;{0}&amp;lt;/strong&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;func&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; func_wrapper

&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;div_decorate&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;func&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;func_wrapper&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&amp;lt;div&gt;{0}&amp;lt;/div&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;func&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; func_wrapper

@div_decorate
@p_decorate
@strong_decorate
&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;get_text&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
   &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;lorem ipsum, {0} dolor sit amet&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;format&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;name&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

get_text &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; div_decorate&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;p_decorate&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;strong_decorate&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;get_text&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这么看来python的装饰器和函数式编程中的高阶函数概念差不多，通过一个函数去组合另一个函数，使得生成的函数包含更多的功能，不过装饰器更加强大的一点是它可以在对象方法里使用&lt;/p&gt;
&lt;h3 id=&quot;文档、测试&quot;&gt;&lt;a href=&quot;#%E6%96%87%E6%A1%A3%E3%80%81%E6%B5%8B%E8%AF%95&quot; aria-label=&quot;文档、测试 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;文档、测试&lt;/h3&gt;
&lt;p&gt;讲了一些测试工具，但是基本思想所有语言都差不多。打包的话可以找现有优质项目的&lt;code class=&quot;language-text&quot;&gt;setup.py&lt;/code&gt;看看&lt;/p&gt;
&lt;h2 id=&quot;第五章-如何读代码&quot;&gt;&lt;a href=&quot;#%E7%AC%AC%E4%BA%94%E7%AB%A0-%E5%A6%82%E4%BD%95%E8%AF%BB%E4%BB%A3%E7%A0%81&quot; aria-label=&quot;第五章 如何读代码 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第五章 如何读代码&lt;/h2&gt;
&lt;p&gt;读代码各人有各人的技巧，现代的编辑器非常强大，善用跳转调试功能，读起来就很方便了，书中介绍了一个工具叫&lt;a href=&quot;http://pycallgraph.slowchop.com/en/master/&quot;&gt;python call graph&lt;/a&gt;用来生成调用图，对复杂的项目还是调试一遍更容易代码&lt;/p&gt;
&lt;h2 id=&quot;第六章&quot;&gt;&lt;a href=&quot;#%E7%AC%AC%E5%85%AD%E7%AB%A0&quot; aria-label=&quot;第六章 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第六章&lt;/h2&gt;
&lt;p&gt;讲了如何打包代码，如何发布到pypi上&lt;/p&gt;
&lt;h2 id=&quot;第七章及以后&quot;&gt;&lt;a href=&quot;#%E7%AC%AC%E4%B8%83%E7%AB%A0%E5%8F%8A%E4%BB%A5%E5%90%8E&quot; aria-label=&quot;第七章及以后 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第七章及以后&lt;/h2&gt;
&lt;p&gt;不想看了，主要介绍了一些开发的工具，如jenkins, travis-ci, numpy, jupyter等&lt;/p&gt;</content:encoded></item><item><title><![CDATA[微信平台开发流程总结]]></title><description><![CDATA[使用过微信开放平台的多种功能，以下进行一个总结备忘...]]></description><link>https://joeyxf.com/posts/wechat-platform-development/</link><guid isPermaLink="false">https://joeyxf.com/posts/wechat-platform-development/</guid><pubDate>Thu, 08 Mar 2018 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;基于微信开放平台的接口可以做很多东西，比如说微信登录、微信支付、现金红包、小程序等，那么微信开发该从哪方面开始呢，这些接口之间有哪些互通的地方，正好最近做了一个微信帐号变更主体相关的工作，来总结一下之前做过的事情&lt;/p&gt;
&lt;h1 id=&quot;名词解释&quot;&gt;&lt;a href=&quot;#%E5%90%8D%E8%AF%8D%E8%A7%A3%E9%87%8A&quot; aria-label=&quot;名词解释 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;名词解释&lt;/h1&gt;
&lt;h2 id=&quot;微信开放平台-官方链接&quot;&gt;&lt;a href=&quot;#%E5%BE%AE%E4%BF%A1%E5%BC%80%E6%94%BE%E5%B9%B3%E5%8F%B0-%E5%AE%98%E6%96%B9%E9%93%BE%E6%8E%A5&quot; aria-label=&quot;微信开放平台 官方链接 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;微信开放平台 &lt;a href=&quot;https://open.weixin.qq.com/&quot;&gt;官方链接&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;微信开放平台是一切微信开发的基础，首先得注册开放平台帐号，可能要填一些公司信息，然后等待微信审核。等帐号审核通过之后，就能创建应用了。网站应用一般指的是H5应用，也可能做到PC端上，如扫码登录，移动应用指的是iOS,android平台的开发，比如说在android上执行微信登录，公众号应用就是创建一个公众号，基本和技术无关。&lt;/p&gt;
&lt;h2 id=&quot;微信公众平台&quot;&gt;&lt;a href=&quot;#%E5%BE%AE%E4%BF%A1%E5%85%AC%E4%BC%97%E5%B9%B3%E5%8F%B0&quot; aria-label=&quot;微信公众平台 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;微信公众平台&lt;/h2&gt;
&lt;p&gt;微信公众平台是微信公众号的管理后台，如发布新的文章，回复粉丝留言，查看数据变更，当然还包括一些基本的开发设置，如&lt;strong&gt;微信登录配置&lt;/strong&gt;，公众号回调的一些配置&lt;/p&gt;
&lt;h2 id=&quot;微信商户平台&quot;&gt;&lt;a href=&quot;#%E5%BE%AE%E4%BF%A1%E5%95%86%E6%88%B7%E5%B9%B3%E5%8F%B0&quot; aria-label=&quot;微信商户平台 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;微信商户平台&lt;/h2&gt;
&lt;p&gt;微信商户平台是给商户对账用的，基本流程是先提交公司信息注册帐号，等微信审核之后就能登录后台，然后会有各种功能，与开发相关的功能有微信支付配置(merchant&lt;em&gt;id, payment&lt;/em&gt;key, 支付证书文件，授权回调域)&lt;/p&gt;
&lt;h1 id=&quot;微信开发的基本流程&quot;&gt;&lt;a href=&quot;#%E5%BE%AE%E4%BF%A1%E5%BC%80%E5%8F%91%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B&quot; aria-label=&quot;微信开发的基本流程 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;微信开发的基本流程&lt;/h1&gt;
&lt;p&gt;一个企业可能会做很多微信相关的产品，比如说小程序，H5页面，服务号，有一点很重要的就是要有微信登录，如果能保证一个公司内部所有微信产品帐号互通当然是更好的了。一个简单的例子见下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;在开放平台注册一个网站应用，填写好对应的app&lt;em&gt;id, app&lt;/em&gt;secret&lt;/li&gt;
&lt;li&gt;在公众平台注册一个服务号，并且在开发-基本配置 中填写好服务器地址、Token、EncodingAESKey，消息模式建议选安全模式&lt;/li&gt;
&lt;li&gt;开始编写服务端的代码，对于php项目来说可以考虑&lt;a href=&quot;https://github.com/overtrue/wechat&quot;&gt;easywechat&lt;/a&gt;，很方便快速开发&lt;/li&gt;
&lt;li&gt;按照文档去开发微信登录接口，oauth的模式基本可以理解为用户访问自己网站的一个链接，重定向到微信授权页面，点击确认之后微信服务器回调自己网站的接口，回调成功之后用户被重定向到新的页面，微信回调这段可以做很多事情，比如说保存微信用户信息，生成本地的jwt token，重定向过程中可以把部分信息通过cookie或者拼接到url上的形式返回给用户&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;以上描述了简单的微信登录接口的开发，微信支付也差不多，不过支付分的方式比较多如公众号支付，APP支付，小程序支付，核心功能都差不多。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[web框架性能测试]]></title><description><![CDATA[最近因为工作原因调研了几款PHP框架，现在主要来做个性能测试...]]></description><link>https://joeyxf.com/posts/web-framework-benchmark-test/</link><guid isPermaLink="false">https://joeyxf.com/posts/web-framework-benchmark-test/</guid><pubDate>Fri, 15 Dec 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;最近因为工作原因调研了几款PHP框架，现在主要来做个性能测试，看看不同框架在不同场景下各有什么优缺点，由于是性能测试，所以先一下我的环境配置:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;markdown&quot;&gt;&lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;CPU: Intel Core i7-7500U @ 4x 3.5GHz [25.0°C]
GPU: Mesa DRI Intel(R) HD Graphics 620 (Kaby Lake GT2)
RAM: 1788MiB / 7865MiB
php: 7.2.0
python: 3.6.3
node: 9.2.0
rustc: 1.24.0-nightly&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;测试工具&lt;a href=&quot;https://www.joedog.org/siege-home/&quot;&gt;siege&lt;/a&gt;&lt;/p&gt;
&lt;h1 id=&quot;lumen&quot;&gt;&lt;a href=&quot;#lumen&quot; aria-label=&quot;lumen permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;lumen&lt;/h1&gt;
&lt;p&gt;lumen号称是速度最快的微服务框架，先测试下这个框架的性能&lt;/p&gt;
&lt;h2 id=&quot;通过命令行生成的未做任何处理的站点&quot;&gt;&lt;a href=&quot;#%E9%80%9A%E8%BF%87%E5%91%BD%E4%BB%A4%E8%A1%8C%E7%94%9F%E6%88%90%E7%9A%84%E6%9C%AA%E5%81%9A%E4%BB%BB%E4%BD%95%E5%A4%84%E7%90%86%E7%9A%84%E7%AB%99%E7%82%B9&quot; aria-label=&quot;通过命令行生成的未做任何处理的站点 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;通过命令行生成的未做任何处理的站点&lt;/h2&gt;
&lt;p&gt;操作：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;markdown&quot;&gt;&lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;lumen new lumen-bench
cd lumen-bench
composer install
composer require php-pm/httpkernel-adapter:dev-maste
./vendor/bin/ppm start --bootstrap=laravel --port=8000 --cgi-path=/usr/bin/php
siege &apos;http://localhost:8000&apos; -d1 -r20 -c20&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;结果：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;markdown&quot;&gt;&lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;Transactions:                    400 hits
Availability:                 100.00 %
Elapsed time:                  13.59 secs
Data transferred:               0.02 MB
Response time:                  0.02 secs
Transaction rate:              29.43 trans/sec
Throughput:                     0.00 MB/sec
Concurrency:                    0.67
Successful transactions:         400
Failed transactions:               0
Longest transaction:            0.10
Shortest transaction:           0.00&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在这里没有用php内建的server而是使用了&lt;a href=&quot;https://github.com/php-pm/php-pm&quot;&gt;php-pm&lt;/a&gt;是因为我用内建的server跑测试，并发上去之后完全没法测，性能太差了，目前看来ppm的性能还不错&lt;/p&gt;
&lt;h2 id=&quot;还是上面的站点，但是稍作修改&quot;&gt;&lt;a href=&quot;#%E8%BF%98%E6%98%AF%E4%B8%8A%E9%9D%A2%E7%9A%84%E7%AB%99%E7%82%B9%EF%BC%8C%E4%BD%86%E6%98%AF%E7%A8%8D%E4%BD%9C%E4%BF%AE%E6%94%B9&quot; aria-label=&quot;还是上面的站点，但是稍作修改 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;还是上面的站点，但是稍作修改&lt;/h2&gt;
&lt;p&gt;操作：&lt;/p&gt;
&lt;p&gt;编辑&lt;code class=&quot;language-text&quot;&gt;bootstrap/app.php&lt;/code&gt;把eloquent开启，再重复上面的步骤&lt;/p&gt;
&lt;p&gt;结果：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;markdown&quot;&gt;&lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;Transactions:                    400 hits
Availability:                 100.00 %
Elapsed time:                  15.45 secs
Data transferred:               0.02 MB
Response time:                  0.02 secs
Transaction rate:              25.89 trans/sec
Throughput:                     0.00 MB/sec
Concurrency:                    0.47
Successful transactions:         400
Failed transactions:               0
Longest transaction:            0.11
Shortest transaction:           0.00&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;我在公司观察到的结果是开启eloquent之后性能大幅降低，但是我在自己电脑上做测试却不能复现了，难道是php-pm的优化做得比较好？&lt;/p&gt;
&lt;h2 id=&quot;laravel&quot;&gt;&lt;a href=&quot;#laravel&quot; aria-label=&quot;laravel permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;laravel&lt;/h2&gt;
&lt;p&gt;操作：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;markdown&quot;&gt;&lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;laravel new laravel-bench
cd laravel-bench
composer install
composer require php-pm/httpkernel-adapter:dev-maste
./vendor/bin/ppm start --bootstrap=laravel --port=8000 --cgi-path=/usr/bin/php
siege &apos;http://localhost:8000&apos; -d1 -r20 -c20&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;结果：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;markdown&quot;&gt;&lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;Transactions:                    400 hits
Availability:                 100.00 %
Elapsed time:                  15.81 secs
Data transferred:               0.01 MB
Response time:                  0.04 secs
Transaction rate:              25.30 trans/sec
Throughput:                     0.00 MB/sec
Concurrency:                    1.08
Successful transactions:         400
Failed transactions:               0
Longest transaction:            0.33
Shortest transaction:           0.00&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;目前简单看来平均访问时间比lumen慢了一倍，但是总体性能还是不错的，可能是php-pm的帮助吧&lt;/p&gt;
&lt;h2 id=&quot;flask&quot;&gt;&lt;a href=&quot;#flask&quot; aria-label=&quot;flask permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;flask&lt;/h2&gt;
&lt;p&gt;操作：&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;hello.py&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; flask &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Flask
app &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Flask&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;__name__&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

@app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;route&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;hello_world&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;Hello, World!&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;markdown&quot;&gt;&lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;pip install Flask
set -x FLASK_APP hello.py
python -m flask run
siege &apos;http://localhost:5000&apos; -d1 -r20 -c20&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;结果:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;markdown&quot;&gt;&lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;Transactions:                    400 hits
Availability:                 100.00 %
Elapsed time:                  15.40 secs
Data transferred:               0.00 MB
Response time:                  0.01 secs
Transaction rate:              25.97 trans/sec
Throughput:                     0.00 MB/sec
Concurrency:                    0.37
Successful transactions:         400
Failed transactions:               0
Longest transaction:            0.05
Shortest transaction:           0.00&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;真令人吃惊，在20个并发的情况下python表现良好，而且响应速度非常快，而且内建的http server比php的要好多了，如果在复杂应用上还能维持这个表现那就太棒了&lt;/p&gt;
&lt;h2 id=&quot;django&quot;&gt;&lt;a href=&quot;#django&quot; aria-label=&quot;django permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Django&lt;/h2&gt;
&lt;p&gt;操作：
按照django文档上介绍的使用django-admin生成的一个简单站点，懒得改代码，连资源文件也一起返回了&lt;/p&gt;
&lt;p&gt;结果:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;markdown&quot;&gt;&lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;Transactions:                    800 hits
Availability:                 100.00 %
Elapsed time:                  17.95 secs
Data transferred:               6.48 MB
Response time:                  0.05 secs
Transaction rate:              44.57 trans/sec
Throughput:                     0.36 MB/sec
Concurrency:                    2.11
Successful transactions:         800
Failed transactions:               0
Longest transaction:            1.13
Shortest transaction:           0.00&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;就速度来说比flask慢了很多，但是考虑到返回了html,css,js，所以暂且认为速度还是很快的，比开启了ppm的php还要快，python做web还是挺合适的嘛&lt;/p&gt;
&lt;h2 id=&quot;express&quot;&gt;&lt;a href=&quot;#express&quot; aria-label=&quot;express permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;express&lt;/h2&gt;
&lt;p&gt;操作：&lt;/p&gt;
&lt;p&gt;按照文档写的一个简单的例子&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; express &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;require&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;express&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; app &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;express&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;/&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;req&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; res&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; res&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Hello World!&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

app&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3000&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Example app listening on port 3000!&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;结果:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;markdown&quot;&gt;&lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;Transactions:                    900 hits
Availability:                 100.00 %
Elapsed time:                  21.52 secs
Data transferred:               0.01 MB
Response time:                  0.01 secs
Transaction rate:              41.82 trans/sec
Throughput:                     0.00 MB/sec
Concurrency:                    0.49
Successful transactions:         900
Failed transactions:               0
Longest transaction:            0.08
Shortest transaction:           0.00&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这个速度也是飞快，和flask有得一拼，node的性能以及抗并发能力都不是吹得，就算加到30x30依旧很稳定，考虑到用typescript写代码的体验，我将非常期待使用typescript+express+nodejs开发服务端应用&lt;/p&gt;
&lt;h2 id=&quot;rocket&quot;&gt;&lt;a href=&quot;#rocket&quot; aria-label=&quot;rocket permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Rocket&lt;/h2&gt;
&lt;p&gt;既然做了评测就顺带看看我最喜欢的rust web框架性能如何&lt;/p&gt;
&lt;p&gt;操作:&lt;/p&gt;
&lt;p&gt;执行文档上的hello world例子&lt;/p&gt;
&lt;p&gt;结果:&lt;/p&gt;
&lt;p&gt;siege不知道为什么跑不出结果，所以用ab的结果替代了，上面的结果都是用siege跑出来的，所以以下的这个结论仅仅是看看而已，不具备参考价值，ab发请求的机制我一直觉得不合理，不像是真实的http请求。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;markdown&quot;&gt;&lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;Concurrency Level:      30
Time taken for tests:   0.210 seconds
Complete requests:      900
Failed requests:        0
Total transferred:      148500 bytes
HTML transferred:       11700 bytes
Requests per second:    4294.63 [#/sec] (mean)
Time per request:       6.985 [ms] (mean)
Time per request:       0.233 [ms] (mean, across all concurrent requests)
Transfer rate:          692.01 [Kbytes/sec] received&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;单个请求看平均时间是在6.985ms，性能当之无愧最高，但是不知道为啥用siege就是跑不起来&lt;/p&gt;
&lt;h2 id=&quot;结后语&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E5%90%8E%E8%AF%AD&quot; aria-label=&quot;结后语 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结后语&lt;/h2&gt;
&lt;p&gt;本来还想再压一压ruby on rails的，但是想想又算了，虽然在前几年玩过一会儿ror，但是就现代的web开发来说，ror已经算是落伍了。php做web开发这么受欢迎很大原因应该是开发简单，部署简单导致的，看这个评测就性能来说并没有优势。nodejs的性能也很好，但是在进程管理方面还是比较欠缺，如果长时间运行可能会有内存泄漏，在这个hello world的例子看不出来，但是生产环境应用还是得慎重。python在语言特性，性能方面都很棒，下个框架可以考虑试试。rocket在我看来是未来的框架，把代码编译成可执行文件，不依赖容器就能运行，性能也是非常棒，等对rust更熟悉之后找点简单的项目开始练练手用用&lt;/p&gt;</content:encoded></item><item><title><![CDATA[使用尺取法计算数组中最短连续子数组之和大于某个指定的数]]></title><description><![CDATA[使用尺取法计算数组中最短连续子数组之和大于某个指定的数]]></description><link>https://joeyxf.com/posts/shortest-seq-sum-greater-than-target/</link><guid isPermaLink="false">https://joeyxf.com/posts/shortest-seq-sum-greater-than-target/</guid><pubDate>Fri, 24 Nov 2017 01:16:00 GMT</pubDate><content:encoded>&lt;h2 id=&quot;问题描述&quot;&gt;&lt;a href=&quot;#%E9%97%AE%E9%A2%98%E6%8F%8F%E8%BF%B0&quot; aria-label=&quot;问题描述 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;问题描述&lt;/h2&gt;
&lt;p&gt;给定一个纯数字的数组，以及一个数字，从这个数组中找到一个连续子数组满足连续子数组之和大于或等于这个给定的数字且这个连续子数组的长度最短&lt;/p&gt;
&lt;h2 id=&quot;问题分析&quot;&gt;&lt;a href=&quot;#%E9%97%AE%E9%A2%98%E5%88%86%E6%9E%90&quot; aria-label=&quot;问题分析 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;问题分析&lt;/h2&gt;
&lt;p&gt;已知这个问题最快的解法就是尺取法，所谓尺取就是指先移动右侧索引，找到一个最长的连续子数组，再不断调整左侧索引，找到一个最短的窗口&lt;/p&gt;
&lt;h2 id=&quot;代码示例&quot;&gt;&lt;a href=&quot;#%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B&quot; aria-label=&quot;代码示例 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;代码示例&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;shortest_seq&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;arr&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; Vec&lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt;usize&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; target&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; usize&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;-&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;usize&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; usize&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; usize&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; sum &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; start &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; end &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; len &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; arr&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;let&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;mut&lt;/span&gt; ans &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; len &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;loop&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; sum &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; target &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; end &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; len &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 移动右侧索引，找到一个最长的窗口&lt;/span&gt;
            sum &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; arr&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;end&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            end &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; sum &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; target &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 右侧索引移动到头了但是子数组之和还是更小，说明没有找到这样的子数组，要跳出循环&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        ans &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;min&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ans&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; end &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; start&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 比较2次窗口哪个最短&lt;/span&gt;
        sum &lt;span class=&quot;token operator&quot;&gt;-=&lt;/span&gt; arr&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;start&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 更新子数组之和&lt;/span&gt;
        start &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 移动左侧索引&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; ans &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; len &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 没找到这样的子数组&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ans&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; start&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; end&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果以前没接触过这类问题，第一次做是比较难想到这个解法，不过看过分析之后感觉还是比较简单的。我把具体代码以及单测用例都传到&lt;a href=&quot;https://github.com/xcaptain/rust-algorithms/blob/master/src/iters/shortest_seq.rs&quot;&gt;github&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[elasticsearch基础查询功能]]></title><description><![CDATA[如何搭建部署es服务，使用es进行基本的查询操作，一些简单的例子]]></description><link>https://joeyxf.com/posts/elasticsearch-learning-basics/</link><guid isPermaLink="false">https://joeyxf.com/posts/elasticsearch-learning-basics/</guid><pubDate>Sat, 11 Nov 2017 01:00:00 GMT</pubDate><content:encoded>&lt;h2 id=&quot;简介&quot;&gt;&lt;a href=&quot;#%E7%AE%80%E4%BB%8B&quot; aria-label=&quot;简介 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;简介&lt;/h2&gt;
&lt;p&gt;Elasticsearch是一个高可用的，开源的，支持海量数据读写，搜索和分析的引擎。常见的用途有搜索、日志存储与检索。&lt;a href=&quot;https://www.elastic.co/guide/cn/elasticsearch/guide/current/foreword_id.html&quot;&gt;中文文档&lt;/a&gt;是个开始的好地方&lt;/p&gt;
&lt;h2 id=&quot;搭建部署服务器&quot;&gt;&lt;a href=&quot;#%E6%90%AD%E5%BB%BA%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1%E5%99%A8&quot; aria-label=&quot;搭建部署服务器 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;搭建部署服务器&lt;/h2&gt;
&lt;p&gt;官网上说服务器至少要安装jdk8，但是我自己电脑上使用的是&lt;code class=&quot;language-text&quot;&gt;OpenJDK 9&lt;/code&gt;也能部署，所以应该8以上都能跑。
按照官方文档，ubuntu服务器的安装流程如下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;导入签名&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;wget&lt;/span&gt; -qO - https://artifacts.elastic.co/GPG-KEY-elasticsearch &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; apt-key &lt;span class=&quot;token function&quot;&gt;add&lt;/span&gt; -&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;更新本地软件源&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;deb https://artifacts.elastic.co/packages/5.x/apt stable main&quot;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;tee&lt;/span&gt; -a /etc/apt/sources.list.d/elastic-5.x.list&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;安装并且更新&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; update &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;apt&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;install&lt;/span&gt; elasticsearch&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;启动服务&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sudo&lt;/span&gt; systemctl start elasticsearch&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在ubuntu 16.04机器上，es配置文件存放在&lt;code class=&quot;language-text&quot;&gt;/etc/elasticsearch&lt;/code&gt;目录下，可执行文件和插件等在&lt;code class=&quot;language-text&quot;&gt;/usr/share/elasticsearch/&lt;/code&gt;下，默认情况下es监听的是&lt;code class=&quot;language-text&quot;&gt;localhost:9200&lt;/code&gt;端口&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;基本术语&quot;&gt;&lt;a href=&quot;#%E5%9F%BA%E6%9C%AC%E6%9C%AF%E8%AF%AD&quot; aria-label=&quot;基本术语 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;基本术语&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;集群(cluster):&lt;/strong&gt;
多个es节点，配置了相同的集群名字组成一个集群，集群内可以新增和删除节点&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;节点(node):&lt;/strong&gt;
一个运行中的es实例称为一个节点，一般是一台服务器&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;分片(shard):&lt;/strong&gt;
整个集群中的一部分数据&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;索引(index):&lt;/strong&gt;
索引实际上是指向一个或者多个物理 分片 的 逻辑命名空间，与mysql类比的话可以当作是数据库&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;类型(type):&lt;/strong&gt;
索引中相关的数据放在一个type中，类似mysql中的表&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;文档:&lt;/strong&gt;
type中的一行记录&lt;/p&gt;
&lt;h2 id=&quot;相关开发工具&quot;&gt;&lt;a href=&quot;#%E7%9B%B8%E5%85%B3%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7&quot; aria-label=&quot;相关开发工具 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;相关开发工具&lt;/h2&gt;
&lt;h3 id=&quot;curl&quot;&gt;&lt;a href=&quot;#curl&quot; aria-label=&quot;curl permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;curl&lt;/h3&gt;
&lt;p&gt;使用curl来操作es，或者是其他http客户端&lt;/p&gt;
&lt;h3 id=&quot;elasticdump&quot;&gt;&lt;a href=&quot;#elasticdump&quot; aria-label=&quot;elasticdump permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;elasticdump&lt;/h3&gt;
&lt;p&gt;这个工具用来导出数据很方便，比如说把数据从一个索引导到另一个索引&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;elasticdump --input&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;http://localhost:9200/jtcsm --output&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;http://localhost:9200/jtcsm_nlp --type&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;data&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;insomnia&quot;&gt;&lt;a href=&quot;#insomnia&quot; aria-label=&quot;insomnia permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;insomnia&lt;/h3&gt;
&lt;p&gt;使用&lt;a href=&quot;https://insomnia.rest/&quot;&gt;insomnia&lt;/a&gt;来管理restapi
elasticsearch的所有操作都是基于http api的，使用这个工具可以很方便的管理各种操作的api，比如说新建一个请求用来保存创建index的命令，新建一个请求用来保存创建mapping的命令，得益与insomnia强大的请求分类管理及导出功能，不用一行一行手动敲curl命令，或者是从记事本里复制出curl命令&lt;/p&gt;
&lt;h2 id=&quot;查询语句&quot;&gt;&lt;a href=&quot;#%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5&quot; aria-label=&quot;查询语句 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;查询语句&lt;/h2&gt;
&lt;p&gt;查询语句比较复杂，慢慢看文档去吧&lt;/p&gt;
&lt;h2 id=&quot;中文分词&quot;&gt;&lt;a href=&quot;#%E4%B8%AD%E6%96%87%E5%88%86%E8%AF%8D&quot; aria-label=&quot;中文分词 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;中文分词&lt;/h2&gt;
&lt;p&gt;中文搜索比较麻烦，同义词，近义词，多义词，多音词等等都是要考虑的问题，目前比较有名的分词插件有&lt;a href=&quot;#&quot;&gt;ik&lt;/a&gt;, &lt;a href=&quot;#&quot;&gt;ansj&lt;/a&gt;
看star的话ik这个分词器比较流行，所以打算使用它，人多容易找到问题。ik默认是不支持多义词的，所以需要自定义分词器，把es内置的同义词典功能集成进来，目前同义词典尚不支持热更新，上网搜到了一些热更新的教程但是感觉用处不大，还不如本地词典，更新之后重启服务。&lt;/p&gt;
&lt;h2 id=&quot;搜索优化&quot;&gt;&lt;a href=&quot;#%E6%90%9C%E7%B4%A2%E4%BC%98%E5%8C%96&quot; aria-label=&quot;搜索优化 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;搜索优化&lt;/h2&gt;
&lt;p&gt;目前没有太好的办法，我是添加词库操作的&lt;/p&gt;
&lt;h2 id=&quot;实际例子&quot;&gt;&lt;a href=&quot;#%E5%AE%9E%E9%99%85%E4%BE%8B%E5%AD%90&quot; aria-label=&quot;实际例子 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;实际例子&lt;/h2&gt;
&lt;p&gt;基于大众点评数据做的搜索引擎&lt;/p&gt;</content:encoded></item><item><title><![CDATA[再次基于discourse搭建论坛]]></title><description><![CDATA[重新部署discourse]]></description><link>https://joeyxf.com/posts/rebuild-discourse/</link><guid isPermaLink="false">https://joeyxf.com/posts/rebuild-discourse/</guid><pubDate>Sat, 07 Oct 2017 01:00:00 GMT</pubDate><content:encoded>&lt;p&gt;早在14年的时候就关注过 &lt;a href=&quot;https://github.com/discourse/discourse&quot;&gt;discourse&lt;/a&gt; 并且在自己的服务器上部署过一个小论坛，但是当时精力有限，并且只是当玩具玩的，所以没多久就没有再维护了。
最近工作稍微不那么忙了，有了更多时间思考产品和运营的这块，而且自己业余时间做了几个小项目，突然有了一个想把目前做的这些项目整合起来做一个闭合的生态圈的想法&lt;/p&gt;
&lt;p&gt;整理一下最近做的玩意儿：&lt;/p&gt;
&lt;h2 id=&quot;hspot&quot;&gt;&lt;a href=&quot;#hspot&quot; aria-label=&quot;hspot permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://hspot.iyue.club/&quot;&gt;hspot&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;我称之为热点，或者high点，这个网站是用来做资讯聚合以及订阅的，目前集成了一个爬虫抓取我觉得有意思的资源然后在前台展示&lt;/p&gt;
&lt;h2 id=&quot;discuss&quot;&gt;&lt;a href=&quot;#discuss&quot; aria-label=&quot;discuss permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;a href=&quot;https://discuss.iyue.club/&quot;&gt;discuss&lt;/a&gt;&lt;/h2&gt;
&lt;p&gt;这是今天早上开始搭建的一个discourse的论坛，我打算用来做资讯交流，因为我自己看完新闻之后是喜欢和朋友严肃探讨一下的，网易和头条的评论
喷子太多，而且很多评论没多少价值，不是我喜欢的。国外的reddit, hackernews 上面的评论很多价值都很高，都是用户深思熟虑之后发表上去的，
我希望我能做一个类似的论坛让大家发表严肃的交流&lt;/p&gt;
&lt;h2 id=&quot;slackbot&quot;&gt;&lt;a href=&quot;#slackbot&quot; aria-label=&quot;slackbot permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;slackbot&lt;/h2&gt;
&lt;p&gt;最近喜欢上了做机器人，所以我把hspot和discuss都深度集成了slackbot，未来的考虑是把 &lt;a href=&quot;https://api.ai/&quot;&gt;AI&lt;/a&gt; 给集成进来，让我的机器人更加智能&lt;/p&gt;
&lt;p&gt;接下来重点讲讲我部署discuss的经历吧，毕竟折腾一场，留点纪念。操作其实比较简单，discourse的开发团队很专业，文档，社区都很完善&lt;/p&gt;
&lt;h3 id=&quot;通过docker线上部署discourse站点&quot;&gt;&lt;a href=&quot;#%E9%80%9A%E8%BF%87docker%E7%BA%BF%E4%B8%8A%E9%83%A8%E7%BD%B2discourse%E7%AB%99%E7%82%B9&quot; aria-label=&quot;通过docker线上部署discourse站点 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;通过docker线上部署discourse站点&lt;/h3&gt;
&lt;p&gt;这步操作比较简单，先把docker的仓库拉下来，然后初始化配置，再build站点&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;./discourse-setup&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;./launcher build app&lt;/code&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;配置多站点支持&quot;&gt;&lt;a href=&quot;#%E9%85%8D%E7%BD%AE%E5%A4%9A%E7%AB%99%E7%82%B9%E6%94%AF%E6%8C%81&quot; aria-label=&quot;配置多站点支持 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;配置多站点支持&lt;/h3&gt;
&lt;p&gt;这步稍微需要折腾一下，以前部署php站点是很简单的，因为php服务不吃内存，一台机器上可以部署几十上百个站点，但是对于rails应用来说就不行了，
rails很吃内存，discourse甚至要求服务器至少1G的内存，因为我的机器上已经跑了几个别的站点了，所以我要把这个论坛集成进去，不能让它独占我的
80和443端口。&lt;/p&gt;
&lt;p&gt;通过上面的操作已经生成了一个叫 =containers/app.yml= 的配置文件，把template选项修改成以下的内容&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;templates&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;templates/postgres.template.yml&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;templates/redis.template.yml&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;templates/web.template.yml&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;templates/web.ratelimited.template.yml&quot;&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;## Uncomment these two lines if you wish to add Lets Encrypt (https)&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;##   - &quot;templates/web.ssl.template.yml&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;templates/web.letsencrypt.ssl.template.yml&quot;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;templates/web.socketed.template.yml&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;而且还要把expose的2个端口配置给删掉，容器内不暴露端口而是通过socket与宿主机通信。 rebuild一下，会发现多了一个 =shared/standalone/nginx.http.sock=
文件，修改一下宿主机对应的nginx配置，通过proxy_pass把请求转到这个socket上，就搞定了&lt;/p&gt;
&lt;h2 id=&quot;配置https&quot;&gt;&lt;a href=&quot;#%E9%85%8D%E7%BD%AEhttps&quot; aria-label=&quot;配置https permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;配置https&lt;/h2&gt;
&lt;p&gt;在上面的app.yml文件中注释掉了ssl配置就是因为要把https配置放到宿主机的nginx上，在宿主机上配置https也很简单，轻车熟路通过 =certbox —nginx=
生成ssl证书以及key。这里有个疑问，在proxy_pass过程中是把加密的数据包发给后端了还是把解密之后的数据包发过去了，有空的时候再去了解下，这里存疑。&lt;/p&gt;
&lt;h2 id=&quot;配置邮件服务&quot;&gt;&lt;a href=&quot;#%E9%85%8D%E7%BD%AE%E9%82%AE%E4%BB%B6%E6%9C%8D%E5%8A%A1&quot; aria-label=&quot;配置邮件服务 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;配置邮件服务&lt;/h2&gt;
&lt;p&gt;邮件服务是花了最多时间的，因为 &lt;a href=&quot;https://www.mailgun.com/&quot;&gt;mailgun&lt;/a&gt; 的审核机制太慢了，按照里面的配置一步一步配置好，填好信用卡，配置好自定义域名，到最后还是处于
disabled状态，给客服发工单又是让填各种信息，回答各种问题，要求保证不spam，等到晚上才把我的站点给active了。mailgun提供api和smtp这2种
发邮件的方式，discourse默认用的是smtp发送，只要把smtp的用户名，密码，发送端口填好就行了，虽然官网介绍说api发送比smtp快3倍，但那有怎样呢，
我要到那个量级估计我的信用卡被刷爆了&lt;/p&gt;
&lt;h2 id=&quot;设置主题&quot;&gt;&lt;a href=&quot;#%E8%AE%BE%E7%BD%AE%E4%B8%BB%E9%A2%98&quot; aria-label=&quot;设置主题 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;设置主题&lt;/h2&gt;
&lt;p&gt;主题通过后台的自定义主题功能装了官方提供的一个material design主题&lt;/p&gt;
&lt;h2 id=&quot;设置插件&quot;&gt;&lt;a href=&quot;#%E8%AE%BE%E7%BD%AE%E6%8F%92%E4%BB%B6&quot; aria-label=&quot;设置插件 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;设置插件&lt;/h2&gt;
&lt;p&gt;目前我装了一个官方的slack插件，简单试验了一下效果不错，具体slack配置不提&lt;/p&gt;
&lt;h2 id=&quot;其它&quot;&gt;&lt;a href=&quot;#%E5%85%B6%E5%AE%83&quot; aria-label=&quot;其它 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;其它&lt;/h2&gt;
&lt;p&gt;配置一个这么复杂的论坛不容易，我还有很多东西没弄，比如说cdn，比如说自定义logo,icon，还有首页布局等是待做的&lt;/p&gt;</content:encoded></item><item><title><![CDATA[使用headless chrome进行网页爬取]]></title><description><![CDATA[使用headless chrome进行网页爬取]]></description><link>https://joeyxf.com/posts/headless-chrome-for-web-scraping/</link><guid isPermaLink="false">https://joeyxf.com/posts/headless-chrome-for-web-scraping/</guid><pubDate>Mon, 28 Aug 2017 01:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在使用&lt;a href=&quot;https://scrapy.org/&quot;&gt;scrapy&lt;/a&gt; 编写爬虫的过程中遇到一些动态加载的内容不好抓取，所以研究了一下&lt;a href=&quot;https://chromium.googlesource.com/chromium/src/+/lkgr/headless/README.md&quot;&gt;headless chromium&lt;/a&gt;，如果不用这种方式的话就得手动
破解ajax请求的接口，了解不同网站做的校验规则，使用浏览器解析dom然后分析页面结构是最简单快速的方法了。&lt;/p&gt;
&lt;h2 id=&quot;headless-chromium基本用法&quot;&gt;&lt;a href=&quot;#headless-chromium%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95&quot; aria-label=&quot;headless chromium基本用法 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;headless chromium基本用法&lt;/h2&gt;
&lt;p&gt;根据&lt;a href=&quot;https://developers.google.com/web/updates/2017/04/headless-chrome&quot;&gt;官方教程&lt;/a&gt; 说明，在chromium59版本之后的浏览器自带了无头模式，只要通过命令行执行&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;chromium --headless --disable-gpu&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;就能打开一个无头的浏览器了，如果我想打开某个网页，并且分析完全加载完成的dom结构，那么只要执行&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;chromium --headless --disable-gpu --dump-dom http://www.dianping.com/shop/14198848 &lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; /tmp/14198848.html&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;想要做后续的分析直接分析这个html文件就行了&lt;/p&gt;
&lt;h2 id=&quot;通过selenium来驱动headless-chromium&quot;&gt;&lt;a href=&quot;#%E9%80%9A%E8%BF%87selenium%E6%9D%A5%E9%A9%B1%E5%8A%A8headless-chromium&quot; aria-label=&quot;通过selenium来驱动headless chromium permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;通过selenium来驱动headless chromium&lt;/h2&gt;
&lt;p&gt;python有个叫selenium的包叫作，安装好之后就能操作浏览器了&lt;/p&gt;
&lt;h3 id=&quot;安装依赖&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96&quot; aria-label=&quot;安装依赖 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装依赖&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;sudo pip install selenium&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;示例代码&quot;&gt;&lt;a href=&quot;#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81&quot; aria-label=&quot;示例代码 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;示例代码&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; selenium &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; webdriver
&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; selenium&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;webdriver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;chrome&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;options &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Options

chrome_options &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Options&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
chrome_options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;add_argument&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;--headless&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
chrome_options&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;add_argument&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;--user-agent=some user-agent name&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

driver &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; webdriver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;Chrome&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;chrome_options&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;chrome_options&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
driver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;http://www.dianping.com/shop/59473758&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 返回html&lt;/span&gt;
html &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; driver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;execute_script&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;return document.documentElement.outerHTML&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 读取js全局变量&lt;/span&gt;
shop_config &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; driver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;execute_script&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;return window.shop_config&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token builtin&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;59474758&apos;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;token builtin&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;.html&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;wb&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;as&lt;/span&gt; f&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    f&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;write&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;encode&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;html&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

driver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;save_screenshot&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token builtin&quot;&gt;id&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;.png&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
driver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;close&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;# 关闭chrome进程&lt;/span&gt;
driver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;quit&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;# 关闭chromewebdriver进程&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这段脚本的作用很明显，首先是创建一个headless chromium的浏览器对象，然后用它打开大众点评的一个网页，然后导出dom，写入到一个html文件
中，最后把当前网页截图保存为一个png文件，并且关闭浏览器。竟然还能读取到js的变量，真是太强大了&lt;/p&gt;
&lt;h2 id=&quot;在使用headless-chromium过程中遇到的问题&quot;&gt;&lt;a href=&quot;#%E5%9C%A8%E4%BD%BF%E7%94%A8headless-chromium%E8%BF%87%E7%A8%8B%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98&quot; aria-label=&quot;在使用headless chromium过程中遇到的问题 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;在使用headless chromium过程中遇到的问题&lt;/h2&gt;
&lt;h3 id=&quot;一些引用的资源加载超时，导致整个页面超时&quot;&gt;&lt;a href=&quot;#%E4%B8%80%E4%BA%9B%E5%BC%95%E7%94%A8%E7%9A%84%E8%B5%84%E6%BA%90%E5%8A%A0%E8%BD%BD%E8%B6%85%E6%97%B6%EF%BC%8C%E5%AF%BC%E8%87%B4%E6%95%B4%E4%B8%AA%E9%A1%B5%E9%9D%A2%E8%B6%85%E6%97%B6&quot; aria-label=&quot;一些引用的资源加载超时，导致整个页面超时 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;一些引用的资源加载超时，导致整个页面超时&lt;/h3&gt;
&lt;p&gt;这个问题没有好的解决办法，看到文档上有设置页面ready的配置&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#pagegotourl-options&quot;&gt;https://github.com/GoogleChrome/puppeteer/blob/master/docs/api.md#pagegotourl-options&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/46160929/puppeteer-wait-for-all-images-to-load-then-take-screenshot&quot;&gt;https://stackoverflow.com/questions/46160929/puppeteer-wait-for-all-images-to-load-then-take-screenshot&lt;/a&gt;
但是selenium webdriver没法提供扩展，目前我的解决办法是加了&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;driver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;implicitly_wait&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;# 资源10s没加载完就放弃&lt;/span&gt;
driver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;set_script_timeout&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;# 资源10s没加载完就放弃&lt;/span&gt;
driver&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;set_page_load_timeout&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;  &lt;span class=&quot;token comment&quot;&gt;# 请求30s没完成就放弃&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;不是很好用，最好的办法是绕过这些有加载不了的资源的网页。&lt;/p&gt;
&lt;h3 id=&quot;python程序异常退出导致chrome进程变成僵尸进程&quot;&gt;&lt;a href=&quot;#python%E7%A8%8B%E5%BA%8F%E5%BC%82%E5%B8%B8%E9%80%80%E5%87%BA%E5%AF%BC%E8%87%B4chrome%E8%BF%9B%E7%A8%8B%E5%8F%98%E6%88%90%E5%83%B5%E5%B0%B8%E8%BF%9B%E7%A8%8B&quot; aria-label=&quot;python程序异常退出导致chrome进程变成僵尸进程 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;python程序异常退出导致chrome进程变成僵尸进程&lt;/h3&gt;
&lt;p&gt;正确设置异常处理程序，在出现异常时记得close()和quit()&lt;/p&gt;
&lt;h2 id=&quot;scrapy操作字符串&quot;&gt;&lt;a href=&quot;#scrapy%E6%93%8D%E4%BD%9C%E5%AD%97%E7%AC%A6%E4%B8%B2&quot; aria-label=&quot;scrapy操作字符串 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;scrapy操作字符串&lt;/h2&gt;
&lt;p&gt;通过headless chromium导出的是纯字符串，如果要让它支持xpath解析，需要处理一下，比如：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/27323740/scrapy-convert-html-string-to-htmlresponse-object&quot;&gt;转成HtmlResponse对象&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; scrapy&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;http &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; HtmlResponse

response &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; HtmlResponse&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;url&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;my HTML string&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; body&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;div id=&quot;test&quot;&gt;Test text&amp;lt;/div&gt;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
response&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;xpath&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;//div[@id=&quot;test&quot;]/text()&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;extract&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;strip&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;&lt;a href=&quot;https://stackoverflow.com/questions/8711030/fetch-partial-string-matched-html-tag-using-xpath&quot;&gt;转成lxml对象&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; lxml

html &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;&amp;lt;div id=&quot;test&quot;&gt;Test text&amp;lt;/div&gt;&apos;&lt;/span&gt;
doc &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; lxml&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;html&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;fromstring&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;html&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;使用beautifulsoup操作html&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8beautifulsoup%E6%93%8D%E4%BD%9Chtml&quot; aria-label=&quot;使用beautifulsoup操作html permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用BeautifulSoup操作html&lt;/h2&gt;
&lt;p&gt;bs的api比lxml的易用多了，比如说要新建一个标签，并且添加到某个节点下，lxml就比较难实现了，毕竟html不是标准的xml，看了一下lxml的api感觉比较复杂
就选择了用bs&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; bs4 &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; BeautifulSoup
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; json
soup &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; BeautifulSoup&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;html&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;html5lib&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# add script tag&lt;/span&gt;
script_tag &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; soup&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;new_tag&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;script&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
script_tag&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;append&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;window.globale_config=&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; json&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;dumps&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;global_config&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
soup&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;body&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;insert_before&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;script_tag&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这段代码在body标签的前面新增了一个script标签，标签内部定义了一个全局变量，这样就可以把dom和脚本都保存到本地了&lt;/p&gt;
&lt;p&gt;有了headless chromium之后写爬虫就方便多了，甚至现代的各种SPA应用也不用担心，happy hacking!&lt;/p&gt;</content:encoded></item><item><title><![CDATA[使用rust创建websocket服务器]]></title><description><![CDATA[使用rust做websocket服务器，websocket协议的标准规范，用途等]]></description><link>https://joeyxf.com/posts/rust-websocket-server/</link><guid isPermaLink="false">https://joeyxf.com/posts/rust-websocket-server/</guid><pubDate>Tue, 15 Aug 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;最近需要做实时推送相关的应用，所以继续调研了一下websocket，在15年底的时候曾经使用过 &lt;a href=&quot;https://github.com/sumory/gru&quot;&gt;Gru&lt;/a&gt; 来做聊天推送，
但是那时候没仔细研究过websocket的细节。现在趁机自己构思一下&lt;/p&gt;
&lt;h2 id=&quot;使用-ws-rs-构建websocket服务端&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8-ws-rs-%E6%9E%84%E5%BB%BAwebsocket%E6%9C%8D%E5%8A%A1%E7%AB%AF&quot; aria-label=&quot;使用 ws rs 构建websocket服务端 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用 &lt;a href=&quot;https://github.com/housleyjk/ws-rs&quot;&gt;ws-rs&lt;/a&gt; 构建websocket服务端&lt;/h2&gt;
&lt;p&gt;按照 &lt;a href=&quot;https://ws-rs.org/guide&quot;&gt;Guide&lt;/a&gt; 搭建服务端应用，代码见下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;cargo new ws-server1 --bin&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;crate&lt;/span&gt; ws&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;use&lt;/span&gt; ws&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;listen&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;listen&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;127.0.0.1:3012&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token closure-params&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;move&lt;/span&gt; &lt;span class=&quot;token closure-params&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;msg&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;received msg: {}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; msg&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;broadcast&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;msg&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unwrap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;cargo run&lt;/code&gt; 运行服务端&lt;/p&gt;
&lt;h2 id=&quot;服务端推送&quot;&gt;&lt;a href=&quot;#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E6%8E%A8%E9%80%81&quot; aria-label=&quot;服务端推送 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;服务端推送&lt;/h2&gt;
&lt;p&gt;往socket里面推送消息，代码见下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;cargo new ws-client1 --bin&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;extern&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;crate&lt;/span&gt; ws&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;use&lt;/span&gt; ws&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;connect&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; CloseCode&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;fn&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;connect&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;ws://127.0.0.1:3012&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token closure-params&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;out&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Hello WebSocket&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unwrap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

        &lt;span class=&quot;token keyword&quot;&gt;move&lt;/span&gt; &lt;span class=&quot;token closure-params&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;msg&lt;span class=&quot;token punctuation&quot;&gt;|&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token function&quot;&gt;println!&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;Got message: {}&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; msg&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            out&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;CloseCode&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;Normal&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;unwrap&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;运行 &lt;code class=&quot;language-text&quot;&gt;cargo run&lt;/code&gt;，这时候会看到服务端输出&lt;code class=&quot;language-text&quot;&gt;received msg: Hello WebSocket&lt;/code&gt;，客户端输出&lt;code class=&quot;language-text&quot;&gt;Got message: Hello WebSocket&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;客户端连接&quot;&gt;&lt;a href=&quot;#%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5&quot; aria-label=&quot;客户端连接 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;客户端连接&lt;/h2&gt;
&lt;p&gt;创建2个websocket客户端连接，打开2个chrome标签，分别在终端执行&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;rust&quot;&gt;&lt;pre class=&quot;language-rust&quot;&gt;&lt;code class=&quot;language-rust&quot;&gt;ws &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; new &lt;span class=&quot;token function&quot;&gt;WebSocket&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token lifetime-annotation symbol&quot;&gt;&apos;ws://127.0.0.1:3012&lt;/span&gt;&lt;span class=&quot;token lifetime-annotation symbol&quot;&gt;&apos;);&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 创建连接&lt;/span&gt;
ws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;addEventListener&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token lifetime-annotation symbol&quot;&gt;&apos;message&lt;/span&gt;&lt;span class=&quot;token lifetime-annotation symbol&quot;&gt;&apos;,&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;event&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    console&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;log&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token lifetime-annotation symbol&quot;&gt;&apos;Message&lt;/span&gt; from server &lt;span class=&quot;token lifetime-annotation symbol&quot;&gt;&apos;,&lt;/span&gt; event&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 监听服务端&lt;/span&gt;

ws&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token lifetime-annotation symbol&quot;&gt;&apos;from&lt;/span&gt; browser&lt;span class=&quot;token lifetime-annotation symbol&quot;&gt;&apos;);&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 可以在2个console中互相发消息玩&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;能发现websocket会自动检测连接，如果连接断开会提示 =WebSocket is already in CLOSING or CLOSED state.= 这也省去了手动发送心跳包
检测连接的麻烦&lt;/p&gt;</content:encoded></item><item><title><![CDATA[学习idris]]></title><description><![CDATA[学习idris这门语言的特性，了解依赖类型，强类型语言的优点]]></description><link>https://joeyxf.com/posts/learning-idris/</link><guid isPermaLink="false">https://joeyxf.com/posts/learning-idris/</guid><pubDate>Tue, 06 Jun 2017 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在工作中一直写的是php，偶尔写点javascript, python，动态语言写多了之后发现很多语言本身的问题，导致要通过很多人为的规范来让程序变得可维护。&lt;/p&gt;
&lt;p&gt;目前对php语言的一些感受：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;无类型推导(&lt;a href=&quot;https://en.wikipedia.org/wiki/Type_inference&quot;&gt;Type inference&lt;/a&gt;)&lt;/li&gt;
&lt;li&gt;无确定性异常捕获(&lt;a href=&quot;https://stackoverflow.com/questions/6115896/java-checked-vs-unchecked-exception-explanation&quot;&gt;checked exception&lt;/a&gt;)&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;目前在php7中加入了强类型开关，如果启用了能做部分类型推导，但是目前公司大部分代码还是php5的语法，而且线上环境还未切换到7。其实就算完全用php7
的严格模式开发，要想充分利用到类型推导带来的好处似乎也不太简单，php的创始人做的&lt;a href=&quot;https://github.com/etsy/phan&quot;&gt;phan&lt;/a&gt; 项目还没有发布v1.0版本，再说到处使用array, stdclass
这样的类型来存储变量，phan要实现这种代码的静态分析应该也很吃力，因为php7还不支持 &lt;a href=&quot;https://en.wikipedia.org/wiki/Dependent_type&quot;&gt;dependent type&lt;/a&gt;。看php相关的新闻，最近开发组的工作重心
似乎在jit以及性能优化上，要想做一个完整的类型系统估计还要很久，在这之前能加上一个好用的debugger我就知足了。&lt;/p&gt;
&lt;p&gt;为什么类型推导这么重要呢，举个例子吧。
领导有个需求让实现一个字符串截取功能，你很快就写出来了&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/**
 * 一个很简单的字符串截取函数
 *
 * @param string $str 待处理的字符串
 * @param int $start 开始点
 * @param int $length 截取长度
 * @return string
 */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cut_str&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$str&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$length&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$str&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$length&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;你还特意给这个简单得不能再简单的方法添加了注释文档，但是有一天你在查看程序的日志时发现以下内容:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;PHP warning:  substr() expects parameter 1 to be string, array given on line 1
PHP error:  Undefined variable: a on line 1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果公司做了错误日志收集监控，并且和kpi挂钩的话，那你就惨了，郁闷的你仔细查了一下代码，发现某个队友在调用你的cut_str方法时没有按照你给的注释来
传字符串参数而是传了一个数组过来，你可能会去和那个同事理论，告诉他你的文档里写得很清楚这个方法第一个参数是字符串不能传数组过来，他可能会埋怨你
这个方法写得不严谨没有做好脏数据的异常处理，互相扯皮几句之后还得回去老老实实修改代码，思考了一下之后你可能改成如下的样子:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/**
 * 一个很简单的字符串截取函数
 *
 * @param string $str 待处理的字符串
 * @param int $start 开始点
 * @param int $length 截取长度
 * @return string
 */&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;cut_str&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$str&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$length&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;!&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;is_string&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$str&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// do some log&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$start&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// do some log&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$start&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;str_len&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$str&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// do some log&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$length&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token comment&quot;&gt;// do some log&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;substr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$str&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$start&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$length&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;写完之后你志得意满，新的方法太健壮了，不管猪队友传任何参数过来这个方法都能容错不会挂，而且可以默默的记录一些日志提醒自己有人传了乱七八糟的参数过来，
但是这个方法真的写得好吗？原来一行能搞定的问题被硬生生扩展到了15行，大部分都是冗余的校验，而且把校验，记日志，返回结果这3个职责混在一起做了，违反
了单一职责原则。在这里我们没有考虑抛异常把异常抛给上层去处理，因为这是上面checked exception相关的内容了。&lt;/p&gt;
&lt;p&gt;说了这么多就是想引出idris这们语言，按照官网的介绍：&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Idris is a general purpose pure functional programming language with dependent types. Dependent types allow types to be predicated on values, meaning that some aspects of a program’s behaviour can be specified precisely in the type. It is compiled  with eager evaluation. Its features are influenced by Haskell and ML&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;简单说就是idris实现了一个很强大的类型系统，在编译时能能检测出大部分程序潜在的问题，真正做到once it compiles, it runs.&lt;/p&gt;
&lt;p&gt;用idris重写一下上面那个cut_str方法&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;idris&quot;&gt;&lt;pre class=&quot;language-idris&quot;&gt;&lt;code class=&quot;language-idris&quot;&gt;cut_str : (index : Nat) -&amp;gt; (len : Nat) -&amp;gt; (subject : String) -&amp;gt; String
cut_str = substr&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这时候谁要是写 cut_str 0 2 [“hello”] 这样的代码，编译器直接会报错，没机会走到runtime&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;When checking argument subject to function Main.cut_str:
        Can&amp;#39;t disambiguate since no name has a suitable type:
                Prelude.List.::, Prelude.Stream.::&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这种形式的代码我非常喜欢，方法的参数定义得很明确，功能定义也很明确，如果谁乱调用，那么就将自食其果。&lt;/p&gt;
&lt;p&gt;之前关注过的强类型的语言还有:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;a href=&quot;https://www.learning-idrisw.typescriptlang.org/&quot;&gt;typescrit&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;学习idris这门语言的特性，了解依赖类型，强类型语言的有点&lt;/p&gt;</content:encoded></item><item><title><![CDATA[新入手xps13 9360的体验]]></title><description><![CDATA[双11的时候亚马逊入手了一台xps13 9360，机器配置是i7-7500u，8GB内存，带1920x1080的ips屏。决定删掉默认的win10，全盘安装喜爱的linux]]></description><link>https://joeyxf.com/posts/xps13-9360-first-eye/</link><guid isPermaLink="false">https://joeyxf.com/posts/xps13-9360-first-eye/</guid><pubDate>Sat, 19 Nov 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;双11的时候亚马逊入手了一台xps13 9360，机器配置是i7-7500u，8GB内存，带1920x1080的ips屏。决定删掉默认的win10，全盘安装喜爱的linux&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;安装系统&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;安装软件&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;配置软件&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;同步数据&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[php猴子补丁]]></title><description><![CDATA[php中使用monkey patch以及在ruby和python中是如何做的]]></description><link>https://joeyxf.com/posts/php-monkey-patch/</link><guid isPermaLink="false">https://joeyxf.com/posts/php-monkey-patch/</guid><pubDate>Fri, 30 Sep 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;ruby和python都有&lt;a href=&quot;https://en.wikipedia.org/wiki/Monkey_patch&quot;&gt;monkey patch&lt;/a&gt;，也就是可以在运行时修改某个对象或类的方法&lt;/p&gt;
&lt;p&gt;在过去php是没有这种特性的，如果要给一个对象添加方法只有继承&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token php language-php&quot;&gt;&lt;span class=&quot;token delimiter important&quot;&gt;&amp;lt;?php&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;A&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;foo&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;foo&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token variable&quot;&gt;$obj&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;A&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果在某个情况下，我们要给&lt;code class=&quot;language-text&quot;&gt;$obj&lt;/code&gt;对象添加一个方法，这时候该怎么办呢？&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token php language-php&quot;&gt;&lt;span class=&quot;token delimiter important&quot;&gt;&amp;lt;?php&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;B&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;A&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;bar&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token variable&quot;&gt;$obj&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这样obj对象就有了&lt;code class=&quot;language-text&quot;&gt;bar&lt;/code&gt;方法，但是这种办法很傻，得新建一个子类，而且这个子类可能很难被用上，如果在另外的情况下要用到另一个新的方法&lt;code class=&quot;language-text&quot;&gt;bar2&lt;/code&gt;，这时候又该怎么办呢，是再写一个继承？继承A还是B呢？&lt;/p&gt;
&lt;p&gt;php7提供了一个新的语法叫做&lt;a href=&quot;http://php.net/manual/en/language.oop5.anonymous.php&quot;&gt;匿名类&lt;/a&gt; 在上面的例子中，要给类A的实例添加方法就不需要新建一个类文件然后去继承，直接&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token php language-php&quot;&gt;&lt;span class=&quot;token delimiter important&quot;&gt;&amp;lt;?php&lt;/span&gt;

&lt;span class=&quot;token variable&quot;&gt;$obj&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;A&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;bar&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;bar&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这样obj也有&lt;code class=&quot;language-text&quot;&gt;bar&lt;/code&gt;方法，但是却没有创建额外的类文件，毕竟目的只是作为临时补丁修复一下，如果能够确定这个方法会被很多地方用到，那么就得考虑是否把这个方法添加到基类中，还是放到单独的子类。&lt;/p&gt;
&lt;p&gt;在测试中这特性非常有用，测试&lt;code class=&quot;language-text&quot;&gt;protected&lt;/code&gt;方法，构造&lt;code class=&quot;language-text&quot;&gt;mock&lt;/code&gt;对象而不用改原有代码，第一次在真实场景中见到是在&lt;a href=&quot;https://github.com/spatie/laravel-activitylog&quot;&gt;activity-log&lt;/a&gt;这个项目中&lt;a href=&quot;https://github.com/spatie/laravel-activitylog/blob/master/tests/DetectsChangesTest.php&quot;&gt;https://github.com/spatie/laravel-activitylog/blob/master/tests/DetectsChangesTest.php&lt;/a&gt;这里就构造了仅仅用于测试的model对象而没有改写原有的model&lt;/p&gt;</content:encoded></item><item><title><![CDATA[php多进程处理大任务]]></title><description><![CDATA[在写php脚本的过程中经常会遇到要并行处理大量数据的问题，比如说批量从数据库中处理几万行数据，调用第三方接口处理大数据等等，如果仅仅是循环去处理会导致非常低效，PHP本身是支持多进程的，如果让多个进程同时处理这部分数据就会让性能快很多...]]></description><link>https://joeyxf.com/posts/php-multi-process-task/</link><guid isPermaLink="false">https://joeyxf.com/posts/php-multi-process-task/</guid><pubDate>Fri, 09 Sep 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在写php脚本的过程中经常会遇到要并行处理大量数据的问题，比如说批量从数据库中处理几万行数据，调用第三方接口处理大数据等等，如果仅仅是循环去处理会导致非常低效，PHP本身是支持多进程的，如果让多个进程同时处理这部分数据就会让性能快很多。&lt;/p&gt;
&lt;p&gt;在工作中遇到了一个这样的问题，把它抽象一下作为一个典型的例子记录，方便下次察看。&lt;/p&gt;
&lt;h3 id=&quot;多进程生成csv文件的php脚本&quot;&gt;&lt;a href=&quot;#%E5%A4%9A%E8%BF%9B%E7%A8%8B%E7%94%9F%E6%88%90csv%E6%96%87%E4%BB%B6%E7%9A%84php%E8%84%9A%E6%9C%AC&quot; aria-label=&quot;多进程生成csv文件的php脚本 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;多进程生成csv文件的PHP脚本&lt;/h3&gt;
&lt;p&gt;代码见&lt;a href=&quot;https://gist.github.com/xcaptain/57aa46eaf52a1e0233f04caef1f1df66&quot;&gt;gist&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;简单的说明：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;通过&lt;code class=&quot;language-text&quot;&gt;generateData&lt;/code&gt;方法生成测试数据，目标是把这部分测试数据写入到一个csv文件中&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;通过&lt;code class=&quot;language-text&quot;&gt;devideWork&lt;/code&gt;方法来分割任务，在初始化过程中定义了工作进程数量，生成每个工作进程的任务量也就是pageSize的值&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;在主进程中把csv头部写入文件&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;多进程的核心部分是&lt;code class=&quot;language-text&quot;&gt;runProcess&lt;/code&gt;方法，&lt;code class=&quot;language-text&quot;&gt;pcntl_fork&lt;/code&gt;生成子进程，让子进程执行写csv的操作&lt;code class=&quot;language-text&quot;&gt;writeCsv&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;pcntl_wexitstatus&lt;/code&gt;回收子进程。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;writeCsv&lt;/code&gt;是很慢的操作，但是&lt;code class=&quot;language-text&quot;&gt;pcntl_fork&lt;/code&gt;是很快的，如果一个进程一直等待着执行&lt;code class=&quot;language-text&quot;&gt;writeCsv&lt;/code&gt;就造成了低效，但是均分任务之后就飞快了。&lt;/p&gt;
&lt;h3 id=&quot;什么任务可以多进程执行&quot;&gt;&lt;a href=&quot;#%E4%BB%80%E4%B9%88%E4%BB%BB%E5%8A%A1%E5%8F%AF%E4%BB%A5%E5%A4%9A%E8%BF%9B%E7%A8%8B%E6%89%A7%E8%A1%8C&quot; aria-label=&quot;什么任务可以多进程执行 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;什么任务可以多进程执行&lt;/h3&gt;
&lt;p&gt;自己简单总结一下可以分为:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;任务可以明确分割，如果任务有很复杂的依赖关系，有严格的执行顺序要求，肯定没法并行&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;每一部分任务的结果可以很好的合并，在这里是追加到文件&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;对于php多进程模型的一些推测&quot;&gt;&lt;a href=&quot;#%E5%AF%B9%E4%BA%8Ephp%E5%A4%9A%E8%BF%9B%E7%A8%8B%E6%A8%A1%E5%9E%8B%E7%9A%84%E4%B8%80%E4%BA%9B%E6%8E%A8%E6%B5%8B&quot; aria-label=&quot;对于php多进程模型的一些推测 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;对于PHP多进程模型的一些推测&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;pcntl_fork&lt;/code&gt;生成的子进程是对父进程的深度拷贝，子进程拥有了父进程中的整个对象，每个对象都复制了一份&lt;code class=&quot;language-text&quot;&gt;data&lt;/code&gt;属性&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;子进程无法改变父进程中的变量，在&lt;code class=&quot;language-text&quot;&gt;writeCsv&lt;/code&gt;方法中子进程的&lt;code class=&quot;language-text&quot;&gt;$this-&amp;gt;counter&lt;/code&gt;自增了，但是父进程中的&lt;code class=&quot;language-text&quot;&gt;$this-&amp;gt;counter&lt;/code&gt;没有变化&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;子进程和父进程无法直接通信，必须借助类似文件句柄这样的东西才能共享数据，难怪在unix/linux的设计哲学中文件如此重要&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;几个文件相关的实用小命令&quot;&gt;&lt;a href=&quot;#%E5%87%A0%E4%B8%AA%E6%96%87%E4%BB%B6%E7%9B%B8%E5%85%B3%E7%9A%84%E5%AE%9E%E7%94%A8%E5%B0%8F%E5%91%BD%E4%BB%A4&quot; aria-label=&quot;几个文件相关的实用小命令 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;几个文件相关的实用小命令&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;显示重复行&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;sort&lt;/span&gt; FILE &lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;uniq&lt;/span&gt; -cd&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;删除重复行&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;awk&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;!seen[&lt;span class=&quot;token variable&quot;&gt;$0&lt;/span&gt;]++&apos;&lt;/span&gt; filename&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;删除长度更短的行&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;awk&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;length(&lt;span class=&quot;token variable&quot;&gt;$0&lt;/span&gt;)&gt;3&apos;&lt;/span&gt; filename&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[递归地删除数组里所有多余的空格]]></title><description><![CDATA[在使用jsoneditor的时候遇到一个问题就是总是会把多余的空格写入数据库...]]></description><link>https://joeyxf.com/posts/recursive-remove-space/</link><guid isPermaLink="false">https://joeyxf.com/posts/recursive-remove-space/</guid><pubDate>Sun, 07 Aug 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;在使用&lt;a href=&quot;https://github.com/jdorn/json-editor&quot;&gt;jsoneditor&lt;/a&gt;的时候遇到一个问题就是总是会把多余的空格写入数据库，如：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$a&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;a&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos; hello&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;b&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;world &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;c&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos; he &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;很多情况下我们都不需要开头结尾的空格，有时候空格甚至会带来麻烦，比如说图片地址后面加上空格之后就给前端操作带来麻烦，那么有什么好办法在写入数据库之前先过滤一遍呢？&lt;/p&gt;
&lt;p&gt;对于上面这种对象数组处理方式很简单：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$a&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;array_map&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;trim&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;但是如果数组结构复杂，比如说是二维数组&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$a&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;a&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos; hello&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;b&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;world &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;c&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos; he &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;d&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;a&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos; hello&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;b&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;world &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;c&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos; he &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这时候就要有一个机制能够递归的处理每隔元素内部的空格，思路就是递归，代码见下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$myfunc&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;use&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$myfunc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;is_array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;array_walk&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$myfunc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token variable&quot;&gt;$value&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;trim&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$value&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;array_walk&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$a&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$myfunc&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;普通函数的递归很好写，但是匿名函数的递归就是第一次写来，竟然需要用use来把当前函数导入进闭包里面，而且必需以传引用的方式，php的语法也是丑得可以。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[点赞收藏存储设计]]></title><description><![CDATA[前段时间给自己的业余项目写代码的时候遇到了一个问题就是如何设计点赞，评论，收藏的存储结构。这3个功能是社交软件必不可少的组成部份，但是设计起来确一点都不简单...]]></description><link>https://joeyxf.com/posts/like-and-favorite-design/</link><guid isPermaLink="false">https://joeyxf.com/posts/like-and-favorite-design/</guid><pubDate>Mon, 06 Jun 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;前段时间给自己的业余项目写代码的时候遇到了一个问题就是如何设计点赞，评论，收藏的存储结构。这3个功能是社交软件必不可少的组成部份，但是设计起来确一点都不简单。&lt;/p&gt;
&lt;p&gt;先说评论&lt;/p&gt;
&lt;p&gt;之前在7k做zeze社区的时候我就发现了评论的复杂性，最大的问题是数据量大，以前做社区的时候一个楼层下可以有几万个评论，一个贴子可以有几百个楼层，一个论坛可以有好多贴子，数据增长很快。但是现在app的评论系统都比较简洁，不会像网页那么复杂，如果不支持嵌套回复的话，那就简单多了，表结构设计如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;id: 评论id，自增主键
item_id: 被评论项目的id，int
author_id: 作者id，int
comment: 评论内容，varchar&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这个模型没有解决大数据扩展的问题，但是已经算是非常简洁了，对于未来分表的设想是在中间加一张索引表，映射某一个范围的item&lt;em&gt;id,某个author&lt;/em&gt;id的所有评论到一个分片中，这样按父id，和发布人id来索引评论的时候都简单。&lt;/p&gt;
&lt;p&gt;其次是点赞&lt;/p&gt;
&lt;p&gt;这个问题的难度在于用户可以反复点击，所以要求接口响应足够快，占用资源足够少，不然同时多个用户连续点赞取消赞就会给服务器带来很大的压力了。最初我的设想是把点赞设计为用户和帖子的一个关系，如果用户点赞了某一个帖子，用户就和这个贴子有关系，如果取消了点赞这个关系就断开了。那么点赞表就是一个多对多的关系表了，按帖子和用户查询都可以很快。这种实现的坏处是如果用户反复点击赞接口时，都会有一个查询去判断用户是否赞过这个帖子了，因为所有的产品都是要求用户 不能反复点赞同一个帖子，需要程序自己来维护点赞操作的幂等性，也就是每次写库之前先find一次，如果有就更新时间，如果没有就插入。毫无疑问这个接口会很慢而且占用很多资源，所以要找另一个更优化的方案。我后来决定使用redis的zset来存储点赞信息，以帖子id作为key，以点赞用户的uid作为value，score是点赞时间，由于集合自身是不允许出现重复的value的，所以每次都可以直接zadd把点赞用户更新进去，不需要人工维护数据唯一，太省事了，不过如果还要按用户索引被点赞过的帖子，那就得再新增一个key，以uid作为key，以帖子id作为value，不能支持多字段查询是redis的设计导致的，不过更新2个redis的key可比更新1行mysql快多了，最好使用multi保证原子操作。&lt;/p&gt;
&lt;p&gt;取消赞，收藏，取消收藏我都是用同样的方式做的，只要确保redis服务器不挂，不丢数据就行。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[我的chromebook]]></title><description><![CDATA[今年2月份附近入手的一台二手chromebook，到目前为止已经用了很长一段时间了，打算写一篇文章来总结一下使用体验...]]></description><link>https://joeyxf.com/posts/my-chromebook-review/</link><guid isPermaLink="false">https://joeyxf.com/posts/my-chromebook-review/</guid><pubDate>Sun, 05 Jun 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;今年2月份附近入手的一台二手chromebook，到目前为止已经用了很长一段时间了，打算写一篇文章来总结一下使用体验。&lt;/p&gt;
&lt;p&gt;先来看看我的屏幕截图，目前看起来还觉得挺geek的
&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/fa35a8237fdc03f0f8f6187e1dad0a42/95139/chromebook-htop.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.22254758418741%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAACL0lEQVQozz2PW0/bQBCF1wkRpMRJk9Q4vu3F9vq+G99ip0EpUVpA5bG0atW/QYUocQK0og/0T3cRUqVPR6PRHJ0z4Orqx831dXO7aTbNdtPsNhtBc9vcbe/uH35tHh93fx52vx+a+/tt07yw225/3tz8fXoC+2pvf9TeG0htWer0QKe/15I70ivQHXUP+j3Qk9vjYfvwEHQ6QGqBVgtIkiQUAEwI4N+XzuXM+VQ6n6vw29z5soKXp9HXWuzRSa1muZJlR3l+VJZKUUxmM21eT6rZKM+LD6egzCsEbVOzRoSSYh5HzHNoHPIkDT2OXYawb1KG7BA6EaQM04QIJb757v0ClLPStgk09DeObeVZwjn1KGPMm1pmOIDxyHCGOh1o7sDwXhvBQKOyRvtj3C2WMRB3hqEjhO04TrI8YTyOojRNy1nGsiiZxn5EITG8yAkiSlxkEQMS00RavSiB7/u6rkOMzSCwORfJYRgyxrOC8SK2sKZZqgEnFtbFbEAVkudBh+rb4woURYExRggNbXssctMsCHxhpszU/J5oeIT7E0dWbXniyponOveEKvZBKWrnaYotC5pmH8JhGHLOfOqyKHHCierua17vxTYRr/qyHsiGIOqrtDtbxWC+Wrmcu1GsTqfaYlGerHhVlcfLZJng2iC5hkIFJ88QrpCpYk8VxMZaIM/XKeDrdXV+xtfn/GQVnF24iwUqS1zXuKrsqkJhgCwTIfgfQnCWpVVdX3w8/QdioXFlAIDibgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;终端&quot;
        title=&quot;&quot;
        src=&quot;/static/fa35a8237fdc03f0f8f6187e1dad0a42/f570d/chromebook-htop.png&quot;
        srcset=&quot;/static/fa35a8237fdc03f0f8f6187e1dad0a42/0783d/chromebook-htop.png 240w,
/static/fa35a8237fdc03f0f8f6187e1dad0a42/782f4/chromebook-htop.png 480w,
/static/fa35a8237fdc03f0f8f6187e1dad0a42/f570d/chromebook-htop.png 960w,
/static/fa35a8237fdc03f0f8f6187e1dad0a42/95139/chromebook-htop.png 1366w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;
&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/c68f81d78b4ca505831c771ccd325b63/95139/chromebook-myadmin.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 960px;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.22254758418741%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsSAAALEgHS3X78AAABc0lEQVQoz51Sy07CQBSdb8SvMSAUW1ITATcEBQnRmKAUQlrY+QsuSFy4kT1QZ/p+QVvwdCokLoiJJ5OTM3fu4/SmZDwajZTheKTgKMMXQFEUVVU1TVN/YzqdzmazXEwmk8FgQC4ua2VRLotX50KtJEiVSkUURc6SIAjQ1WpV5CgWS4WzgizLkiThCibauzmcW8O5/fhmvX4Ymyjc7/eu60RRlKZJmqZxHO92OwShfd/PBQJgon9RZpg42zgxTHO1WgVBwBh1PQ+pfhA4juN5HoJhGKJjwAHteS5hjOE54gORtNlsMCdJspl/griui4LtdsvdZhqV8WkkHD/FtmXBBGIohivLstAitwp2OXLhcCCOSZgB84RSintyKF4sPinFp9DlcmkYBlag67rJd5FFGYXG03q9Nhgjtm3nTmApW0gUQeS9cz6KI0eHNALr+/+CNG+aD/edTqffvb1rdfuNev263mi12/UTaDSavV4v+xOfn74BUos3F+UjGmAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;myadmin&quot;
        title=&quot;&quot;
        src=&quot;/static/c68f81d78b4ca505831c771ccd325b63/f570d/chromebook-myadmin.png&quot;
        srcset=&quot;/static/c68f81d78b4ca505831c771ccd325b63/0783d/chromebook-myadmin.png 240w,
/static/c68f81d78b4ca505831c771ccd325b63/782f4/chromebook-myadmin.png 480w,
/static/c68f81d78b4ca505831c771ccd325b63/f570d/chromebook-myadmin.png 960w,
/static/c68f81d78b4ca505831c771ccd325b63/95139/chromebook-myadmin.png 1366w&quot;
        sizes=&quot;(max-width: 960px) 100vw, 960px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;终端模拟器是用的chrome的一个插件叫做crosh window&lt;/p&gt;
&lt;p&gt;linux虚拟机是用crouton安装的ubuntu16.04 core,可惜是共享内核的，所以ubuntu的内核也是3.10.18的&lt;/p&gt;
&lt;p&gt;一些常用工具包括：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;fish，我最喜欢的shell&lt;/li&gt;
&lt;li&gt;tmux，终端复用软件，可以开启多个会话&lt;/li&gt;
&lt;li&gt;ss，用来上网的，开启之后chromebook也可以共享上网，真不错&lt;/li&gt;
&lt;li&gt;emacs，我最爱的编辑器，之前crouton遇到最大的问题是中文输入法，有了emacs之后我可以用自带的pyim来输入中文了，没必要使用chromebook自带的输入法&lt;/li&gt;
&lt;li&gt;开发环境，nginx, mysql, php7, python, rvm等等之类的&lt;/li&gt;
&lt;li&gt;数据库连接是用一个叫做myadmin的chrome扩展实现的&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;遇到的问题：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;cpu性能太差劲，我的lenovon21用的cpu是intel n2840的，一款低功耗的arm架构双核cpu，在打开多个浏览器标签时资源使用率总是达到100%，我在编译代码的时候就更费劲了，昨晚编译hakyll花了1个多小时，用公司的thinkpad t440s编译大概10分钟能搞定&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;显示器太渣，现在应该没有720p的笔记本显示器了吧，看着觉得很糢糊&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;机身是黑色塑料的，看起来很廉价，没有chromebook pixel和mac book pro那么银光闪闪&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;还是cpu太差劲，平时敲代码打字都有明显的卡顿了&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;总结一下：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;google是一家非常伟大的公司，感谢他们发明了chromebook这么伟大的产品&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;联想是美帝良心企业，在国内就买不到chromebook，国内的thinkpad价格也要比美帝高出一截&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;n21还算是一款性价比非常好的本子，就是性能有点弱，17年再换一个16年出的二手chromebook玩玩&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[php使用guzzle发送http请求]]></title><description><![CDATA[最原始的发送http请求的方法是调用原生的curl扩展，这就需要在php.ini中允许`extension=curl.so`，使用方式也很简单，下面是几个发送基本GET, POST请求的例子...]]></description><link>https://joeyxf.com/posts/php-guzzle-http-client/</link><guid isPermaLink="false">https://joeyxf.com/posts/php-guzzle-http-client/</guid><pubDate>Thu, 28 Apr 2016 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;最原始的发送http请求的方法是调用原生的curl扩展，这就需要在php.ini中允许
&lt;code class=&quot;language-text&quot;&gt;extension=curl.so&lt;/code&gt;，使用方式也很简单，下面是几个发送基本GET, POST请求的例子。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;curl 发送GET请求:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;curl_init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;curl_setopt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;CURLOPT_HEADER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 不返回http头&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;curl_setopt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;CURLOPT_RETURNTRANSFER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 按字符串返回而不是输出到屏幕上&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;curl_setopt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;CURLOPT_TIMEOUT&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 设置连接超时时间&lt;/span&gt;
&lt;span class=&quot;token variable&quot;&gt;$result&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;curl_exec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;curl_close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;curl 发送POST请求:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;curl_init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;curl_setopt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;CURLOPT_POST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// 表明是发送post请求&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;curl_setopt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;CURLOPT_POSTFIELDS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$jsonString&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;// post的数据，支持json字符串和http_build_query之后的参数&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;curl_setopt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;CURLOPT_RETURNTRANSFER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean constant&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token variable&quot;&gt;$result&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;curl_exec&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;curl_close&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;curl上传文件:
也是一个post请求，例子见下面&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;curl_init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;curl_setopt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;CURLOPT_POST&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;curl_setopt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;CURLOPT_POSTFIELDS&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
&lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;file&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;CurlFile&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$fullFileName&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$mimeType&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$filename&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;param1&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$value1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;param2&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$value2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;curl_setopt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;CURLOPT_RETURNTRANSFER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;curl_setopt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token constant&quot;&gt;CURLOPT_HTTPHEADER&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
&lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;Content-type: multipart/form-data;&apos;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token variable&quot;&gt;$result&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;curl_exec &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
curl_close &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$ch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;第一次使用curl上传文件的时候还遇到了一点小问题，网上大部分写法都是用&lt;code class=&quot;language-text&quot;&gt;&amp;#39;file&amp;#39; =&amp;gt; @&amp;quot;$fullFileName&amp;quot;&lt;/code&gt;来加载文件的，我用这种写法反复测试了很久都不能获取到真是的文件，后来才发现&lt;a href=&quot;https://secure.php.net/manual/en/class.curlfile.php&quot;&gt;CurlFile&lt;/a&gt;这个类，按照文档下面评论的说法，php发送multipart请求的时候会有问题，解决办法有2个，1：允许&lt;code class=&quot;language-text&quot;&gt;CURLOPT_SAFE_UPLOAD&lt;/code&gt;， 2：使用CURLFile 而不是 ”@”&lt;/p&gt;
&lt;p&gt;我偏好的http请求库 &lt;a href=&quot;https://github.com/guzzle/guzzle&quot;&gt;guzzle&lt;/a&gt;
作为一个应用开发者而言，更多的封装往往是更好的，curl太原始了，接口太少，选项太多，如果要发一个post请求，得先去查一下如何设置数据，如何设置请求头，返回值说明什么意思，如何表示20x, 30x, 40x, 50x的状态码，但是作为一个http库选择就更少了，我们只要知道如何创建请求对象，如何发送请求，响应对象，异常是什么就够了，知道了这几个概念如果要发送一种特殊请求只需要修改请求对象就行了&lt;/p&gt;
&lt;p&gt;请求对象:&lt;/p&gt;
&lt;p&gt;一个简单的GET请求的对象&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$request&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;GuzzleHttp&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;Psr7&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;Request&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;GET&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;http://httpbin.org&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;一个简单的POST请求的对象&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$request&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;GuzzleHttp&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;Psr7&lt;span class=&quot;token punctuation&quot;&gt;\&lt;/span&gt;Request&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;POST&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;http://httpbin.org&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;一个简单的发送multipart/form-data请求上传文件的例子&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$r&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$client&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;POST&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
    &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;multipart&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;name&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;file&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;contents&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;name&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;user_id&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;contents&apos;&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;发送请求：
首先要有一个客户端对象，这个对象能够发送一个请求对象，然后获得响应&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$client&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;Client&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;发送请求：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$client&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;send&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$request&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;在调试curl发请求的时候还发现了一个小技巧抓包，用&lt;code class=&quot;language-text&quot;&gt;nc -l -p 8888&lt;/code&gt;开启一个监听端口，然后把curl的请求地址设置为&lt;code class=&quot;language-text&quot;&gt;http://127.0.0.1:8888&lt;/code&gt;，这样就能抓到php发送http请求的数据了，总之guzzle比curl强大太多，能用就多用。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[创建自己的composer组建]]></title><description><![CDATA[最近在做服务重构与模块化的工作，以前的老代码太多复制粘贴的东西，需要整理一下，否则将来项目就不可维护了...]]></description><link>https://joeyxf.com/posts/create-composer-package/</link><guid isPermaLink="false">https://joeyxf.com/posts/create-composer-package/</guid><pubDate>Tue, 15 Dec 2015 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;最近在做服务重构与模块化的工作，以前的老代码太多复制粘贴的东西，需要整理一下，否则
将来项目就不可维护了&lt;/p&gt;
&lt;p&gt;涉及到的服务有：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;api 主要的接口模块，大部分客户端交互由这个接口完成&lt;/li&gt;
&lt;li&gt;image 图片服务，图片上传下载压缩等操作&lt;/li&gt;
&lt;li&gt;chat 聊天服务&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;目前的架构就是这样的，等将来还可以继续拆分api接口，独立出更多小功能&lt;/p&gt;
&lt;p&gt;在api和image中都会用到mq来与后端的java服务通信，原来的实现是自己封装的mq，同一个功能实现2次，
现在抽象出mq功能作为一个公共库，让这2个服务都能调用同一个mq的库。&lt;/p&gt;
&lt;p&gt;主要涉及到的工具是composer，真是一个强大的武器。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;创建库&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;新建一个目录，&lt;code class=&quot;language-text&quot;&gt;mkdir mqpackage&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;切换进目录执行&lt;code class=&quot;language-text&quot;&gt;composer init&lt;/code&gt; 根据提示内容创建&lt;code class=&quot;language-text&quot;&gt;composer.json&lt;/code&gt;文件&lt;/li&gt;
&lt;li&gt;按照要求自己编辑这个json文件，比较重要的就是require和autoload这块&lt;/li&gt;
&lt;li&gt;然后就是敲代码了&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;提交package到git仓库&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;因为是在公司里开发的项目，不敢放到github上，推送到内部的git服务器了&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;配置项目的composer.json文件，引入刚刚新增的库&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;在项目的&lt;code class=&quot;language-text&quot;&gt;composer.json&lt;/code&gt;文件中的require区域加上上面的包要注意的就是要在repository里面加上这个包的地址，因为默认会从packgist上面拉&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;重新测试一遍原有的2个服务的功能&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;创建单元测试写测试是很重要的，尤其是写这种公共库，我也是对照这phpunit的文档一点一点的敲测试用例的&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[博客从octopress迁移到hakyll]]></title><description><![CDATA[之前的博客是使用octopress搭建的，这个静态站点生成器最大的好处就是简单，不需要自己额外的hack，装好octopress，简单设置好之后就能使用,而且提交，部署都有...]]></description><link>https://joeyxf.com/posts/switch-to-hakyll/</link><guid isPermaLink="false">https://joeyxf.com/posts/switch-to-hakyll/</guid><pubDate>Thu, 10 Dec 2015 00:00:00 GMT</pubDate><content:encoded>&lt;h3 id=&quot;准备完全迁移到hakyll上面了&quot;&gt;&lt;a href=&quot;#%E5%87%86%E5%A4%87%E5%AE%8C%E5%85%A8%E8%BF%81%E7%A7%BB%E5%88%B0hakyll%E4%B8%8A%E9%9D%A2%E4%BA%86&quot; aria-label=&quot;准备完全迁移到hakyll上面了 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;准备完全迁移到hakyll上面了&lt;/h3&gt;
&lt;p&gt;之前的博客是使用octopress搭建的，这个静态站点生成器最大的好处就是简单，不需要自己额外的hack，装好octopress，简单设置好之后就能使用，而且提交，部署都有
现成的工具，主题也有很多，所以一用就用了一年多。从7月份开始就有点厌倦octopress了，因为不喜欢这么傻瓜式的东西，咱们的目标是to be a geeker，当然不能一直
不进步。hakyll算是非常极客的一个工具了，haskell写的，使用pandoc处理文本，而且配置文件完全是haskell代码，想着能用这么geek的语言，玩这么geek的软件，就
非常激动。&lt;/p&gt;
&lt;p&gt;使用hakyll也非常简单，步骤是:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;cabal install hakyll&lt;/code&gt; 安装hakyll，这一步非常耗时，因为自己的笔记本CPU落伍了。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;hakyll-init blog&lt;/code&gt; 会在当前目录下创建一个叫作blog的目录。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;cd blog&lt;/code&gt; 进入这个目录，会发现有一系列文件，这是默认的博客站点。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;cabal build&lt;/code&gt; 默认会build这个haskell站点，生成站点可执行文件。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;dist/build/site/site build&lt;/code&gt; 会编译&lt;code class=&quot;language-text&quot;&gt;posts/&lt;/code&gt;下面的文件，生成html文件到&lt;code class=&quot;language-text&quot;&gt;_site/posts/&lt;/code&gt;下面。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;dist/build/site/site watch&lt;/code&gt; 会开启一个web服务器，默认访问地址是&lt;a href=&quot;http://127.0.0.1:4000/&quot;&gt;http://127.0.0.1:4000/&lt;/a&gt; 点击访问，然后就你发现默认的首页了。&lt;/li&gt;
&lt;li&gt;默认站点好了接下来就是迁移原博客的文章，从原来的git仓库中把所有的markdown文件复制到&lt;code class=&quot;language-text&quot;&gt;posts/&lt;/code&gt;下面。&lt;/li&gt;
&lt;li&gt;再次试着build整个站点，这时候可能会有点问题，我这里因为有的文章元数据中categories:熟悉为空报了几个错，改完就好了。&lt;/li&gt;
&lt;li&gt;配置博客站点，修改站点外观，添加rss和tag页，我用的是&lt;a href=&quot;https://github.com/eakron/variadic.me&quot;&gt;variadic&lt;/a&gt;的配置，很简单，配置文件改动很小但是
却把我要的功能都实现了，真的很厉害。&lt;/li&gt;
&lt;li&gt;再次build，并且watch新的项目，顺利跑通了之后，但是看不到标签，很奇怪，原来老的文章是使用categories作为标签名的，现在使用tags了，自然要改。
&lt;code class=&quot;language-text&quot;&gt;sed -i &amp;#39;s/categories\:/tags\:/g&amp;#39;&lt;/code&gt; 一行sed命令，批量替换，真不错。&lt;/li&gt;
&lt;li&gt;博客在本地搭好了，并且预览过了，接下来就是部署到线上，还是用github-pages。那么我就需要2个分支，一个source分支用来存放静态站点的代码，包括站点
配置，原始markdown格式的博文，这样将来要换到别的机器上，直接clone source分支的代码下来build就行了。还有一个分支是master分支，这个分支存放build之后
的文件，也就是所有的静态文件，html, css, js, 图片等。因为我线上已经有一个博客站点了，所以只需要添加远程github仓库就行。
&lt;code class=&quot;language-text&quot;&gt;cd blog&lt;/code&gt;进入我的博客根目录，执行&lt;code class=&quot;language-text&quot;&gt;git init .&lt;/code&gt; 添加版本控制, &lt;code class=&quot;language-text&quot;&gt;git add .&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;git commit -m &amp;#39;first commit&amp;#39;&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;git checkout -b source&lt;/code&gt;切换到
source分支，然后删掉master分支&lt;code class=&quot;language-text&quot;&gt;git branch -d master&lt;/code&gt;，因为代码只要保存在source，master只能放生成的静态文件。&lt;code class=&quot;language-text&quot;&gt;git remote add origin git@github.com:xcaptain/xcaptain.github.io&lt;/code&gt;添加我的远程仓库，
要注意编辑.gitignore文件，把&lt;em&gt;site, _tmp, _cache都忽略掉。然后是&lt;code class=&quot;language-text&quot;&gt;git submodule add git@github.com:xcaptain/xcaptain.github.io.git _site/&lt;/code&gt;把
线上的master分支作为我的一个模块，克隆到&lt;/em&gt;site目录下。再执行一下&lt;code class=&quot;language-text&quot;&gt;dist/build/site/site build&lt;/code&gt;会生成新的静态文件写入&lt;em&gt;site/目录，当然那些老的文件不会被
删掉，比如说我之前的CNAME文件，favicon文件都还留着，这时候&lt;code class=&quot;language-text&quot;&gt;cd _site/&lt;/code&gt;然后再提交一下。本地所有的代码都干净之后就是推送部署了。在&lt;code class=&quot;language-text&quot;&gt;blog/&lt;/code&gt;目录下执行
&lt;code class=&quot;language-text&quot;&gt;git push origin source&lt;/code&gt;把当前分支推送到origin的source分支，然后再切换到`&lt;/em&gt;site/&lt;code class=&quot;language-text&quot;&gt;目录，执行&lt;/code&gt;git push origin master`把生成的静态文件推送到线上的
master分支。访问&lt;a href=&quot;http://blog.iyue.club&quot;&gt;http://blog.iyue.club&lt;/a&gt;开测，真不错。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;虽然说没有了octopress那么多做好的功能，但是通过折腾hakyll学习到了很多知识，等以后优化这个部署流程的时候可以自己写脚本部署，省得总是自己多次写shell命令&lt;/p&gt;
&lt;h3 id=&quot;update-2017-05-05&quot;&gt;&lt;a href=&quot;#update-2017-05-05&quot; aria-label=&quot;update 2017 05 05 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Update 2017-05-05:&lt;/h3&gt;
&lt;p&gt;模板重写，使用了&lt;a href=&quot;https://github.com/oxalorg/sakura&quot;&gt;sakura&lt;/a&gt;的样式，界面稍微变得更加美观点了。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[php使用rabbitmq队列处理数据推送]]></title><description><![CDATA[使用rabbitmq作为消息队列软件...]]></description><link>https://joeyxf.com/posts/php-use-rabbitmq/</link><guid isPermaLink="false">https://joeyxf.com/posts/php-use-rabbitmq/</guid><pubDate>Mon, 14 Sep 2015 00:00:00 GMT</pubDate><content:encoded>&lt;h2 id=&quot;使用rabbitmq作为消息队列软件&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8rabbitmq%E4%BD%9C%E4%B8%BA%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97%E8%BD%AF%E4%BB%B6&quot; aria-label=&quot;使用rabbitmq作为消息队列软件 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用rabbitmq作为消息队列软件&lt;/h2&gt;
&lt;h3 id=&quot;为什么使用rabbitmq&quot;&gt;&lt;a href=&quot;#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8rabbitmq&quot; aria-label=&quot;为什么使用rabbitmq permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;为什么使用rabbitmq&lt;/h3&gt;
&lt;h3 id=&quot;可选的队列软件&quot;&gt;&lt;a href=&quot;#%E5%8F%AF%E9%80%89%E7%9A%84%E9%98%9F%E5%88%97%E8%BD%AF%E4%BB%B6&quot; aria-label=&quot;可选的队列软件 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;可选的队列软件&lt;/h3&gt;
&lt;h3 id=&quot;安装及配置rabbitmq&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85%E5%8F%8A%E9%85%8D%E7%BD%AErabbitmq&quot; aria-label=&quot;安装及配置rabbitmq permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装及配置rabbitmq&lt;/h3&gt;
&lt;h2 id=&quot;使用eloquent来操作模型&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8eloquent%E6%9D%A5%E6%93%8D%E4%BD%9C%E6%A8%A1%E5%9E%8B&quot; aria-label=&quot;使用eloquent来操作模型 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用Eloquent来操作模型&lt;/h2&gt;
&lt;h3 id=&quot;为什么使用eloquent&quot;&gt;&lt;a href=&quot;#%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8eloquent&quot; aria-label=&quot;为什么使用eloquent permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;为什么使用Eloquent&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Propel&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Doctrine2&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;eloquent&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;eloquent处理sharding&quot;&gt;&lt;a href=&quot;#eloquent%E5%A4%84%E7%90%86sharding&quot; aria-label=&quot;eloquent处理sharding permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;eloquent处理sharding&lt;/h3&gt;
&lt;h2 id=&quot;处理拉取逻辑&quot;&gt;&lt;a href=&quot;#%E5%A4%84%E7%90%86%E6%8B%89%E5%8F%96%E9%80%BB%E8%BE%91&quot; aria-label=&quot;处理拉取逻辑 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;处理拉取逻辑&lt;/h2&gt;
&lt;h3 id=&quot;表结构设计&quot;&gt;&lt;a href=&quot;#%E8%A1%A8%E7%BB%93%E6%9E%84%E8%AE%BE%E8%AE%A1&quot; aria-label=&quot;表结构设计 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;表结构设计&lt;/h3&gt;
&lt;h3 id=&quot;如何获得最新的信息流&quot;&gt;&lt;a href=&quot;#%E5%A6%82%E4%BD%95%E8%8E%B7%E5%BE%97%E6%9C%80%E6%96%B0%E7%9A%84%E4%BF%A1%E6%81%AF%E6%B5%81&quot; aria-label=&quot;如何获得最新的信息流 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;如何获得最新的信息流&lt;/h3&gt;</content:encoded></item><item><title><![CDATA[php编码规范]]></title><description><![CDATA[之前写代码的时候一直不是很在意编码规范的问题，感觉只要把代码功能实现了就OK，但是看到越来越多的优秀开源项目都给自己的项目制定了编码规范，提交PR必须要满足规范才能合并到主干，而且自己搞php开发也已经有1年了，得开始走向规范化开发的道路...]]></description><link>https://joeyxf.com/posts/php-coding-style/</link><guid isPermaLink="false">https://joeyxf.com/posts/php-coding-style/</guid><pubDate>Tue, 14 Jul 2015 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;之前写代码的时候一直不是很在意编码规范的问题，感觉只要把代码功能实现了就OK，但是看到越来越多的优秀开
源项目都给自己的项目制定了编码规范，提交PR必须要满足规范才能合并到主干，而且自己搞php开发也已经有1
年了，得开始走向规范化开发的道路。&lt;/p&gt;
&lt;p&gt;首先得介绍一下psr2，目前&lt;a href=&quot;http://laravel.com/&quot;&gt;laravel&lt;/a&gt;项目使用的就是这个风格标准，具体的规定
在&lt;a href=&quot;https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-2-coding-style-guide.md&quot;&gt;这里&lt;/a&gt;
我以前的习惯大部分符合psr2的标准，但是因为渐渐的使用到了很多高级的php特性，比如说closure, trait, 抽象类等，
所以还是得纠正一点小的习惯。&lt;/p&gt;
&lt;p&gt;除了psr2这个标准之外，各大公司也有自己内部使用的标准，比如说symfony, wordpress, squiz等，还是靠拢
国际标准吧，目前我的emacs里面的php-mode的设置就是psr2的标准，自动格式化代码省了点心。&lt;/p&gt;
&lt;p&gt;代码写完了之后提交到github上却总是发现过不了持续集成(Continuous Integration)的审核，我自己目前几个个人
项目使用的是&lt;a href=&quot;https://styleci.io/&quot;&gt;styleci&lt;/a&gt;这个在线审核的工具，功能很简单但是很强大，最初几次提交
总是会给我返回很多fail，导致严格要求自己按照编码规范来。&lt;/p&gt;
&lt;p&gt;为了避免提交之后被styleci给鄙视，从网上找到了&lt;a href=&quot;https://github.com/squizlabs/PHP_CodeSniffer&quot;&gt;PHP_CodeSniffer&lt;/a&gt;这个
小工具，叫做php嗅探器，它其实包括2个小部件，一个是phpcs(php coding style)，另一个是phpcbf(PHP Code Beautifier and Fixer)，
前者只检查代码的问题，后者还会帮忙纠正代码，如果信不过机器帮忙纠正代码，那么之前一定的记得提交代码。根据官方文档上的
说明修改配置，简单使用，效果很不错。后来我又找了一个叫做&lt;a href=&quot;https://github.com/nishimaki10/emacs-phpcbf&quot;&gt;emacs-phpcbf&lt;/a&gt;的
小工具，这个是一个emacs的插件配置好之后可以集成到php-mode里面，稍加配置就可以在保存php文件的时候自动纠正错误。&lt;/p&gt;
&lt;p&gt;后面发现通过phpcbf纠错的代码还是不能通过styleci，找了一下发现styleci用的是一个叫做&lt;a href=&quot;https://github.com/FriendsOfPHP/PHP-CS-Fixer&quot;&gt;php-cs-fixer&lt;/a&gt;
的引擎来审核代码的，又对照着装了一个php-cs-fixer，和phpcbf的功能差不多，但是稍微严格一点，对于额外的空行也会删掉。&lt;/p&gt;
&lt;p&gt;码农要往正规化方向走，现在养成一下编码规范的习惯，以后再来培养测试驱动的习惯。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[迁移一个discuz站点]]></title><description><![CDATA[周五晚上帮同事迁移了一个网站，原来的网站是搭建在windows2003服务器上的，使用的是apache2 + php5.3 + mysql5.1 的架构，...]]></description><link>https://joeyxf.com/posts/migrate-a-discuz-site/</link><guid isPermaLink="false">https://joeyxf.com/posts/migrate-a-discuz-site/</guid><pubDate>Tue, 23 Jun 2015 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;周五晚上帮同事迁移了一个网站，原来的&lt;a href=&quot;http://www.huizu100.com&quot;&gt;网站&lt;/a&gt;是搭建在windows2003服务器上的，使用的是apache2 + php5.3 + mysql5.1 的架构，使用的是一个叫作PHPnow的一键安装包来管理服务器的，这种架构对于个人站长来说很方便，只要设置好了配置就可以自己搭建网站，但是扩展性特别差，简直就是没法维护，win2003本来就是老掉牙的技术了，这种服务器长期跑肯定是会有内存问题的，而用PHPnow搭建的网站，数据库，代码，数据都在一个目录里面，这样潜在的问题太大了，首先就是安全性问题，没有数据库本来应该单独放到一个专门的服务器上的。而且所有数据放在一起对于业务分离，备份也很不方便，一下备份一个几十G大的目录是很浪费资源的。&lt;/p&gt;
&lt;p&gt;所以在我的建议下，周五晚上对这个网站做了一个迁移，新的架构是LNMP，ubuntu 15.04 server + nginx 1.6 + hhvm 3.7 + mariadb 10.0.20 + redis 3.0，当然因为服务器只有一台，所以没有做负载均衡，没有做数据库读写分离，也没有做hhvm的均衡，因为等我把环境搭建完的时候就已经很稳定了，所以暂时不打算那么做，下面简单的来说说迁移过程。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;服务器安装
我给的建议是装ubuntu，因为将来环境稳定下来之后要把权限分给站长，让他自己上去查看管理一些进程，而ubuntu的桌面又是比较简单易用的。本来他们是打算安装ubuntu 15.04 desktop版的，但是因为这个版本没法驱动DELL r710服务器自带的硬Raid，所以最后换成server版了。&lt;/li&gt;
&lt;/ol&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;
&lt;p&gt;nginx，mariadb，hhvm，redis这些软件的安装都很简单，唯一一个比较特殊的功能就是用了hhvm来替换php，不过暂时没有感到太大的性能提升。LNMP环境搭建是很简单的，很快就完成了。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;接下来是服务器配置
最大的问题就是调整分区结构，服务器上有一块300G的自带硬盘，这款盘其实是由2块一样的硬盘搭建的raid0，自带了数据备份功能，所以这块盘理论上来说是不该保存太多系统以外的东西的。然后是1块1T的绿盘，这块盘的年头比较老了，以前的网站就部署在这块盘上，我打算把这个盘拿来当备份盘，还有一块2T的黑盘，这块盘是一块最新最好的数据盘，所以我打算把网站和数据库都放在这块盘上。首先要把这块2T的盘里面的数据备份了，很重要的资料一定得保存，但是里面用PHPNow的工具全量备份了站点，一个备份40G，备份一周的数据，复制这些内容浪费了好多时间。数据备份完了之后就是给硬盘分区，先分区那块2T的盘，准备分4个区，按照300+300+600+600来分，虽然暂时没有想好具体怎么使用，用&lt;code class=&quot;language-text&quot;&gt;fdisk /dev/sdb&lt;/code&gt;开始分区，分区之后就是创建文件系统，只用ext4，所以&lt;code class=&quot;language-text&quot;&gt;mkfs.ext4 /dev/sdbn&lt;/code&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;部署网站
这步就很简单了，直接复制代码，修改配置，修改权限，有一个比较大的问题是discuz的图片是存放在一个叫做&lt;code class=&quot;language-text&quot;&gt;data/attachment&lt;/code&gt;的目录下的，这些图片完全可以和代码分离，所以拿一块额外的分区来装就行，我是挂载的那个600G的分区到这个目录的。&lt;code class=&quot;language-text&quot;&gt;mount /dev/sdb6 /pathtodata/attachment&lt;/code&gt;。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;部署完成之后调试了一下网站就跑起来了，但是还有很多要做的事，discuz的代码结构比较混乱，不好改动，而且原来他的网站语言设置是GBK的，涉及到编码问题又更加复杂了，反正直到周日晚上才把问题全部解决，目前就是陆陆续续做一些服务器的小性能调优。&lt;/p&gt;
&lt;p&gt;6月25日更新：
这几天陆陆续续发现了一些bug，有样式错误的，有插件报错的，有缓存不能及时清的等等，突然感觉压力好大，工作日只能下班之后有时间做自己的事，端午节3天假2天加一晚上都折腾那个网站去了，本以为是没什么事了，没想到后续的问题更多更麻烦，早知道就不轻易答应人家了，而且以后坚决不再折腾discuz，继续折腾这个东西只会浪费我更多时间。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[学习git]]></title><description><![CDATA[继续学习git，把统计后台的代码从内部git服务器迁移到github上面了，用的是自己的私有仓库...]]></description><link>https://joeyxf.com/posts/learn-git/</link><guid isPermaLink="false">https://joeyxf.com/posts/learn-git/</guid><pubDate>Mon, 01 Jun 2015 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;继续学习git，把统计后台的代码从内部git服务器迁移到github上面了，用的是自己的私有仓库。&lt;/p&gt;
&lt;p&gt;目前主要用到的功能有：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;添加远程仓库
&lt;code class=&quot;language-text&quot;&gt;git remote add origin https://github.com/xcaptain/simple-admin.git&lt;/code&gt;
这样就能添加一个远程仓库了，等以后把代码push上去就行了，访问远程仓库的方式有2种，一种是ssh，一种是https，上面这种是https的仓库，也是github默认的访问仓库的方法，
因为ssh太不安全了，对于我们这种生活在封锁国度的老百姓来说，很容易被屏蔽。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;往远程仓库里面提交代码
&lt;code class=&quot;language-text&quot;&gt;git commit -m &amp;#39;some comment&amp;#39;&lt;/code&gt;
这样就可以提交代码，返回一个hash值标识的版本号，提交之后代码版本还在本地，如果要多方合作开发，那就得把改动保存到一个大家都可以访问的远程仓库，
&lt;code class=&quot;language-text&quot;&gt;git push origin master&lt;/code&gt;，把本地版本推送到远程的master分支。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;建立本地分支
&lt;code class=&quot;language-text&quot;&gt;git branch dev&lt;/code&gt;
这样就在本地创建了一个叫做dev的分支，并且会自动切换到这个dev分支，如果建了好多个分支，想查看当前自己在哪个分支，直接&lt;code class=&quot;language-text&quot;&gt;git branch&lt;/code&gt;就会列出，当然如果使用的是zsh或者是
fish这样的shell，一般都会有git的插件，可以显示当前所在分支。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;把本地分支添加到远程仓库
&lt;code class=&quot;language-text&quot;&gt;git checkout dev&lt;/code&gt;切换到dev分支，然后&lt;code class=&quot;language-text&quot;&gt;git push origin dev&lt;/code&gt;就可以把代码推送到远程仓库的dev分支了。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;打标签
&lt;code class=&quot;language-text&quot;&gt;git tag&lt;/code&gt;可以查看当前版本库的所有标签信息，如果要添加标签，那么就是&lt;code class=&quot;language-text&quot;&gt;git tag -a v0.2 -m &amp;#39;优化流量统计代码，统一风格&amp;#39;&lt;/code&gt;添加一个叫作v0.2的标签，并且提交。如果要把
本地的标签信息提交到远程仓库，那么就是&lt;code class=&quot;language-text&quot;&gt;git push --tags&lt;/code&gt;，然后去github上查看就能看到对应的v0.2版本了。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;查看提交版本
&lt;code class=&quot;language-text&quot;&gt;git log&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;git diff&lt;/code&gt;，我一般喜欢用emacs的magit插件来查看diff和版本。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;把未暂存的文件回滚
&lt;code class=&quot;language-text&quot;&gt;git checkout file1&lt;/code&gt;，这样会从版本库中检出上一个提交的file1的版本，覆盖掉当前这个未提交的版本。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;回滚版本库
这个操作目前做得比较少，都是&lt;code class=&quot;language-text&quot;&gt;git reset --hard HEAD~1&lt;/code&gt;，来回到上一个版本的，对于这个操作还不熟悉，至少svn回滚已经是很熟悉的了。&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;git的功能很强大也很复杂，但是一定是要掌握的，这样才能成为一个合格的项目经理，以后慢慢积累，有新的体会再来更新这篇博客。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[一个简单的元编程例子]]></title><description><![CDATA[去年在学习ruby的时候就看到了很多元编程的例子，用一个方法来生成多个类似的方法，避免制造重复的代码，ruby用的是method_missing来实现...]]></description><link>https://joeyxf.com/posts/php-meta-programming/</link><guid isPermaLink="false">https://joeyxf.com/posts/php-meta-programming/</guid><pubDate>Fri, 17 Apr 2015 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;去年在学习ruby的时候就看到了很多元编程的例子，用一个方法来生成多个类似的方法，避免制造重复的代码，ruby用的是method_missing来实现的。&lt;/p&gt;
&lt;p&gt;今天工作遇到一个小问题，需要写一个简单的脚本来统计某个时间段用户的发帖信息，需求很简单要实现也很简单。最初的设计见下面：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UpdateUserRank&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;__construct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getDayRank&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$num&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getMonthRank&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$num&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;getAllRank&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$num&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setDayRank&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setMonthRank&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;setAllRank&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;需要写3个get方法，3个set方法，这种形式实在是太不方便维护了，每个函数的功能类似，而且函数名也类似，有没有什么办法能够不要写这么多函数呢？利用php的&lt;code class=&quot;language-text&quot;&gt;__call&lt;/code&gt;方法可以很简单的实现&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;php&quot;&gt;&lt;pre class=&quot;language-php&quot;&gt;&lt;code class=&quot;language-php&quot;&gt;&lt;span class=&quot;token keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;UpdateUserRank&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;__construct&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token variable&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;getMethods&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;getDayRank&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;getMonthRank&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;getAllRank&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token variable&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;setMethods&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;setDayRank&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;setMonthRank&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;setAllRank&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;__call&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;in_array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;getMethods&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token variable&quot;&gt;$num&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$args&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;redis&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;zrevrange&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;_key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$num&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token boolean constant&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;elseif&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;in_array&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;setMethods&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token variable&quot;&gt;$nowtime&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$name&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;setDayRank&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token variable&quot;&gt;$ago&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$nowtime&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3600&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token variable&quot;&gt;$key&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;getDayRank&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;elseif&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$name&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;setMonthRank&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token variable&quot;&gt;$ago&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$nowtime&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;24&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3600&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token variable&quot;&gt;$key&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;getMonthRank&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token variable&quot;&gt;$ago&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token variable&quot;&gt;$key&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;getAllRank&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token variable&quot;&gt;$sql&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token double-quoted-string string&quot;&gt;&quot;select authorid, count(authorid) as threadnum from dz_forum_thread where dateline between &lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$ago&lt;/span&gt;&lt;/span&gt; and &lt;span class=&quot;token interpolation&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;$nowtime&lt;/span&gt;&lt;/span&gt; group by authorid&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token variable&quot;&gt;$sth&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;pdo&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;prepare&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$sql&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token variable&quot;&gt;$sth&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$row&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$sth&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;fetch&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;PDO&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token constant&quot;&gt;FETCH_ASSOC&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token variable&quot;&gt;$authorid&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$row&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;authorid&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token variable&quot;&gt;$threadnum&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$row&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token single-quoted-string string&quot;&gt;&apos;threadnum&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            &lt;span class=&quot;token variable&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token property&quot;&gt;redis&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;zAdd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$this&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;_key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$key&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$threadnum&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$authorid&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token double-quoted-string string&quot;&gt;&quot;不合法的方法: &quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$name&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;token double-quoted-string string&quot;&gt;&quot;\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;调用一个类里面的方法时，如果在当前类没有找到这个方法就会逐层往父类查找，直到找到对应的方法，但是如果这个类或者是父类定义了&lt;code class=&quot;language-text&quot;&gt;__call&lt;/code&gt;方法，则能自动处理找不到的方法，接受2个参数，第一个是函数名，第二个是函数名传过来的参数，是一个数组。基本上可以说&lt;code class=&quot;language-text&quot;&gt;__call&lt;/code&gt;实现了&lt;code class=&quot;language-text&quot;&gt;method not defined&lt;/code&gt;这个异常的处理吧。&lt;/p&gt;
&lt;p&gt;因为php的正则没有ruby简单，所以在这里我先定义了2个数组，对象调用的方法必须在这2个数组中才能执行，否则就报不合法的方法，然后退出，也许还可以通过&lt;code class=&quot;language-text&quot;&gt;__get&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;__set&lt;/code&gt;来实现，谁知道呢？&lt;/p&gt;</content:encoded></item><item><title><![CDATA[btrfs损坏之后的一系列麻烦]]></title><description><![CDATA[上周六晚上玩电脑的时候忘记插上电源了，直接导致笔记本意外断电关机，本来这只是一件小事，重启电脑即可，个人电脑一般没有多大的磁盘IO，数据基本都是在内存中读写的，但是等我重启电脑的时候却发现没法进系统了...]]></description><link>https://joeyxf.com/posts/btrfs-crash/</link><guid isPermaLink="false">https://joeyxf.com/posts/btrfs-crash/</guid><pubDate>Thu, 26 Mar 2015 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;上周六晚上玩电脑的时候忘记插上电源了，直接导致笔记本意外断电关机，本来这只是一件小事，重启电脑即可，个人电脑一般没有多大的磁盘IO，数据基本都是在内存中读写的，但是等我重启电脑的时候却发现没法进系统了，一直卡在fsck那步，然后就是一直提示出现多少个&lt;code class=&quot;language-text&quot;&gt;block error&lt;/code&gt;，心立刻亮了半截，我用的arch没有做备份，如果硬盘损坏，里面的重要文件就都没了。于是重启进入win8下载了一个system-rescue-cd打算进入livecd修复分区，进去之后执行&lt;code class=&quot;language-text&quot;&gt;btrfs check --repair /dev/sda3&lt;/code&gt;，倒是检查出了一个块错误，但是没有修复，尝试重启电脑，结果出现&lt;code class=&quot;language-text&quot;&gt;bad super block, unknown fs&lt;/code&gt;，似乎问题加重了，上网搜了一下superblock损坏的话要找备份的superblock来替换，但是我没有定时做文件系统备份，行不通，后来尝试给&lt;code class=&quot;language-text&quot;&gt;btrfs check&lt;/code&gt;加上&lt;code class=&quot;language-text&quot;&gt;--init-scum&lt;/code&gt;参数，重启之后一大堆错误，死心，对数据不报期望了。&lt;/p&gt;
&lt;p&gt;上一个系统用了1年多没换，好不容易有一次机会折腾可不能放过，先尝试安装funtoo，和以前无数次一样，都是到最后驱动不了我的博通无线网卡，后面尝试sabayon这个桌面系统，自带了桌面肯定自带了所有驱动。尝试安装，这回小心了，把&lt;code class=&quot;language-text&quot;&gt;/boot&lt;/code&gt;单独放到一个ext2的分区中去了，然后/用的是xfs，毕竟SGI的技术还是非常可以的。安装之后果然不需要手动装驱动，这种傻瓜式操作我最喜欢了，gnome中总是配置不好fcitx，而且ghc编译的时候总是会报错，也是莫名其妙的问题，supervisor的配置都得自己手动写，一大堆反人类的事情真是头疼，被arch的KISS哲学熏陶得simple且stupid之后，实在是受不了gentoo的diy思想。用&lt;code class=&quot;language-text&quot;&gt;btrfs restore /mnt/arch /mnt/arch_bak&lt;/code&gt;备份大部分数据之后，继续重装arch。&lt;/p&gt;
&lt;p&gt;备份分区之后就多出了一个分区可以用来安装第三个系统，对于懒人来说肯定不愿意折腾文本安装界面，直接下载antergos的livecd开始图形化安装，一步一步做，选文件系统的时候还是不死心，不愿意放弃心爱的btrfs，又做死选了它。系统倒是很快就装好了，麻烦的地方是配置，不过默认的gnome3界面用得真心不习惯，所有应用窗口挤在一个桌面上，反复切换实在是太麻烦了。在安装fcitx输入法的时候不小心&lt;code class=&quot;language-text&quot;&gt;systemctl stop dbus.service&lt;/code&gt;，结果gnome桌面自动推出了，卡在一个黑乎乎的界面，对于一切操作都没有响应，强制关机之后发现又进不了硬盘了，满头黑线。&lt;/p&gt;
&lt;p&gt;反正这个新安装的系统没有什么数据，重装即可，这回发誓在也不用btrfs了，试试ext4这个根正苗红的linux传人，果然一切OK，有线无线网卡自动激活，电源管理自带，安装xmonad没问题，安装fcitx一切顺利，安装dmenu用来管理菜单，安装urxvt，复制之前的Xresources文件，安装fish，安装vim，安装emacs，安装supervisor，安装shadowsocks，安装proxychains，github上面拷贝spf13的vim配置，prelude的emacs配置，oh-my-fish，一切都是这么简单，几乎不需要自己做额外的配置。进入熟悉的xmonad界面之后内心久久不能平静，我就喜欢这种一份配置一直使用的wm。最大的遗憾就是没能找回原来用的rsa密钥对，也就是说我的服务器连接都得重新来一遍，password-store也不能用了，几十个密码没法导出来。&lt;/p&gt;
&lt;p&gt;从周日开始一知道今天（周四），花了太多时间，上班也用的是公司的电脑，太影响效率了，不过还好一切都解决了。总结一下这场事故中学到的东西吧：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;数据无价，平时得定时做好数据备份工作。鉴于xfs和ext4都没有磁盘快照功能，所以只能备份文件了，btsync似乎是一个不错的选择。&lt;/li&gt;
&lt;li&gt;不要把/boot和/放在一起，其实最好的分区规范应该是分为/boot, /usr, /这3块，这样就算/挂了，还能进入内核利用/usr里面的软件来修复自身。&lt;/li&gt;
&lt;li&gt;btrfs最近2年都不会再去碰了，虽然有很多很新的特性，但是一个礼拜伤我2次，这份大仇2年内都不能忘记。&lt;/li&gt;
&lt;li&gt;配置文件非常重要，最好是保存在网上，之前仅仅star了一下prelude的配置导致后面很多本地的自定义都没有提交到自己的仓库，分区崩溃之后自己写的代码都没了。&lt;/li&gt;
&lt;li&gt;最后再赞美一下xmonad，这是我用过的最好的桌面了。&lt;/li&gt;
&lt;/ol&gt;</content:encoded></item><item><title><![CDATA[使用org-mode]]></title><description><![CDATA[最近看书学习感觉非常没有劲，究其原因感觉是缺少一个做笔记的工具，原来那支跟随我4年的钢笔放家里没有带过来， 京东上预订的lamy也还没有到货，看书不动笔我是什么都记不住的...]]></description><link>https://joeyxf.com/posts/use-orgmode/</link><guid isPermaLink="false">https://joeyxf.com/posts/use-orgmode/</guid><pubDate>Sun, 15 Mar 2015 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;最近看书学习感觉非常没有劲，究其原因感觉是缺少一个做笔记的工具，原来那支跟随我4年的钢笔放家里没有带过来，
京东上预订的lamy也还没有到货，看书不动笔我是什么都记不住的，所以感觉学习效率低了很多。印象笔记确实不错，
配合浏览器的markdown-here扩展就能支持markdown语法了，但是缺少一个所见即所得的笔记客户端，用markdown写完
之后转换为html还是感觉不够方便，并且总是要有网才能看到和编辑笔记很不方便。gnome自带的tomboy我也尝试了，
这东西更加不好用，连markdown都不支持怎么能拿来记笔记。&lt;/p&gt;
&lt;p&gt;今天反正周六闲着没事就拿起了orgmode的&lt;a href=&quot;http://orgmode.org/org.html&quot;&gt;手册&lt;/a&gt; 来看，看了几页竟然发现org转md是这么方便，果断以后就用emacs来
记笔记了，又学会一个新技能。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;下面就来讲讲org做笔记的基本用法吧:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;使用星号来表明段落的层级，和md的使用#差不多的概念&lt;/li&gt;
&lt;li&gt;支持有序列表，无序列表，语法和md类似，org或自动缩进对其每个列表项，如果发现不匹配了那就肯定某个地方缩进出问题了&lt;/li&gt;
&lt;li&gt;插入链接\[[链接]\[名字]] 这样就能插入一条链接了&lt;/li&gt;
&lt;li&gt;用\\来断行，这样就不必要把一段话写在一行了&lt;/li&gt;
&lt;li&gt;C-c C-e m m 来导出markdown文件&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[emacs使用自定义grep-find模板]]></title><description><![CDATA[被emacs的搜索功能纠结好久了，今天下定决心来解决一下。以前执行...]]></description><link>https://joeyxf.com/posts/emacs-use-grep-find/</link><guid isPermaLink="false">https://joeyxf.com/posts/emacs-use-grep-find/</guid><pubDate>Sat, 07 Mar 2015 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;被emacs的搜索功能纠结好久了，今天下定决心来解决一下。以前执行&lt;code class=&quot;language-text&quot;&gt;grep-find&lt;/code&gt;命令的时候查找的模板都是&lt;code class=&quot;language-text&quot;&gt;find . -type f -exec grep -nH -e {} +&lt;/code&gt;，但是这条命令在fish下没法用，找了一下发现在&lt;a href=&quot;https://github.com/fish-shell/fish-shell/issues/95&quot;&gt;这个issue&lt;/a&gt;里面作者提到了为什么fish里面没法用find，因为在fish里面&lt;code class=&quot;language-text&quot;&gt;{}&lt;/code&gt;是有意义的，所以就会提示exec缺少参数，所以如果写成&lt;code class=&quot;language-text&quot;&gt;find . -type f -exec grep -nH -e &amp;#39;{}&amp;#39; +&lt;/code&gt;就可以了，接下来的任务就是修改emacs的配置，把默认的&lt;code class=&quot;language-text&quot;&gt;grep-find&lt;/code&gt;的行为改掉。&lt;/p&gt;
&lt;p&gt;因为查找功能是emacs默认就有的，所以我直接就去源代码目录找了，在&lt;code class=&quot;language-text&quot;&gt;/usr/share/emacs/24.4/&lt;/code&gt;下执行&lt;code class=&quot;language-text&quot;&gt;grep &amp;#39;grep-find&amp;#39; -R *&lt;/code&gt;，然后在&lt;code class=&quot;language-text&quot;&gt;lisp/ldefs-boot.el&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;lisp/loaddefs.el&lt;/code&gt;找到了相关的代码，然后试着修改第12669行，这行看起来像是相关的代码，结果改完了半天不生效，无奈之下去&lt;a href=&quot;http://stackoverflow.com/questions/28915372/change-the-default-find-grep-command-in-emacs/&quot;&gt;stackoverflow&lt;/a&gt;提问，这个网站效率真的不是一般的高，很快就拿到答案了，有人说我找到的代码只不过是docstring而已，要修改的话得改&lt;code class=&quot;language-text&quot;&gt;grep-find-template&lt;/code&gt;,通过&lt;code class=&quot;language-text&quot;&gt;C-h v&lt;/code&gt;查看了一下这个变量的值，默认的是&lt;code class=&quot;language-text&quot;&gt;&amp;quot;find . &amp;lt;X&amp;gt; -type f &amp;lt;F&amp;gt; -exec grep &amp;lt;C&amp;gt; -nH -e &amp;lt;R&amp;gt; {} +&amp;quot;&lt;/code&gt;，修改它就行了，编辑&lt;code class=&quot;language-text&quot;&gt;~/.emacs.d/personal/custom.el&lt;/code&gt;，在最底下加上&lt;code class=&quot;language-text&quot;&gt;(setq grep-find-template &amp;quot;find . &amp;lt;X&amp;gt; -type f &amp;lt;F&amp;gt; -exec grep &amp;lt;C&amp;gt; -nH -e &amp;lt;R&amp;gt; \&amp;#39;{}\&amp;#39; +&amp;quot;)&lt;/code&gt;，然后&lt;code class=&quot;language-text&quot;&gt;eval-buffer&lt;/code&gt;，问题完美解决，不得不说emacs真是灵活，不用改源代码就能实现自定义功能。&lt;/p&gt;
&lt;p&gt;后面又修改了&lt;code class=&quot;language-text&quot;&gt;find-grep-dired&lt;/code&gt;的模板，好像这条命令没有模板，所以我直接改的代码，&lt;code class=&quot;language-text&quot;&gt;/usr/share/emacs/24.4/lisp/find-dired.el.gz&lt;/code&gt;编辑第278行，把{}转义了。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[python2编码问题]]></title><description><![CDATA[这篇文章是要记录今天写一个采集是遇到的编码问题的，但是因为在写博客时遇到了一些问题，所以也就顺便记录一下...]]></description><link>https://joeyxf.com/posts/python-encoding/</link><guid isPermaLink="false">https://joeyxf.com/posts/python-encoding/</guid><pubDate>Tue, 13 Jan 2015 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;这篇文章是要记录今天写一个采集是遇到的编码问题的，但是因为在写博客时遇到了一些问题，所以也就顺便记录一下。&lt;/p&gt;
&lt;p&gt;在执行rake new_post的时候，突然提示&lt;/p&gt;
&lt;pre&gt;
rake aborted!
LoadError: cannot load such file -- bundler/setup
/home/joey/octopress/Rakefile:2:in `&lt;top (required)&gt;&apos;
(See full trace by running task with --trace)
&lt;/pre&gt;
&lt;p&gt;突然感觉很奇怪，前几天更新博客的时候都没有遇到这种情况，后来执行&lt;code class=&quot;language-text&quot;&gt;rake --trace&lt;/code&gt;的时候发现&lt;/p&gt;
&lt;pre&gt;
/usr/lib/ruby/2.2.0/rubygems/core_ext/kernel_require.rb:54:in `require&apos;
/usr/lib/ruby/2.2.0/rubygems/core_ext/kernel_require.rb:54:in `require&apos;
/home/joey/octopress/Rakefile:2:in `&lt;top (required)&gt;&apos;
/usr/lib/ruby/2.2.0/rake/rake_module.rb:28:in `load&apos;
/usr/lib/ruby/2.2.0/rake/rake_module.rb:28:in `load_rakefile&apos;
/usr/lib/ruby/2.2.0/rake/application.rb:689:in `raw_load_rakefile&apos;
/usr/lib/ruby/2.2.0/rake/application.rb:94:in `block in load_rakefile&apos;
/usr/lib/ruby/2.2.0/rake/application.rb:176:in `standard_exception_handling&apos;
/usr/lib/ruby/2.2.0/rake/application.rb:93:in `load_rakefile&apos;
/usr/lib/ruby/2.2.0/rake/application.rb:77:in `block in run&apos;
/usr/lib/ruby/2.2.0/rake/application.rb:176:in `standard_exception_handling&apos;
/usr/lib/ruby/2.2.0/rake/application.rb:75:in `run&apos;
/usr/bin/rake:33:in `&lt;main&gt;&apos;
&lt;/pre&gt;
&lt;p&gt;原来是系统ruby的版本更新到2.2了，以前是2.1的，octopress用的是2.1的gem，也许是和2.2的ruby不兼容吧，所以要重装2.2的gem套系，执行&lt;code class=&quot;language-text&quot;&gt;proxychains gem install bundle&lt;/code&gt;，有经验了必须要通过代理才能访问rubygem网站，下载完之后需要把&lt;code class=&quot;language-text&quot;&gt;/home/joey/.gem/ruby/2.2.0/bin&lt;/code&gt; 添加到环境变量中，因为我用的是fish，所以编辑&lt;code class=&quot;language-text&quot;&gt;~/.config/fish/config.fish&lt;/code&gt;就行了。然后用bundle安装完必要的依赖&lt;code class=&quot;language-text&quot;&gt;proxychains bundle install&lt;/code&gt;，下载一大堆gem，最后发现系统用的rake已经是10.4.2版的了，而配置文件中需要的还是10.4.0,手动编辑一下&lt;code class=&quot;language-text&quot;&gt;Gemfile.lock&lt;/code&gt;，把版本号改过来就行了，后来又重装了一下&lt;code class=&quot;language-text&quot;&gt;safe_yaml&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;liquid&lt;/code&gt;，把对应的版本号也都改过来了，一个小版本升级搞得这么麻烦，真是郁闷。&lt;/p&gt;
&lt;p&gt;接下来就是说说今天写代码遇到的问题了。&lt;/p&gt;
&lt;p&gt;需求很简单（话说写采集需求都很明确），这回需要的是采集明星的信息，第一个方案用的是采集baidu整理的明星信息，过程很简单，写了一个简单的脚本采了900条数据，但是后来发现图片做了防盗链，采集过来的图片不是图片的绝对路径，而是通过一台服务器生成的图片，也许是做了cookie的限制或者是做了ip的限制，导致每次刷新页面的时候都会返回一个403错误，链接在&lt;a href=&quot;http://www.baidu.com/s?wd=%E6%98%8E%E6%98%9F%E5%A4%A7%E5%85%A8&amp;#x26;rsv_spt=1&amp;#x26;issp=1&amp;#x26;f=8&amp;#x26;rsv_bp=0&amp;#x26;rsv_idx=2&amp;#x26;ie=utf-8&amp;#x26;tn=baiduhome_pg&amp;#x26;rsv_enter=1&amp;#x26;rsv_sug3=4&amp;#x26;rsv_sug4=83&amp;#x26;rsv_sug1=3&amp;#x26;rsv_pq=d5fdf7cd00002ac7&amp;#x26;rsv_t=975c0jUWTeYgIUYA%2FfdqSJ75f%2BipUP9QR9v8Qgqb2jzy3rnHgTU3k4rBD%2B5moP73i00p&amp;#x26;rsv_sug2=0&amp;#x26;inputT=5564&quot;&gt;这里&lt;/a&gt;，以后有时间也许会去看看这个防盗链的实现，但是现在我可懒得花时间去研究怎么破解这个限制，那就换别的站采集吧。&lt;/p&gt;
&lt;p&gt;和产品沟通了一下，他也觉得如果死扣baidu是不明智的选择，后来换成360整理的资源了，链接在&lt;a href=&quot;http://www.haosou.com/s?ie=utf-8&amp;#x26;shb=1&amp;#x26;src=360sou_newhome&amp;#x26;q=%E6%98%8E%E6%98%9F%E5%A4%A7%E5%85%A8&quot;&gt;这里&lt;/a&gt;，数据也比较明确，分成3栏：领域，地域，性别，这个分类还是比较好的，以后我们拿来查询也方便。通过chrome开发工具，找到了js的接口，简单分析了一下就知道要获取那块数据，接下来就是敲代码了，最后的代码在&lt;a href=&quot;https://gist.github.com/xcaptain/cbf9980f1b30b2467d8a&quot;&gt;这里&lt;/a&gt;，本来是打算试试octopress对于gist的支持的，但是因为gist在国内被墙了，会影响整篇文章的阅读，所以就换个链接在这里，有兴趣的朋友就去看看。&lt;/p&gt;
&lt;p&gt;在写代码过程中遇到一个编码问题，困扰我很久，不过最终还是解决了。&lt;/p&gt;
&lt;p&gt;在使用python2的时候，要自己手动设置编码，python默认的字符串编码是ascii，这就导致如果在python2程序中出现了中文都会提示一个语法错误，但是如果在python2文件中强制加上一句&lt;code class=&quot;language-text&quot;&gt;# -*- coding: utf-8 -*-&lt;/code&gt; 这样python在执行程序的时候就知道使用utf-8来编码里面的字符串了。也许是我本地locale的设置，在打开python解释器的时候总是会自动帮我使用utf-8编码。
首先说说ascii编码，ascii只能编码代码点从0到127的字符，也就是英文字符，如果遇到代码点很高的字符，比如说中文，就没法争取的编码了，就会报错。下面来举几个例子：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;s1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;你好，world&apos;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#这里如果指定了文件的编码为utf-8，会自动把这个字符串编码成utf-8&lt;/span&gt;
s1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;\xe4\xbd\xa0\xe5\xa5\xbd\xef\xbc\x8cworld&apos;&lt;/span&gt;
s2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;u&apos;你好，world&apos;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#这里前面加了一个u来表明这个字符串是一个unicode字符串&lt;/span&gt;
s2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;u&apos;\u4f60\u597d\uff0cworld&apos;&lt;/span&gt;
u2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; s2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;encode&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;utf-8&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
u2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;&gt;&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;\xe4\xbd\xa0\xe5\xa5\xbd\xef\xbc\x8cworld&apos;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;字符串在内存中应该是用类似utf-8的形式存储的，这样比较节省内存空间，而且也不会出现太多的0导致字符串在大尾和小尾机器上的不兼容。所以对于一个python字符串的旅程可以大致归结为：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;在编辑器里写下&lt;code class=&quot;language-text&quot;&gt;s1 = &amp;#39;你好，world&amp;#39;&lt;/code&gt;然后保存为一个python文件的时候，编辑器会自动选择某种编码来保存这个文件，一般来说都是用的utf-8。&lt;/li&gt;
&lt;li&gt;python把这个程序加载进解释器的时候，会根据文件头来判断使用什么编码来解码这个文件，也就是&lt;code class=&quot;language-text&quot;&gt;# -*-coding: utf-8 -*-&lt;/code&gt;这行，如果没有这行就会用默认的&lt;code class=&quot;language-text&quot;&gt;ascii&lt;/code&gt;来解码。&lt;/li&gt;
&lt;li&gt;这时候程序里的字符串都是utf8的。
写到这里突然发现昨晚的问题实在不算问题，看来之前是没有静下心来研究，写博客还是有好处的。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;接下来再看看python3,python3的默认编码是unicode，而实际存在内存中的就是字节码，bytecode。也就是说一个字符串只有2种状态，unicode和byte，这样就节省很多事情了，没有各种编码解码的麻烦。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;s &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;你好，world&apos;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#这是一个str类型的字符串&lt;/span&gt;
b1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;encode&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;utf-8&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#这是把s编码为utf-8后的字节码&lt;/span&gt;
b2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;encode&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;gbk&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;#把s编码为gbk后的字节码&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;相对于2来说，3最大的进步就是不需要手动encode，decode，对于处理未知编码的文件最方便了。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[尝试hhvm]]></title><description><![CDATA[今天听到一个新闻说维基百科把他的php引擎由zend全面转到hhvm了，详情见...]]></description><link>https://joeyxf.com/posts/try-hhvm/</link><guid isPermaLink="false">https://joeyxf.com/posts/try-hhvm/</guid><pubDate>Wed, 31 Dec 2014 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;今天听到一个新闻说维基百科把他的php引擎由zend全面转到hhvm了，详情见&lt;a href=&quot;https://www.mediawiki.org/wiki/HHVM&quot;&gt;这里&lt;/a&gt;。其实之前对于这东西是闻所未闻的，太不关注php的发展了，后来详细搜了一下，才稍微了解了一点php代码的执行过程。&lt;/p&gt;
&lt;p&gt;对于动态语言来说，都是首先通过代码解析来生成字节码，然后通过解释器来执行这些字节码，php用的解释器叫作zend。看来和python差不多，程序在执行的时候也会先生成字节码，然后用python解释器去执行这些字节码。不过解释器的使用也导致了程序运行缓慢。所以现在facebook就做了一个叫作hhvm的东西，当通过hhvm来执行php程序的时候，会先生成一种中间码(intermediat byte code)也叫作HHBC(hhvm byte code)，然后hhvm会通过一种即时编译(just in time)的技术，将这种中间码编译为本地可执行的x86-64机器码，最后执行代码的时候等于是本地执行一个可执行程序，效率自然比解释器高了很多。不知道有没有什么方式能够把hhvm的这些步骤分离出来分析，真想看看php的字节码长什么样，生成的二进制程序长什么样。&lt;/p&gt;
&lt;p&gt;我在本地立刻部署了一下HHVM的环境，很简单&lt;code class=&quot;language-text&quot;&gt;sudo pacman -S hhvm&lt;/code&gt;直接就安装hhvm了，测试一下效果，随便写一个php文件，然后&lt;code class=&quot;language-text&quot;&gt;hhvm test.php&lt;/code&gt;如果安装成功的话就可以得到像执行&lt;code class=&quot;language-text&quot;&gt;php test.php&lt;/code&gt;一样的效果，现在还没想好写个怎样的测试用例来比较hhvm和原生php的速度。&lt;/p&gt;
&lt;p&gt;hhvm装好了之后当然不能只是用它来执行脚本，最重要的还是在服务器端编程上，当nginx接收到了一个请求的文件之后，并且把这个请求交个php的fastcgi处理后，在这里就不能用原生的php来执行文件里的php了，必须通过hhvm来执行，简单，就是不要启动php-fpm嘛，我看了一下安装hhvm的时候竟然自动连systemd的配置文件也生成了，所以我只要执行&lt;code class=&quot;language-text&quot;&gt;sudo systemctl start hhvm.service&lt;/code&gt;就能开启hhvm的监听程序了，类似php-fpm，hhvm服务器的配置文件存在&lt;code class=&quot;language-text&quot;&gt;/etc/hhvm/server.ini&lt;/code&gt;，在我这里配置文件写的是监听9000端口，那么&lt;code class=&quot;language-text&quot;&gt;netstat -naltp | grep 9000&lt;/code&gt;真的看到了一个监听的进程。然后就是确保nginx的配置文件中&lt;code class=&quot;language-text&quot;&gt;fastcgi_pass&lt;/code&gt;的值是&lt;code class=&quot;language-text&quot;&gt;127.0.0.1:9000&lt;/code&gt;，这样所有进入9000端口的数据都会被hhvm所处理。随便写了一个简单的数据库查询示例，暂时没发现hhvm和原生php的性能区别，也许是测试代码写得不好。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[采集一个论坛的帖子来进行数据分析]]></title><description><![CDATA[今天接到一个小小的需求，又是和采集相关的，我都要烦死了，采集这东西写得都要腻了...]]></description><link>https://joeyxf.com/posts/web-crawl-again/</link><guid isPermaLink="false">https://joeyxf.com/posts/web-crawl-again/</guid><pubDate>Tue, 30 Dec 2014 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;今天接到一个小小的需求，又是和采集相关的，我都要烦死了，采集这东西写得都要腻了。&lt;/p&gt;
&lt;p&gt;不过和以前的那些采集有点区别，不再是采集文章了，而是开始采集论坛的帖子。说实话我觉得采集论坛比较简单，因为论坛都是php的页面，页面组织布局一般不会怎么变，而新闻站基本都是cms系统生成的html静态页，静态的页面就有太多可能性了，而且不排除有的编辑太敬业把每个页面都做得不一样。&lt;/p&gt;
&lt;p&gt;采集源站是&lt;a href=&quot;http://qq.100bt.com&quot;&gt;http://qq.100bt.com&lt;/a&gt;，和我最近做的&lt;a href=&quot;http://www.zeze.com&quot;&gt;zeze&lt;/a&gt;是同一类型的东西，而且突然发现zeze竟然借鉴了很多这个网站的元素。废话不多说，这次采集主要是为了了解哪些资讯比较受欢迎，然后我们就可以有针对性的来推广我们的内容，看起来像是在收集竞争对手的信息而实现知己知彼百战不殆，这样的活我喜欢。这个叫作百田圈圈的网站似乎运营得不错，里面积累了差不多百万的帖子，用户似乎也很活跃。&lt;/p&gt;
&lt;p&gt;其实要获得的信息不多，在我设计的数据库结构中包含以下字段：&lt;/p&gt;
&lt;pre&gt;
tid: 帖子的id，用来作为表的主键
url: 帖子的url，便于访问
subject: 帖子标题
author_name: 楼主名，有这个东西可以用来分析哪些用户比较活跃
replies: 帖子的回复数，这个字段是用来衡量一个帖子的受欢迎程度的最重要指标
view: 帖子被查看的次数
pubdate: 发帖时间
maxpage: 帖子页数，因为有的帖子是回复楼层的，所以如果一个帖子分了很多页说明这个帖子内容丰富
category: 帖子所属分类，用来来分析哪些大类的话题比较火
&lt;/pre&gt;
&lt;p&gt;没有数据库直接操作真是麻烦，上面这些数据都得分析网页去获取，而且不是在同一个页面，需求挺麻烦的但是不难。&lt;/p&gt;
&lt;p&gt;代码传到&lt;a href=&quot;https://github.com/xcaptain/BeautifulSoup_Instance/tree/master/btqq&quot;&gt;github&lt;/a&gt;上面了，以前写的那些采集都是用脚本的形式来实现的，这回尝试了一下自己构造一个采集类，这时候才发现对于python的面向对象特性用的太少了，在设计类的结构，接口上面都很不熟练，现在的代码设计在python大牛严重肯定是很小儿科的，以后要多学习OOP的编程思想，不能总是一个函数一个函数这样顺序的执行下来。&lt;/p&gt;
&lt;p&gt;写这么一个简单的任务竟然还花了我一天的时间，看来编码能力还是有待加强，经过总结之后发现问题主要存在三方面：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;对mysql的查询语句不熟悉，因为我把tid设置为了主键，所以不能重复插入，我想要实现&lt;code class=&quot;language-text&quot;&gt;insert into on duplicate key continue&lt;/code&gt;的功能，找了半天只看到了&lt;code class=&quot;language-text&quot;&gt;insert into on duplicate key update&lt;/code&gt;的语法，但是后者不是我想要的，因为使用的是python的&lt;code class=&quot;language-text&quot;&gt;MySQLdb&lt;/code&gt;来驱动mysql的，这东西对于原生的sql语句支持不是很好，不过幸好最后我找到了&lt;code class=&quot;language-text&quot;&gt;insert ignore into&lt;/code&gt;这种语句，一下解决了问题，虽然&lt;code class=&quot;language-text&quot;&gt;MySQLdb&lt;/code&gt;在&lt;code class=&quot;language-text&quot;&gt;execute&lt;/code&gt;的时候会有警告，但是毕竟实现了功能。&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;MySQLdb&lt;/code&gt;这个库的使用不熟悉，在用它来执行sql语句的时候出现了很多问题，看来有时间得专门总结一下python驱动mysql的方法。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;今晚下班回的路上突然发现代码少写了很多异常检测，比如说没有判断网络链接失败，页面匹配为空等，真希望程序能够按照我设想的执行，等明天早上到了公司6张表都给我装得满满的，明天到了公司 再去修改代码了。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[通过vagrant安装coreos]]></title><description><![CDATA[昨晚学习了一下vagrant的用法，今天开始试着用vagrant来在本地虚拟化一个coreos的系统，等熟悉coreos的基本操作之后就可以把我现在vps的freebsd10换成coreos了...]]></description><link>https://joeyxf.com/posts/install-coreos-with-vagrant/</link><guid isPermaLink="false">https://joeyxf.com/posts/install-coreos-with-vagrant/</guid><pubDate>Fri, 26 Dec 2014 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;昨晚学习了一下vagrant的用法，今天开始试着用vagrant来在本地虚拟化一个coreos的系统，等熟悉coreos的基本操作之后就可以把我现在vps的freebsd10换成coreos了。&lt;/p&gt;
&lt;p&gt;按照&lt;a href=&quot;https://coreos.com/docs/running-coreos/platforms/vagrant/&quot;&gt;官方的教程&lt;/a&gt;一步一步来。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;git clone https://github.com/coreos/coreos-vagrant.git&lt;/code&gt; 会在当前目录创建一个叫做&lt;code class=&quot;language-text&quot;&gt;coreos-vagrant&lt;/code&gt;的目录，里面包含coreos的基本配置以及vagrant的配置。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;更改配置。vagrant的配置文件就是&lt;code class=&quot;language-text&quot;&gt;Vagrantfile&lt;/code&gt;，这是一个ruby的文件，里面定义了2个配置文件&lt;/p&gt;
&lt;p&gt;CLOUD&lt;em&gt;CONFIG&lt;/em&gt;PATH = File.join(File.dirname(&lt;strong&gt;FILE&lt;/strong&gt;), “user-data”)
CONFIG = File.join(File.dirname(&lt;strong&gt;FILE&lt;/strong&gt;), “config.rb”)&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;一个是当前目录下的&lt;code class=&quot;language-text&quot;&gt;user-data&lt;/code&gt;文件，一个是当前目录下的&lt;code class=&quot;language-text&quot;&gt;config.rb&lt;/code&gt;文件&lt;/p&gt;
&lt;pre&gt;
VirtualBox is complaining that the kernel module is not loaded. Please
run `VBoxManage --version` or open the VirtualBox GUI to see the error
message which should contain instructions on how to fix this error.
&lt;/pre&gt;
&lt;p&gt;根据Vagrantfile里面 提供的url下载系统的时候，可能是url被屏蔽了，所以需要使用点小手段&lt;code class=&quot;language-text&quot;&gt;proxychains vagrant up&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;但是等下载都完成之后却出现下面这段错误信息&lt;/p&gt;
&lt;pre&gt;
Command: [&quot;hostonlyif&quot;, &quot;create&quot;]

Stderr: 0%...
Progress state: NS_ERROR_FAILURE
VBoxManage: error: Failed to create the host-only adapter
VBoxManage: error: VBoxNetAdpCtl: Error while adding new interface: failed to open /dev/vboxnetctl: No such file or directory
VBoxManage: error: Details: code NS_ERROR_FAILURE (0x80004005), component HostNetworkInterface, interface IHostNetworkInterface
VBoxManage: error: Context: &quot;int handleCreate(HandlerArg*, int, int*)&quot; at line 66 of file VBoxManageHostonly.cpp
&lt;/pre&gt;
&lt;p&gt;听起来是virtualbox的网卡驱动没有加载进来，在网上搜到一个很简单的方法，&lt;code class=&quot;language-text&quot;&gt;sudo vboxreload&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;virtualbox的驱动问题解决之后，还是执行&lt;code class=&quot;language-text&quot;&gt;proxychains vagrant up&lt;/code&gt;但是这回却报错了&lt;/p&gt;
&lt;pre&gt;
Bringing machine &apos;core-01&apos; up with &apos;virtualbox&apos; provider...
Bringing machine &apos;core-02&apos; up with &apos;virtualbox&apos; provider...
Bringing machine &apos;core-03&apos; up with &apos;virtualbox&apos; provider...
==&gt; core-01: Checking if box &apos;coreos-stable&apos; is up to date...
==&gt; core-01: Fixed port collision for 22 =&gt; 2222. Now on port 2250.
==&gt; core-01: Clearing any previously set network interfaces...
==&gt; core-01: Preparing network interfaces based on configuration...
    core-01: Adapter 1: nat
    core-01: Adapter 2: hostonly
==&gt; core-01: Forwarding ports...
    core-01: 22 =&gt; 2250 (adapter 1)
==&gt; core-01: Running &apos;pre-boot&apos; VM customizations...
==&gt; core-01: Booting VM...
==&gt; core-01: Waiting for machine to boot. This may take a few minutes...
    core-01: SSH address: 127.0.0.1:2250
    core-01: SSH username: core
    core-01: SSH auth method: private key
    core-01: Warning: Remote connection disconnect. Retrying...
    core-01: Warning: Remote connection disconnect. Retrying...
&lt;/pre&gt;
&lt;p&gt;翻墙之后127.0.0.1是vps的内部loop地址，不是本机的，所以怎么也ssh不上去，既然东西都下载完了那就不需要代理了，直接&lt;code class=&quot;language-text&quot;&gt;vagrant up&lt;/code&gt;就有了下面的信息，太好了，这是在自动装系统呢。&lt;/p&gt;
&lt;pre&gt;
Bringing machine &apos;core-01&apos; up with &apos;virtualbox&apos; provider...
Bringing machine &apos;core-02&apos; up with &apos;virtualbox&apos; provider...
Bringing machine &apos;core-03&apos; up with &apos;virtualbox&apos; provider...
==&gt; core-01: Checking if box &apos;coreos-stable&apos; is up to date...
==&gt; core-01: There was a problem while downloading the metadata for your box
==&gt; core-01: to check for updates. This is not an error, since it is usually due
==&gt; core-01: to temporary network problems. This is just a warning. The problem
==&gt; core-01: encountered was:
==&gt; core-01:
==&gt; core-01: Failed to connect to 2404:6800:4008:c00::80: Network is unreachable
==&gt; core-01:
==&gt; core-01: If you want to check for box updates, verify your network connection
==&gt; core-01: is valid and try again.
==&gt; core-01: VirtualBox VM is already running.
==&gt; core-02: Importing base box &apos;coreos-stable&apos;...
==&gt; core-02: Matching MAC address for NAT networking...
==&gt; core-02: Checking if box &apos;coreos-stable&apos; is up to date...
&lt;/pre&gt;
&lt;p&gt;3台虚拟机全部安装ok，我有一个集群了，哈哈哈哈。查看一下集群的运行状态。&lt;/p&gt;
&lt;pre&gt;
Current machine states:

core-01                   running (virtualbox)
core-02                   running (virtualbox)
core-03                   running (virtualbox)

This environment represents multiple VMs. The VMs are all listed
above with their current state. For more information about a specific
VM, run `vagrant status NAME`.
&lt;/pre&gt;
&lt;p&gt;查看一下virtualbox的运行状态，有3个进程分别运行着3个虚拟机。&lt;/p&gt;
&lt;pre&gt;
joey     10033  1.1  0.2 163232  9492 ?        Sl   22:33   0:08 /usr/lib/virtualbox/VBoxXPCOMIPCD
joey     10040  2.6  0.4 707156 19324 ?        Sl   22:33   0:20 /usr/lib/virtualbox/VBoxSVC --auto-shutdown
joey     11184  3.8  1.9 1497696 74992 ?       Sl   22:33   0:28 /usr/lib/virtualbox/VBoxHeadless --comment coreos-vagrant_core-01_1419632903871_39166 --startvm 29a5b99b-dfa8-48e6-b18f-d63b01696df2 --vrde config
joey     11204  0.0  0.2 154828  9228 ?        S    22:33   0:00 /usr/lib/virtualbox/VBoxNetDHCP --ip-address 192.168.56.100 --lower-ip 192.168.56.101 --mac-address 08:00:27:AA:0D:77 --netmask 255.255.255.0 --network HostInterfaceNetworking-vboxnet0 --trunk-name vboxnet0 --trunk-type netflt --upper-ip 192.168.56.254
joey     27124 10.2  1.9 1527828 76788 ?       Sl   22:40   0:32 /usr/lib/virtualbox/VBoxHeadless --comment coreos-vagrant_core-02_1419633622663_70678 --startvm 07c05704-61e7-4e61-bebd-723978180348 --vrde config
joey     28280 17.8  2.0 1523732 81576 ?       Sl   22:43   0:28 /usr/lib/virtualbox/VBoxHeadless --comment coreos-vagrant_core-03_1419633784764_52573 --startvm f614df63-7556-45ac-a4ca-3654d6039d3d --vrde config
joey     29297  0.0  0.0  12384  2400 pts/2    R+   22:45   0:00 grep --color=auto -i virtualbox
&lt;/pre&gt;
&lt;p&gt;再看一下我的&lt;code class=&quot;language-text&quot;&gt;VirtualBox VMs&lt;/code&gt;目录：&lt;/p&gt;
&lt;pre&gt;
coreos-vagrant_core-01_1419632903871_39166/  coreos-vagrant_core-03_1419633784764_52573/
coreos-vagrant_core-02_1419633622663_70678/  Public_default_1419540157403_62624/
&lt;/pre&gt;
&lt;p&gt;昨天还只有&lt;code class=&quot;language-text&quot;&gt;Public_default_1419540157403_62624/&lt;/code&gt;一个目录，今天就多了3个了，算上昨天的那个ubuntu12.04，我是不是有4个虚拟系统了？&lt;/p&gt;
&lt;p&gt;进入到我的&lt;code class=&quot;language-text&quot;&gt;Vagrantfile&lt;/code&gt;所在的目录，执行&lt;code class=&quot;language-text&quot;&gt;vagrant ssh core-01&lt;/code&gt;，就登陆进我的第一个虚拟机了。&lt;/p&gt;
&lt;p&gt;剩下的就是学习如何使用coreos在上面部署开发环境了，有vagrant这么方便的工具来管理虚拟机，我都不想去研究docker了，我这样一个菜鸟竟然也能管理4台机器，科技真是使人懒惰。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[第一次接触虚拟化]]></title><description><![CDATA[说discourse是未来十年互联网论坛发展的趋势，那就搭一个来看看呗，反正以前也学过一阵子ruby on rails...]]></description><link>https://joeyxf.com/posts/learn-virtualization/</link><guid isPermaLink="false">https://joeyxf.com/posts/learn-virtualization/</guid><pubDate>Thu, 25 Dec 2014 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;之前在我的vps上部署了一个&lt;a href=&quot;http://f.joxy.org&quot;&gt;php论坛&lt;/a&gt;，但是后来这个框架的&lt;a href=&quot;https://github.com/esotalk/&quot;&gt;创始人&lt;/a&gt;突然在github上宣布重构了&lt;a href=&quot;https://github.com/esotalk/esoTalk&quot;&gt;esotalk&lt;/a&gt;的代码做了一个新的论坛框架&lt;a href=&quot;https://github.com/flarum/core&quot;&gt;Flarum&lt;/a&gt;，搞得我很伤心，后来在&lt;a href=&quot;https://en.wikipedia.org/wiki/Comparison_of_Internet_forum_software&quot;&gt;wiki&lt;/a&gt;上看到介绍discourse，它的作者&lt;a href=&quot;http://www.codinghorror.com/blog&quot;&gt;Jeff Atwood&lt;/a&gt;说discourse是未来十年互联网论坛发展的趋势，那就搭一个来看看呗，反正以前也学过一阵子ruby on rails.&lt;/p&gt;
&lt;p&gt;按照原来部署&lt;a href=&quot;http://f.joxy.org&quot;&gt;http://f.joxy.org&lt;/a&gt;的模式打算先在本地部署好环境，然后提交到git server然后在线上拷贝一份代码到服务器上。但是看discourse的官方安装文档的时候发现默认是不支持在实体机上安装系统的，官方的文档只支持通过docker来部署discourse，docker久仰大名了但是就是没有用过，那好，就去见识见识呗。&lt;/p&gt;
&lt;p&gt;搜索了一下发现现在比较流行的服务器环境配置，服务器管理都是通过container也就是容器来进行的，最老土的服务器管理方式是通过ssh连接上服务器，然后手动编译或者包管理的形式安装软件。但是这种方式有很大的局限性，不易把所有的机器都统一配置，因为所有配置文件都要由手动编辑，然后手动更新，必然有的机器版本早，有的机器版本晚，对于管理一个服务器集群来说这是很不方便的。而且服务器多了软件更新就是一个麻烦事，不可能一台机器一台机器的去更新。&lt;/p&gt;
&lt;p&gt;目前找到了3个比较有名的虚拟化技术：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;docker， 更类似于chroot&lt;/li&gt;
&lt;li&gt;vagrant，用来管理virtualbox虚拟机&lt;/li&gt;
&lt;li&gt;rocket，暂时没什么太多了解&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;早上出门的时候在youtube上看了一个通过docker来安装coreos的视频，但是感觉要学习yaml语法配置，比较繁琐，那就先来看看vagrant吧。&lt;/p&gt;
&lt;p&gt;在vagrant的&lt;a href=&quot;http://docs.vagrantup.com/v2/getting-started/index.html&quot;&gt;官方文档&lt;/a&gt;上找到了简单的使用方法，其实说白了就是一个自动安装运行virtualbox的脚本。首先得安装vagrant，&lt;code class=&quot;language-text&quot;&gt;sudo pacman -S vagrant&lt;/code&gt;，然后得安装virtualbox，&lt;code class=&quot;language-text&quot;&gt;sudo pacman -S virtualbox&lt;/code&gt;，然后还得安装一大堆的依赖，&lt;code class=&quot;language-text&quot;&gt;sudo pacman -S virtualbox-host-modules&lt;/code&gt;是用来安装virtualbox用来和宿主机通信的模块，如果这个软件太老了就会无法正常使用vagrant，那么一个补救措施就是&lt;code class=&quot;language-text&quot;&gt;sudo pacman -S virtualbox-host-dkms&lt;/code&gt;，virtualbox安装好了之后还得解决一些内核的驱动，最简单的就是&lt;code class=&quot;language-text&quot;&gt;sudo dkms autoinstall&lt;/code&gt;，这个命令会自动搜索&lt;code class=&quot;language-text&quot;&gt;linux-headers&lt;/code&gt;然后编译对应的驱动，如果系统上没有装&lt;code class=&quot;language-text&quot;&gt;linux-header&lt;/code&gt;那么还是会报错的，那就得&lt;code class=&quot;language-text&quot;&gt;sudo pacman -S linux-headers&lt;/code&gt;。需要安装的软件，驱动，都装好了之后就是在内核加载virtualbox的驱动了，很简单&lt;code class=&quot;language-text&quot;&gt;sudo modprobe vboxdrv&lt;/code&gt;，这时候就大功告成了。&lt;/p&gt;
&lt;p&gt;对照着教程在自己的笔记本上一步一步的做，先&lt;code class=&quot;language-text&quot;&gt;vagrant init hashicorp/precise32&lt;/code&gt;，这回在当前的目录下创建一个叫作&lt;code class=&quot;language-text&quot;&gt;Vagrantfile&lt;/code&gt;的文件，这里面包含了一大堆虚拟机的配置信息。然后&lt;code class=&quot;language-text&quot;&gt;vagrant up&lt;/code&gt;就会启动虚拟机，这时候&lt;code class=&quot;language-text&quot;&gt;ps aux | grep -i virtualbox&lt;/code&gt;就会发现virtualbox已经自动在运行了，在家目录的&lt;code class=&quot;language-text&quot;&gt;VirtualBox\ VMs/&lt;/code&gt;目录下也会创建对应虚拟机的目录，但是没有启动那个讨厌的图形界面这很不错。因为vagrant主要是用来配置服务器的，所以不需要图形界面，等系统下载安装好了之后就可以执行&lt;code class=&quot;language-text&quot;&gt;vagrant up&lt;/code&gt;来启动虚拟机了，这个操作会检测是否有&lt;code class=&quot;language-text&quot;&gt;Vagrantfile&lt;/code&gt;里面写的系统，如果没有就会自动从网上下载。系统下完之后&lt;code class=&quot;language-text&quot;&gt;vagrant ssh&lt;/code&gt;可以远程连接上虚拟机，发现虚拟机上面有一个网卡ip是&lt;code class=&quot;language-text&quot;&gt;10.0.2.15&lt;/code&gt;，好奇怪的东西，联网方式是NAT还是bridge呢？有一个自动安装系统的脚本，叫作&lt;code class=&quot;language-text&quot;&gt;postinstall.sh&lt;/code&gt;，以root身份执行它会自动安装系统，等最后跑完的时候吓我一大跳&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;++ &lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; -f &lt;span class=&quot;token string&quot;&gt;&apos;/home/vagrant/*.iso&apos;&lt;/span&gt; /home/vagrant/postinstall.sh
++ &lt;span class=&quot;token function&quot;&gt;dd&lt;/span&gt; if&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/dev/zero of&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;/EMPTY bs&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1M
dd: writing `/EMPTY&apos;: No space left on device
78697+0 records &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
78696+0 records out
82518818816 bytes &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;83 GB&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; copied, 207.558 s, 398 MB/s
++ &lt;span class=&quot;token function&quot;&gt;rm&lt;/span&gt; -f /EMPTY
++ &lt;span class=&quot;token keyword&quot;&gt;exit&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;一下dd我83G的硬盘，这可是我整个宿主机所有的空间了，不会影响到我吧，后来&lt;code class=&quot;language-text&quot;&gt;df -h&lt;/code&gt;了一下才发现虚拟机没有使用多少硬盘空间，而且宿主机也没有消耗掉很多硬盘空间。这样就有了一台虚拟机了，这可比直接用virtualbox方便多了，没有预先问我分配多少颗CPU，没有问我分配多少RAM，没有问我分配多少硬盘就把系统装好了，我喜欢。&lt;/p&gt;
&lt;p&gt;vagrant有一个共享目录就是宿主机的&lt;code class=&quot;language-text&quot;&gt;Vagrantfile&lt;/code&gt;所在的那个目录，也是虚拟机的&lt;code class=&quot;language-text&quot;&gt;/vagrant&lt;/code&gt;目录，这个目录双方都可以读写，想想真是有点小激动，要是以后我虚拟一个windows出来在上面跑一个qq，然后今天志军通过qq传给我的《刺杀金正恩》就不用在windows上跑着vlc服务器给我的arch笔记本供源了，不知道有没有人为vagrant做windows的box。&lt;/p&gt;
&lt;p&gt;不过vagrant毕竟是建立在virtualbox之上的，虽然说虚拟机占用宿主机的资源少了，但是还可以做得更好，要让机器资源更加充分的利用就得学习docker了，加油。&lt;/p&gt;
&lt;p&gt;另外今天和小青谈了一下学习方式的问题，他说我三天打鱼两天晒网没有持之以恒的做一件事，想想也确实是这样，从工作开始学习和使用php来干活，python是原来就会的所以也就没有怎么学，但是又学了几个礼拜ruby，学了几个礼拜haskell，工作在二次开发discuz，但是业余时间却自己搭了一个esotalk的论坛，现在又在研究虚拟化技术。虽然我一直认为身为一个互联网从业者就得把握住互联网的发展方向，不断学习最新的技术，我们生活在一个很开放的社会，最新最热的技术都是开源的有详细的文档，如果不去学习不去研究而是抱着把会的东西研究透彻的话，我有种辜负了这个时代的感觉。希望时代别辜负了我。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[调试discuz]]></title><description><![CDATA[现在他们在做一个论坛，因为人手不够，所以最后决定使用discuz来快速搭建一个论坛。我是很反感这种做法的，大公司怎么会用discuz来搭建自己的社区呢？太丢脸了，这不是告诉别人你没有研发能力吗...]]></description><link>https://joeyxf.com/posts/debug-discuz-site/</link><guid isPermaLink="false">https://joeyxf.com/posts/debug-discuz-site/</guid><pubDate>Sat, 01 Nov 2014 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;现在他们在做一个论坛，因为人手不够，所以最后决定使用discuz来快速搭建一个论坛。我是很反感这种做法的，大公司怎么会用discuz来搭建自己的社区呢？太丢脸了，这不是告诉别人你没有研发能力吗？不过现在我们这边的研发能力确实很弱，公司不是研发型的，太悲哀了。&lt;/p&gt;
&lt;p&gt;我以前从没有接触过discuz，第一次碰到感觉压力很大，什么数据字典，缓存结构，插件机制，模板机制我都不懂，最初他们只叫我做了一点简单的部署问题，比如改个nginx的rewrite规则，改个简单的模板样式，不过渐渐的麻烦的任务也来了。&lt;/p&gt;
&lt;p&gt;首先是说他们买了一个模板（真够丢人的），但是这个模板是被加密了的，现在要稍微二次开发一下，比如说改一些url的规则，使得url更加seo友好。其实模板上的url还是很好改的，模板改了之后再加点rewrite到nginx就好了。但是在分页上的url就不好改了，需要去看插件是如何获得数据，输出数据的，结果可恨的是这个插件的开发者把取数据，传数据的过程都给加密了，让人非常郁闷。到最后甚至一度想要把这些加密的方法破解了，不过到底不可能花太多时间去破解，干活才是最重要的。&lt;/p&gt;
&lt;p&gt;调了一晚上，终于发现了插件在实现分页的时候调用到了一个discuz的分页函数，在&lt;code class=&quot;language-text&quot;&gt;source/function/&lt;/code&gt;里面执行&lt;code class=&quot;language-text&quot;&gt;grep &amp;#39;multi&amp;#39; -R *&lt;/code&gt;在&lt;code class=&quot;language-text&quot;&gt;function_core.php&lt;/code&gt;这个文件里找到了multi这个函数，然后发现这个函数调用了&lt;code class=&quot;language-text&quot;&gt;helper_page::multi&lt;/code&gt;这个函数，继续找这个函数。首先找&lt;code class=&quot;language-text&quot;&gt;helper_page&lt;/code&gt;这个类，那就去&lt;code class=&quot;language-text&quot;&gt;source/class/&lt;/code&gt;里面找，&lt;code class=&quot;language-text&quot;&gt;grep &amp;#39;multi&amp;#39; -R *&lt;/code&gt;在&lt;code class=&quot;language-text&quot;&gt;helper/helper_page.php&lt;/code&gt;里面找到了multi这个静态方法。接下来就是改造这个方法了。大致看了一下，这个函数接受一个url，一个当前页码，以及一些不太重要的东西作为参数，最后输出一段分页代码。在生成html的时候调用到了一个叫做&lt;code class=&quot;language-text&quot;&gt;mpurl&lt;/code&gt;的方法，这个函数会决定使用什么形式的分隔符来输出url。到这里形势大概就很明朗了，我不必要去改分页函数的逻辑，我只要改&lt;code class=&quot;language-text&quot;&gt;mpurl&lt;/code&gt;这个函数就好了，如果是这个插件的url，我就让这个函数特殊照顾一下这个插件。&lt;/p&gt;
&lt;p&gt;那么现在问题来了，我是该怎么去改造这个函数呢？在它里面加判断？外面加判断？重写一个自定义的函数？我的想法是加入一个自定义的分页函数，&lt;code class=&quot;language-text&quot;&gt;multi&lt;/code&gt;在调用&lt;code class=&quot;language-text&quot;&gt;mpurl&lt;/code&gt;的时候会判断一下是调用它还是调用我写的自定义的函数。我想要通过函数名复制来实现，但是我不知道在php里怎么做，所以我就去&lt;a href=&quot;http://stackoverflow.com/questions/26657161/can-i-assign-a-function-in-php&quot;&gt;stackoverflow&lt;/a&gt;上问了一下，有个家伙说可以通过变量来保存函数名，比如说&lt;code class=&quot;language-text&quot;&gt;$func = &amp;#39;add&amp;#39;;&lt;/code&gt;，那么&lt;code class=&quot;language-text&quot;&gt;$func(1,2);&lt;/code&gt;就等同于&lt;code class=&quot;language-text&quot;&gt;add(1,2);&lt;/code&gt;了。这个方法有点函数式编程的意思了，不过还是不够，本质上不属于函数名赋值，而且对于调用类里的方法不起作用，我尝试着&lt;code class=&quot;language-text&quot;&gt;$func = &amp;#39;self::add&amp;#39;&lt;/code&gt;，然后发现总是会报错。后来采用了另一个家伙的方法，写一个帮助函数，在这个帮助函数里面会判断到底是使用dz原生的&lt;code class=&quot;language-text&quot;&gt;mpurl&lt;/code&gt;还是使用我的&lt;code class=&quot;language-text&quot;&gt;my_mpurl&lt;/code&gt;，这个方法挺好，我照着做了，终于把分页搞定了。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[学习haskell（二）]]></title><description><![CDATA[今天发现一件很有趣的事，我在ghci下输入`:i zip`来查看zip这个函数的用法的时候得到的结果是`zip :: [a] -> [b] -> [(a, b)] 	-- Defined in ‘GHC.List’`，zip明明是接收2个列表作为参数，然后一个元组的列表，但是根据这个输出，感觉zip是先处理列表[a]，然后再处理列表[b]，最后得到一个得到一个列表[(a, b)]...]]></description><link>https://joeyxf.com/posts/learn-haskell-2/</link><guid isPermaLink="false">https://joeyxf.com/posts/learn-haskell-2/</guid><pubDate>Sun, 26 Oct 2014 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;今天发现一件很有趣的事，我在ghci下输入&lt;code class=&quot;language-text&quot;&gt;:i zip&lt;/code&gt;来查看zip这个函数的用法的时候得到的结果是&lt;code class=&quot;language-text&quot;&gt;zip :: [a] -&amp;gt; [b] -&amp;gt; [(a, b)] 	-- Defined in ‘GHC.List’&lt;/code&gt;，zip明明是接收2个列表作为参数，然后一个元组的列表，但是根据这个输出，感觉zip是先处理列表[a]，然后再处理列表[b]，最后得到一个得到一个列表[(a, b)]。&lt;/p&gt;
&lt;p&gt;为了验证我的猜想，先试&lt;code class=&quot;language-text&quot;&gt;zip [1,2,3] [3,2,1]&lt;/code&gt; 得到 &lt;code class=&quot;language-text&quot;&gt;[(1,3),(2,2),(3,1)]&lt;/code&gt;。这是意料之中的，zip的作用就是这个。&lt;/p&gt;
&lt;p&gt;然后再试验：&lt;code class=&quot;language-text&quot;&gt;(zip [1,2,3]) [3,2,1]&lt;/code&gt; 得到 &lt;code class=&quot;language-text&quot;&gt;[(1,3),(2,2),(3,1)]&lt;/code&gt;，在这个函数调用中，我用括号把前一部分括起来了，也就是说先处理一个列表，然后返回一个函数再处理另一个列表。很奇怪，在实际函数调用中使用的是什么顺序来求值的呢？&lt;/p&gt;
&lt;p&gt;在&lt;a href=&quot;http://stackoverflow.com/questions/26571897/haskell-function-invoke-order&quot;&gt;stackoverflow&lt;/a&gt;上面问了一下这个问题，原来这种现象有一个专业术语叫作&lt;a href=&quot;http://en.wikipedia.org/wiki/Currying&quot;&gt;currying&lt;/a&gt;，也就是说函数如何处理多个参数。没有看到后面就问问题还是比较尴尬的，在haskell里面大名鼎鼎的术语都不知道，太丢人了。&lt;/p&gt;
&lt;p&gt;后来我在搜索curry的时候还发现了&lt;a href=&quot;http://www-history.mcs.st-andrews.ac.uk/Biographies/Curry.html&quot;&gt;Haskell Brooks Curry&lt;/a&gt;这个人，haskell就是以他的名字命名的，真是牛得不行的一个家伙，16岁上哈佛，先是学医，后来又转学数学，后来有修了一个物理学的硕士，博士又开始搞数学，开始是打算写偏微分方面的论文的，到最后发现兴趣在逻辑学上，就转而研究逻辑去了。在40岁的时候成为了世界上最有名的逻辑学家。haskell的爱好者看起来都有很强的数理逻辑的背景啊，对于写过程式的代码也许真会越写越傻，因为思维到最后都变成机器的思维了。&lt;/p&gt;
&lt;p&gt;还有一件很有意思的事就是惰性求值，在别的语言里可真是不多见。所谓的惰性求值就是如果这个变量没有被用到那就不会去求值。比如说&lt;code class=&quot;language-text&quot;&gt;let a = 1&lt;/code&gt;，在这里定义了一个变量a，但是其实这时候a还没有求值，只有在我们调用a的时候才会打印它的值。再比如说&lt;code class=&quot;language-text&quot;&gt;let a = cycle [1,2,3]&lt;/code&gt;，这会一直循环[1,2,3]这个列表，但是如果我们不去调用a就没关系，反正不调用就没有值。或者我们&lt;code class=&quot;language-text&quot;&gt;take 10 a&lt;/code&gt;，就会得到返回列表的前10个值，在这里调用了a，但是在求值的时候只用到了前10个，所以a没有一直循环下去。别的语言有这种定义无限个元素的列表的能力吗？别的语言有惰性求值的能力吗？&lt;/p&gt;</content:encoded></item><item><title><![CDATA[学习haskell（一）]]></title><description><![CDATA[上周去国图还书的时候无意中看到了一本讲haskell的书，就顺手借回来了。想想第一次听说haskell这个名字还是从王垠的博客里看到的，那时候听他在博客里讲惰性求值，列表解析，lambda函数啊，什么的...]]></description><link>https://joeyxf.com/posts/learn-haskell-1/</link><guid isPermaLink="false">https://joeyxf.com/posts/learn-haskell-1/</guid><pubDate>Sat, 25 Oct 2014 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;上周去国图还书的时候无意中看到了一本讲haskell的书，就顺手借回来了。想想第一次听说haskell这个名字还是从王垠的博客里看到的，那时候听他在博客里讲惰性求值，列表解析，lambda函数啊，什么的，根本听不懂。不过到现在为止，深入学习了python，对于列表解析，lambda函数还算是有一个浅浅的了解。而且已经学习过scheme和sml了，虽然都没有花太多时间去学习它们，但是至少对函数式编程了解了一个大概。&lt;/p&gt;
&lt;p&gt;以我目前对于函数式编程的理解来说，主要就是一切都是函数，数据是函数，函数也是函数。一个变量只有一个值，不能通过赋值来改变一个变量的值，只能让它重新绑定到另外一个值，所以变量的状态不会改变，不会出现副作用。这些都是一些很粗浅的理解，毕竟没有正儿八经的研究过函数式编程。主要有一个原因就是现在用函数式语言来开发的项目不多，我们学习编程主要还是用来解决实际问题，如果这门语言现实中没什么人用，或者是没法用到，那么学习它的激情就不会太高，虽然说学习过之后可能会提升编程思维。目前我了解的比较有名的函数式语言开发的项目有emacs，这个是用elisp语言来开发的一个编辑器，很强大。texmacs，一个所见即所得的tex编辑器，用的是scheme开发的。guile，gnu世界中的一个lisp编译器，能把lisp代码编译为c语言代码。chicken scheme，又一个scheme的编译器，按照官网说的它编译机器码的效率也是很高的，而且好像第三方库也比较多。lisp族就这些了，而sml族就没有听说过什么大的项目，不得不说很令人沮丧。相比现在流行的c/c++,java,perl/python/php等语言，函数式语言处于一个很小众的地位。为什么这种语言这么强大但是却没什么发展呢？真是搞不懂。&lt;/p&gt;
&lt;p&gt;后面开始去搜索haskell的相关信息，发现在80年代的时候一伙科学家发现函数式语言类别太多了，各种lisp变种太多，都有自己的优点，于是这伙人就想要一统函数式语言的天下，他们组建了一个小团体来研究未来的函数式语言。不得不说，开发这事就是得有很多人参与，没什么人参与的项目肯定不会发展的太好，linux的发展是这样，python是这样，都是有一个很大的志愿者团体来维护的，而像freebsd和scheme这样的东西则是在各个很牛逼的大学小范围流传。&lt;/p&gt;
&lt;p&gt;haskell算是一个严格类型的语言，也就是说每个变量都有一个类型，数字和字符串之间不能直接操作。目前python和php代码写多了导致我不是很喜欢这个特性，每个变量都有一个类型，多麻烦，数字和字符串之间不能强制转换，不能比较，不能拼接，诸多不便。即使是scheme也不是强类型的，把一个数字添加到一个列表后面在scheme里面是很正常的。sml在这点和haskell差不多，不过sml比haskell更加严格，在定义函数的时候得写明函数接收哪些类型的参数。&lt;/p&gt;
&lt;p&gt;不过强类型语言也有一个优点就是执行效率高，在编译过程中执行类型检测，发现问题直接报告异常然后退出，而不是在运行时报告异常。而且强类型语言生成的代码跑起来的时候需要更少的内存。&lt;/p&gt;
&lt;p&gt;haskell有自己的编译器，似乎种类有好几种，我在archlinux上用的是ghc，这个编辑器自带了一个解释器叫做ghci，安装好之后在终端输入ghci就能进入解释器，一行一行的执行输入的表达式了。python，php，ruby，scheme，sml都有自己的解释器，能够对每一个表达式求值，真方便。我最讨厌要编译机器码的语言了。&lt;/p&gt;
&lt;p&gt;haskell有多种内置的类型，我现在接触了数字，字符串，列表，元组这4个类型。要定义一个变量也很简单，直接&lt;code class=&quot;language-text&quot;&gt;let a = 1&lt;/code&gt;这样就定义了一个变量a，它绑定了一个数字1,当然我们也可以理解为这行代码定义了一个函数，当执行这个函数的时候会返回一个数字1,在这里函数也变成普通变量了。&lt;/p&gt;
&lt;p&gt;字符串是用双引号引起来的，&lt;code class=&quot;language-text&quot;&gt;let s = &amp;quot;hello&amp;quot;&lt;/code&gt; 就生成了一个字符串变量s，是把它当作函数还是当作普通变量就看个人喜好了。如果要获得某个字符串中间的一个字符，可以使用&lt;code class=&quot;language-text&quot;&gt;!!&lt;/code&gt;操作符，比如说&lt;code class=&quot;language-text&quot;&gt;&amp;quot;hello&amp;quot; !! 2&lt;/code&gt; 会返回一个’l’，看惯了c数组风格的字符串索引再来看haskell的形式，真是不习惯。&lt;/p&gt;
&lt;p&gt;列表是函数式语言的最重要的数据结构，从50年代麦卡锡发明的表处理语言开始，在各个函数式语言里都可以看到列表的各种表现形式。scheme的car和cdr，sml的hd和tl，而在haskell里面则是head和tail。定义一个列表&lt;code class=&quot;language-text&quot;&gt;let l = [1,2,3,4]&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;head l&lt;/code&gt;返回列表第一个元素，&lt;code class=&quot;language-text&quot;&gt;tail l&lt;/code&gt;返回列表除了第一个元素外剩下的元素，&lt;code class=&quot;language-text&quot;&gt;init l&lt;/code&gt;返回列表除了最后一个元素外的所有元素，&lt;code class=&quot;language-text&quot;&gt;last l&lt;/code&gt;返回最后一个元素。剩下的还有maximum, minimum, reverse, length, null, take, drop, sum, product, elem等方法，看得眼花缭乱啊，至于为一个这么基本的数据结构写这么多方法吗？ 对于列表还有一个很重要的特性就是可以生成一个列表范围，如果一个集合的元素是可以用很清晰的语言枚举出来的话那么这个集合可以用列表表示出来，比如说如果要生成1到100的所有整数，那么只要&lt;code class=&quot;language-text&quot;&gt;[1 .. 100]&lt;/code&gt;就可以了，如果要确定步长的话只要枚举前2个元素就好了&lt;code class=&quot;language-text&quot;&gt;[1, 3 .. 100]&lt;/code&gt;这样就生成了1到100的所有奇数。那么能不能生成[1,2,4,8 …]这样的变步长的列表呢？很遗憾，haskell没有把这种列表写入最基本的列表方法里面，也很好理解，对于变步长的列表给出了前几个元素不是很好推测下一个元素，如果不清楚它那么就不能实现它，写程序的至理名言。&lt;/p&gt;
&lt;p&gt;接下来就涉及到列表解析了，它对应数学里面一个很重要的概念—集合，&lt;code class=&quot;language-text&quot;&gt;{x | x &amp;lt; 10，x是正整数}&lt;/code&gt;这是一个很简单的集合，在haskell里面就是&lt;code class=&quot;language-text&quot;&gt;[1 .. 9]&lt;/code&gt;。如果集合是&lt;code class=&quot;language-text&quot;&gt;{x | x &amp;lt; 10，x是偶数}&lt;/code&gt;，在haskell里面就是&lt;code class=&quot;language-text&quot;&gt;[x | x &amp;lt;- [1 .. 9], x `mod` 2 == 0]&lt;/code&gt;，这就是很简单的列表解析了。&lt;/p&gt;
&lt;p&gt;元组和列表差不多，不过限制比较松散，列表要求所有的元素都是同一个类型的，而元组没有这个限制&lt;code class=&quot;language-text&quot;&gt;(1, 2, &amp;quot;hello&amp;quot;)&lt;/code&gt;这样就建立了一个三个元素的元组，&lt;/p&gt;
&lt;p&gt;haskell是一门很有前景的语言，得好好学学，希望能够坚持每天学点haskell，每天积累一点新知识。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[再来记录一次紧急情况]]></title><description><![CDATA[昨晚12点多的时候突然被从被窝里拉出来了，虽然不再睡觉，但是这种感觉也是很不爽的，就因为我负责的一个网站首页出现500...]]></description><link>https://joeyxf.com/posts/emergency-case-1/</link><guid isPermaLink="false">https://joeyxf.com/posts/emergency-case-1/</guid><pubDate>Sat, 18 Oct 2014 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;昨晚12点多的时候突然被从被窝里拉出来了，虽然不再睡觉，但是这种感觉也是很不爽的，就因为我负责的一个网站首页出现500错误，提示数据库不能连接了。
妈呀，这么大的事，怎么还能安心玩手机，赶紧起来查找原因。&lt;/p&gt;
&lt;p&gt;目前我这个站是搭建在2台服务器上的，用这2台机器来做负载均衡，跑了3个多月了，一点事都没有， 怎么会突然连不上数据库呢。查看了一下配置，这个站连接着
2个mysql，不是主从，而是业务分开的2个数据库，因为要把2块不太相关的内容整合在一起，通过vpn连接上公司的内网，ssh上服务器尝试连接数据库，第一个数据库
连接正常，但是尝试连接第二个数据库的时候就出现连接错误了，服务器拒绝连接了。很显然，要么这个数据库所在的服务器宕机了，要么就是这个数据库的请求数太多了，
为了避免宕机，数据库自动进入一种保护机制，拒绝所有后来的连接。&lt;/p&gt;
&lt;p&gt;尝试这ping了一下服务器，没有宕机，还好，看来就是一个db出问题了，这个db之前也出过问题，当时运维是更改了配置，增加了数据库的最大连接数上限，不过这么晚的时候
找运维也不好找，人家也不愿意大半夜从床上跑起来给你改服务器配置。那么没办法了，只能改代码了。只能把所有涉及到第二个数据库的代码都删了，这样还有一线生机。&lt;/p&gt;
&lt;p&gt;因为我的站点结构比较简单，内容只包括视频和文章，视频来自一个数据库，文章来自另一个数据库，只要把文章都干掉就ok，还好文章也不多，而且在页面上结构挺分离的，
还算比较好弄，在配置里面删除第二个数据库的配置，在控制器里删除调用了第二个数据库的方法，在页面上删除文章所在的div，然后刷新页面，ok好了。&lt;/p&gt;
&lt;p&gt;真是惊险刺激啊，要是我没有vpn的话这个站就得挂一晚上，要是文章和视频的耦合度太高的话我也束手无策，要是前端设计的页面太复杂的话也会给我的改动带来很多麻烦。还好
这些假设都不存在。感谢Yii框架，大爱。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[命令行连接vpn]]></title><description><![CDATA[今天拿到vpn了，真是兴奋啊，早在实习结束的时候就要求了vpn，结果5个月后才拿到手，真是的。 拿到了vpn意味着以后可以早点下班...]]></description><link>https://joeyxf.com/posts/connect-to-vpn-through-cmd/</link><guid isPermaLink="false">https://joeyxf.com/posts/connect-to-vpn-through-cmd/</guid><pubDate>Mon, 29 Sep 2014 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;今天拿到vpn了，真是兴奋啊，早在实习结束的时候就要求了vpn，结果5个月后才拿到手，真是的。
拿到了vpn意味着以后可以早点下班，有事情在家里远程办公还是无休止的工作，休息即工作呢？
希望我不会把工作和生活混乱了。&lt;/p&gt;
&lt;p&gt;拿到的vpn就3条信息，一个服务器ip，帐号，密码。也不说一下vpn服务器是用什么软件部署的，这让我怎么
挑客户端软件来连接呢？万一服务器和客户端所用的协议不一样我不是浪费时间吗。算了，都已经这么晚了
还是先随便试一个吧，如果有问题明天到了公司再说。&lt;/p&gt;
&lt;p&gt;首先试的是pptp的客户端，因为这是使用最广泛的vpn协议了，虽然之前好像看到过这种通信的加密很弱，但是
没关系，又不发表反动言论。&lt;/p&gt;
&lt;p&gt;首先要安装pptp的客户端，很简单，&lt;code class=&quot;language-text&quot;&gt;sudo pacman -S pptpclient&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;然后需要配置一下vpn连接的参数，比如说服务器ip多少，帐号密码多少。最麻烦的方法莫过于手动改写配置文件了，但是
还好pptp自带了一个setup的功能，一条命令就可以创建vpn连接。
&lt;code class=&quot;language-text&quot;&gt;pptpsetup --create my_tunnel --server vpn.example.com --username alice --password foo --encrypt&lt;/code&gt;
把my_tunnel替换成一个隧道别名，以后就可以使用这个别名来连接指定的vpn服务器了。
在—server参数后改为需要连接的ip地址，作为公司内部访问才不会为vpn服务配置一个域名呢，又不是给外人开放使用，没必要好记。
在—username参数后面输入分配的用户名
然后回车执行这条命令就会提示输入密码，输入密码，ok如果没问题的话现在已经创建好了一个vpn连接，接下来需要做的就是启用这个连接。&lt;/p&gt;
&lt;p&gt;直接&lt;code class=&quot;language-text&quot;&gt;pon my_tunnel&lt;/code&gt;就可以开启这个vpn连接了，然后输入&lt;code class=&quot;language-text&quot;&gt;ifconfig&lt;/code&gt;查看一下，如果出现了ppp0这个接口那就说明连接建立成功。&lt;/p&gt;
&lt;p&gt;这时候试图访问公司内网，可是还是连接不上去，因为没有配置路由规则，默认情况下流量都走wlp3s0这个接口了，这是我的无线网卡的接口。
稍微配置一下公司服务器网段就行了，内部测试机是192.168.10.0/24的网段，所以在命令行输入&lt;code class=&quot;language-text&quot;&gt;ip route add 192.168.10.0/24 dev ppp0&lt;/code&gt;
然后就可以在本地通过ssh连接这个网段的机器了。&lt;/p&gt;
&lt;p&gt;昨晚遇到一个紧急情况，又用了一下vpn，不知道为什么可以连接，也可以执行一些简单的命令，比如cd，ls，svn之类的，就是不能执行vim, cat这类命令，一查看某个文件
连接就会卡死，不得不在本地kill掉这个ssh会话，kill掉之后ppp0这个接口也自动关闭了，又得重新开一遍。不知道是什么原因。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[使用fish]]></title><description><![CDATA[从最初安装ubuntu到现在细细数来已经用过很多个Unix like system了，也经历过很多种shell从linux下标准的bash，到freebsd的tcsh...]]></description><link>https://joeyxf.com/posts/use-fish/</link><guid isPermaLink="false">https://joeyxf.com/posts/use-fish/</guid><pubDate>Sun, 31 Aug 2014 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;从最初安装ubuntu到现在细细数来已经用过很多个Unix like system了，也经历过很多种shell
从linux下标准的bash，到freebsd的tcsh，到补全功能非常强大的zsh，现在尝试了一个新的fish。
这不是鱼，全名叫做(friendly interactive shell)，用户友好的shell，语法高亮功能使得不容易
输错命令，自动补全功能比zsh还强大，能够根据man page里的关键字来补全，也能根据~/.ssh/config来
补全ssh命令，历史记录功能也比bash之类的友好。&lt;/p&gt;
&lt;p&gt;fish的项目主页在&lt;a href=&quot;https://github.com/fish-shell/fish-shell&quot;&gt;这里&lt;/a&gt;，可以看到这个项目的还是比较
活跃的。因为我用的是archlinux，所以就没有去从build源代码，而是直接&lt;code class=&quot;language-text&quot;&gt;pacman -S fish&lt;/code&gt;安装的。&lt;/p&gt;
&lt;p&gt;默认的fish已经很强大了:
1. 内建了命令行语法高亮功能。输入不同的命令会用不同的颜色来显示。
2. 要查找一个命令的历史记录不要用ctrl-R来找，直接输入这个命令的开头几个字母fish会自动用阴影
显示上一次执行的这条命令，然后按下ctrl-E或者是右方向键就能全部补齐了，这个功能对于很长的命令
来说真是太赞了，而且感觉比bash的ctrl-R强大多了。
3. 自动补全功能非常强大。我在编辑这篇博客的时候不是输入&lt;code class=&quot;language-text&quot;&gt;vim 20140-08-31-use-fish-shell.markdown&lt;/code&gt;来
编辑的，而是直接&lt;code class=&quot;language-text&quot;&gt;vim fish&amp;lt;Tab&amp;gt;&lt;/code&gt;来找到这个文件的，真是强大的功能，这是我目前发现的唯一支持任意
位置补齐的shell，就算是也很不错的zsh也只支持从头补齐。
4. 自动命令行纠错。比如说你要执行&lt;code class=&quot;language-text&quot;&gt;cd ~/Documents&lt;/code&gt;但是输成了&lt;code class=&quot;language-text&quot;&gt;cd ~/documents&lt;/code&gt;也没有关系，直接就自动
纠错了。有了它真是方便。&lt;/p&gt;
&lt;p&gt;虽然默认的fish很不错，但是我还是从github上clone了&lt;a href=&quot;https://github.com/bpinto/oh-my-fish&quot;&gt;oh-my-fish&lt;/a&gt;这个项目,
这个项目和&lt;a href=&quot;https://github.com/robbyrussell/oh-my-zsh&quot;&gt;oh-my-zsh&lt;/a&gt;的结构很像，里面的配置都很有用，而且有多种
主题，当对目前这个主题审美疲劳了，换一个主题还是很不错的。使用oh-my-fish来作为fish的配置也很简单，按照github
上面的操作一步一步做就是了。&lt;/p&gt;
&lt;p&gt;接下来就是根据自己的喜好自定义fish的theme了，要加载哪个theme只要改&lt;code class=&quot;language-text&quot;&gt;~/.config/fish/config.fish&lt;/code&gt;就ok，找到
&lt;code class=&quot;language-text&quot;&gt;set fish_theme&lt;/code&gt;这一行，填入你要的theme就行了，我用的是&lt;code class=&quot;language-text&quot;&gt;set fish_theme zish&lt;/code&gt;，这个主题挺漂亮的。&lt;/p&gt;
&lt;p&gt;然后就是自定义一些别名了，fish没有alias这个命令，但是可以用函数来实现自定义别名。既然使用了oh-my-fish的配置
就得按照它的结构来修改。在&lt;code class=&quot;language-text&quot;&gt;~/.oh-my-fish/functions/&lt;/code&gt;里面放的都是自定义的函数。我先给vi起了个别名vim，因为
有了vim谁还用vi啊。在这个目录下建一个文件vi.fish。
&lt;code&gt;
function vi —description ‘alias of vim’
vim
end
&lt;/code&gt;
保存退出，然后在命令行输入vi，这时候打开的就是vim了，连重新打开一个shell都不用就生效了，真是好快啊。&lt;/p&gt;
&lt;p&gt;接下来就是一些关于fish的shell编程方面的问题了。不过这块没有怎么认真去看。工作中用的都是bash，谁会为了执行
一个脚本而额外安装fish。不过我还是很喜欢fish的语法的，感觉和python和ruby很像，相比之下bash的语法就有点
另类和老古董了。等以后要用到fish script的时候再去认真研究一下fish syntax。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[自定义键盘布局]]></title><description><![CDATA[自定义键盘布局...]]></description><link>https://joeyxf.com/posts/customize-keyboard-layout/</link><guid isPermaLink="false">https://joeyxf.com/posts/customize-keyboard-layout/</guid><pubDate>Mon, 25 Aug 2014 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;星期天膜拜了一位大牛，真是佩服他啊。&lt;/p&gt;
&lt;p&gt;公司的一个统计功能出问题了，一直都没有把它修复，因为是历史遗留问题，找不到根源，所以
后来公司领导决定把原来这个功能的开发者找回来看看到底是出什么问题了。所以星期天我也来
公司看了一下大牛如何解决问题。&lt;/p&gt;
&lt;p&gt;因为数据是前端通过访问一个php的接口写入redis得到的，所以大牛一直在调试redis。读取redis
数据的代码是用python写的。用emacs编辑这个python文件，在旁边开着1个终端使劲调。不得不说
他是我见过的emacs用得最好的一个了，我自己从大二开始接触linux开始就一直在vim和emacs之间
切换着写代码，对emacs也算不陌生，但是我就不能一只手写代码。而且使用emacs对我来说真是煎熬，
因为ctrl键太远了，要用小拇指按住这个键真是太吃力了。不过后来发现他时而使用左半部分手掌
压住ctrl键，时而使用右侧的ctrl键，所以都没有见到他的手大幅度移动但是就按出了很多键。&lt;/p&gt;
&lt;p&gt;emacs是用来编辑查看代码的，要监控程序还得通过终端输入命令行来操作。大牛只登陆了一个终端，
但是确打开了很多个窗口，后来才发现他是用tmux来虚拟化多个窗口的，说道这个又伤心了一下，最初
刚来公司的时候我不会用xshell，所以用的是putty来远程登陆服务器写代码，那时候就曾经接触过
一段时间tmux，因为putty实在是不好新建窗口，太麻烦。如果那时候一直用着tmux到现在我说不定也
很熟练了，不过后来办公彻底有windows转移到linux之后就更没有去接触tmux了，因为在linux终端
新建一个连接更容易，ctrl+shift+t就行了。不得不说tmux真是个好东西，省去了多次登陆的麻烦，
虚拟多个窗口，可以按照你想要的方式排列窗口，对于监控某个程序来说真是再合适不过了，下面的
窗口运行程序，上面的窗口输出运行结果。&lt;/p&gt;
&lt;p&gt;还发现一个很好用的工具，watch，这个命令是用来监控某个命令的输出的，如果某个程序持续输出
了内容，拿它来监控再合适不过了，不然就得反复输命令查看结果了。&lt;/p&gt;
&lt;p&gt;被感染了，我也要学习使用emacs，也要学习使用tmux和各种命令行，不能止步于已经掌握的内容，今晚
折腾了一下emacs，改了一个键盘映射，把恼人的ctrl键和caplock键换了个位置。因为我现在用的系统
是archlinux+gnome3.12，所以直接调用一个系统设置改的，找到tweak tool然后在typing里面选择
swap ctrl and caplock,然后就ok了，新的键盘不是很习惯，慢慢来，现在ctrl靠近键盘中间了以后
使用emacs写代码应该是更方便了吧。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[不用密码ssh登陆服务器]]></title><description><![CDATA[今天又拿到了一台服务器的权限，才来到这个公司没多久现在算一下已经拿到很多机器的权限了，本地测试机有3台，都拥有root权限， 线上服务器有5台...]]></description><link>https://joeyxf.com/posts/ssh-login-without-password/</link><guid isPermaLink="false">https://joeyxf.com/posts/ssh-login-without-password/</guid><pubDate>Thu, 21 Aug 2014 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;今天又拿到了一台服务器的权限，才来到这个公司没多久现在算一下已经拿到很多机器的权限了，本地测试机有3台，都拥有root权限，
线上服务器有5台，有部分root权限。刚开始用xshell登陆服务器还没什么觉得不方便的，但是现在我已经完全使用linux办公了，所以
只能用terminal来ssh连接服务器。手动输入密码太麻烦了，而且还是经常性的输密码。&lt;/p&gt;
&lt;p&gt;今天又花了点时间看了一下公钥加密的过程这块，了解了一个ssh连接的基本流程。ssh登陆有2种方法：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;基于密码的验证。&lt;/li&gt;
&lt;li&gt;基于公钥私钥的验证。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;基于密码的验证很好理解，当连接服务器的时候会提示你输入密码，等验证通过之后就能连接远程服务器了。这种方法很好理解，但是其实
局限性是很大的，首先麻烦，每次登陆都得输密码，而一个安全的密码又不是那么好记。其次密码被暴露的次数越多就越不安全，万一哪一次
在输入密码的时候被中间人给截获了这个密码，那么就没有丝毫秘密可言了。&lt;/p&gt;
&lt;p&gt;而基于公钥私钥的验证相比起来就安全多了，在服务器中保存一份你自己的公钥，服务器就会知道你是授权了的用户，客户端连接服务器的时候
会检查这个用户的公钥是否在授权了的公钥列表中，如果在的话就放行，允许登陆。登陆之后加密的方法就很简单了，服务器用客户端的公钥加密信息
后传给客户端，客户端收到这个加密的信息之后用自己的私钥解密。然后客户端给服务器发送信息，用服务器的公钥加密，服务器收到之后拿自己的
私钥解密。&lt;/p&gt;
&lt;p&gt;所以总的来说ssh连接就是2步，一步是验证身份，剩下的就是交换公钥的加密数据传输。&lt;/p&gt;
&lt;p&gt;因为我现在都是使用运维给我分配的帐号密码来登陆服务器，每次连接都得输入密码很不方便，所以我还是改为通过公钥来验证身份好了。&lt;/p&gt;
&lt;p&gt;首先给自己生成一个公钥私钥对，使用&lt;code class=&quot;language-text&quot;&gt;ssh-keygen&lt;/code&gt;生成公钥和私钥对，一般的命名规则是id&lt;em&gt;rsa和id&lt;/em&gt;rsa.pub， 默认使用的加密方法是rsa，
默认使用2048字节的私钥。然后就是把自己的公钥添加到服务器上，保存在&lt;code class=&quot;language-text&quot;&gt;~/.ssh/authorized_keys&lt;/code&gt;里面。具体实现方法有很多，可以直接复制粘贴进去，
可以把公钥文件传到服务器上，也可以用一个简单的命令&lt;code class=&quot;language-text&quot;&gt;ssh-copy-id&lt;/code&gt;,这样就可以绕过手动输入密码了。&lt;/p&gt;
&lt;p&gt;真是搞不懂，运维们有这么好的方法不用为什么要给一个账户创建密码呢，直接向我要一个公钥，然后加到服务器就行了嘛。&lt;/p&gt;
&lt;p&gt;今天发现一个很好用的手机ssh客户端叫作juice ssh，拿它可以用手机来连接ssh服务器。不过这个app应该是记住密码的形式来完成连接的，因为没有在服务器上的&lt;code class=&quot;language-text&quot;&gt;.ssh/authorized_keys&lt;/code&gt;里面找到我的手机的公钥。而且连接公司服务器需要vpn，还得在手机上设置vpn连接，只能在wifi环境下才能连接vpn，如果开数据连接的话就连不上了。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[freebsd基本操作]]></title><description><![CDATA[上周买了一年的vps，一直没怎么折腾，今天环境稍微配置了一下，其实基本的软件安装都是 很简单的，每个成熟的系统都有它自己的包管理器...]]></description><link>https://joeyxf.com/posts/freebsd-basic-operations/</link><guid isPermaLink="false">https://joeyxf.com/posts/freebsd-basic-operations/</guid><pubDate>Sat, 16 Aug 2014 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;上周买了一年的vps，一直没怎么折腾，今天环境稍微配置了一下，其实基本的软件安装都是
很简单的，每个成熟的系统都有它自己的包管理器。我用类unix系统也不久，接触过的包管理
方式有debian/ubuntu系的dpkg和apt-get, opensuse的zypper, redhat的yum和arch的pacman
和freebsd的pkg，这这些发行版中我对于debian和arch还是比较熟悉的，freebsd也玩过但是
不是很熟悉它的命令行。&lt;/p&gt;
&lt;p&gt;因为被公司的一台freebsd主机给震惊了，持续服务超过900天了，所以我买了vps之后没有
多想就安装了一个freebsd10的系统，因为这台机器硬件配置还是比较低的，只有768M的
内存。&lt;/p&gt;
&lt;p&gt;首先安装nginx服务器，我还是比较习惯二进制安装，要我在服务器上编译nginx的源码
我才没有那个闲功夫呢。
&lt;code class=&quot;language-text&quot;&gt;pkg install nginx&lt;/code&gt;
这样就把nginx安装上了，如果要启动nginx得执行
&lt;code class=&quot;language-text&quot;&gt;sudo /usr/local/etc/rc.d/nginx start&lt;/code&gt;
因为我还没有想好在服务器上放什么，所以还没有具体配置nginx和fastcgi应用。&lt;/p&gt;
&lt;p&gt;然后安装mariadb,这个没办法了必须得从源码安装，而且还没有办法安装mariadb10,只能
从源码编译5.5的版本。
&lt;code class=&quot;language-text&quot;&gt;cd /usr/ports/databases/mariadb55-server&lt;/code&gt;
&lt;code class=&quot;language-text&quot;&gt;sudo make install clean&lt;/code&gt;
编译的过程要很久，真怕生成一大堆临时文件让我可怜的15G固态硬盘受不了。漫长的等待时间过去
了，终于编译完了。默认的mariadb没有设置root的密码，为了明确权限肯定得设置密码。
&lt;code class=&quot;language-text&quot;&gt;mysql -u root&lt;/code&gt; 连接上数据库服务器之后就开始设置权限了，&lt;code class=&quot;language-text&quot;&gt;set password for ‘root’@’localhost’ = password(‘yourpasswd’)&lt;/code&gt;
这样就设置好了root的密码。&lt;/p&gt;
&lt;p&gt;然后就是给root设置访问的权限了，&lt;code class=&quot;language-text&quot;&gt;grant all privileges on *.* to ‘root’@’localhost’ with grant option&lt;/code&gt;
这条命令是给root用户通过本地访问所有数据库的所有表的权限，如果我想要远程连接数据库稍微修改一下这条命令
就ok了。&lt;code class=&quot;language-text&quot;&gt;grant all privileges on *.* to ‘root’@’%’ with grant option&lt;/code&gt;，在mysql中&lt;code class=&quot;language-text&quot;&gt;%&lt;/code&gt;代表匹配任意字符串，所以
这条命令表示允许root通过任何ip来连接数据库。&lt;/p&gt;
&lt;p&gt;本来还打算配置一下php的环境的，但是就我这几个月php开发的经历来看，这门语言实在是不值得花太多精力去学，
消耗巨大的内存，语言设计简陋，前后端分隔明显。我打算在服务器上搭建RoR的环境。&lt;/p&gt;
&lt;p&gt;然后就是分配用户了，我新建了一个公共帐号public，操作也很简单&lt;code class=&quot;language-text&quot;&gt;adduser&lt;/code&gt;然后按照提示一步一步安装就好了，到了
最后还得考虑给这个用户分配权限的问题，我是通过sudo来管理root权限的，但是暂时没打算给这个公共号分配root权限。
后面还涉及到用户资源限制的问题，比如带宽资源，硬盘资源，cpu时间资源和内存资源，这些都是很专业的系统管理员
知识了，暂时没那个精力去学习。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[第一次使用octopress体验]]></title><description><![CDATA[这几天突然发现php功能很弱，而python又总是拿来写脚本，没有真正用来开发过什么大型的项目。 为了早日实现全栈工程师的梦想，打算开始学习ruby...]]></description><link>https://joeyxf.com/posts/first-eye-on-octopress/</link><guid isPermaLink="false">https://joeyxf.com/posts/first-eye-on-octopress/</guid><pubDate>Mon, 11 Aug 2014 00:00:00 GMT</pubDate><content:encoded>&lt;h3 id=&quot;第一次使用octopress体验&quot;&gt;&lt;a href=&quot;#%E7%AC%AC%E4%B8%80%E6%AC%A1%E4%BD%BF%E7%94%A8octopress%E4%BD%93%E9%AA%8C&quot; aria-label=&quot;第一次使用octopress体验 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;第一次使用octopress体验&lt;/h3&gt;
&lt;p&gt;这几天突然发现php功能很弱，而python又总是拿来写脚本，没有真正用来开发过什么大型的项目。
为了早日实现全栈工程师的梦想，打算开始学习ruby。&lt;/p&gt;
&lt;p&gt;在网上搜了一下ruby开始学习的方法，下载了几本电子书看，然后又发现了octopress这个开源项目，
我一直坚信学习不能单纯看书，所以很不错，看到了这个博客平台，以前在ghost blog上面用过一点
markdown，但是后来vps到期之后就没有继续写markdown了，现在很不熟练。&lt;/p&gt;
&lt;p&gt;当初用ghost blog的时候是不太懂前端的东西，但是现在已经和html，js，css打了一个多月交道，
还算熟悉，以后肯定得自己动手改改theme，加点widget等。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;http://ruby-doc.org/docs/&quot;&gt;ruby programming&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[CSDN老博文迁移-scanf使用的一个小陷阱]]></title><description><![CDATA[今天在写一个排序的小程序的时候偶然发现scanf使用的一个小小的陷阱...]]></description><link>https://joeyxf.com/posts/scanf-trick-in-c/</link><guid isPermaLink="false">https://joeyxf.com/posts/scanf-trick-in-c/</guid><pubDate>Tue, 02 Jul 2013 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;原文链接见：&lt;a href=&quot;http://blog.csdn.net/zazzle/article/details/9226767&quot;&gt;http://blog.csdn.net/zazzle/article/details/9226767&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;今天在写一个排序的小程序的时候偶然发现scanf使用的一个小小的陷阱，如果没有见过的话很难发现的。
比如说scanf(“%d”, &amp;#x26;A) 和 scanf(“%d ”, &amp;#x26;A)这2个语句有区别吗？不仔细看是看不出区别的，前者%d后面紧跟这的是引号，后者%d后面加了一个空格然后再是引号。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* test1.c */&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;lt;stdio.h&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; N 5&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;N&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; N&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;scanf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%d&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; N&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%d &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a4e258d7b6e08e83a788ce74f79d173f/e8ce4/20130702173950171-scanf-1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 271px;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 35.79335793357934%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABQ0lEQVQY0z3O60rkMBTA8Xk6RQVFZqaX3HNykqZt0vTiTN0VdJRlYfEx9kVNQYQ/4Xz55ZzdWz+N9yUqXw5P2ngaXbUAmYzCRmuvwSvbiM7y3hGtiUIhHdcNZcAF7tbzbHmlWluOkQxWecc7SyPmj7Lc0h62WkqBMRDS5gjVGx4uz4dkaLIsAo9481HXEZF33/KnfBQDyr9xVcsNzy8raZTMh3VWNvbqz7FKGqUHcKCdhgZUC9Kj6HhlspcCczVRG35aX5nuFSaAXkNEPmkTFQaFg7ApD7y3LFiy4GEQVBqGPVGuLHnev0vnvwf96+hfC7fuw+n2+aUya41z4X7v/aW052Lm92/05rO8/tgfDTyE5S6komCUm93nsr4XZAyjOV/Ev/bxv5jcKaQpxmmI+Z1jWHKpO7U2eT+Ebmz9YF1ou/ELnRWlz+OWiNgAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;./20130702173950171-scanf-1.png&quot;
        title=&quot;&quot;
        src=&quot;/static/a4e258d7b6e08e83a788ce74f79d173f/e8ce4/20130702173950171-scanf-1.png&quot;
        srcset=&quot;/static/a4e258d7b6e08e83a788ce74f79d173f/0783d/20130702173950171-scanf-1.png 240w,
/static/a4e258d7b6e08e83a788ce74f79d173f/e8ce4/20130702173950171-scanf-1.png 271w&quot;
        sizes=&quot;(max-width: 271px) 100vw, 271px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这个程序的目的是从屏幕输入5个数字，并打印出来，这个程序运行的结果很正常，但是如果换第二种情况&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;/* test2.c */&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;lt;stdio.h&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; N 5&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;N&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; N&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;scanf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%d &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;A&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; N&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%d &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; A&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/48d9ce93f122f969b8ae38eae8ad638d/3e8ea/20130702174050671-scanf-2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 265px;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 41.88679245283019%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAABOElEQVQY03WRTU8CMRCG95d540T8IrJL2207/dppi4TFSEDZRVRCPOjR/2tZdUNMTN7DHOaZZzKTrdqV1FQEN17ESW1KtMK7cuakQQCUUPUpuSEUhHQpXBjKVLZsW4JmBNUFU2PBCiomBZBcMqZAe3WSxPdwGkSZzpbbRnAHMggeFHgjghIoVQUK1f8w5515cXhg1qjKS0Sw/uYeilobGf6Qyvg0kbBTc1p7tymi4tOKzo2M1eCQn7fM8SmYZP6VK69VAIGU9LA+wut1K4TRJmgISgV97A4dFsF0sV46lBUytBOe4Er25rvt+2XYT+ILwTXxj3nYE2y6usnjLvevtDajJzH8oIPP8XVNcz8frppcI6OQvcX589kglu5quZH2lvvIZihtSLYf+bcZURiXzDz9THsmbDreF6eTuj+C8QBMAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;./20130702174050671-scanf-2.png&quot;
        title=&quot;&quot;
        src=&quot;/static/48d9ce93f122f969b8ae38eae8ad638d/3e8ea/20130702174050671-scanf-2.png&quot;
        srcset=&quot;/static/48d9ce93f122f969b8ae38eae8ad638d/0783d/20130702174050671-scanf-2.png 240w,
/static/48d9ce93f122f969b8ae38eae8ad638d/3e8ea/20130702174050671-scanf-2.png 265w&quot;
        sizes=&quot;(max-width: 265px) 100vw, 265px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;就是多了一个空格但是却要输入6个数字才能打印前5个数字出来，真是奇怪啊。
上网搜了一下发现&lt;a href=&quot;https://stackoverflow.com/questions/12704907/explain-what-is-difference-between-without-whitespace-in-scanf-and-with-whitespa&quot;&gt;https://stackoverflow.com/questions/12704907/explain-what-is-difference-between-without-whitespace-in-scanf-and-with-whitespa&lt;/a&gt; 有人问同样的问题，
里面的答案说是scanf函数中前面用引号引起来的字符串是匹配字符串，里面一个空格可以匹配多个空格，tab, 回车，所以在第二种情况下输完5的时候输入回车想结束对整个数组的输入，但是C编译器却觉得你的输入还没有结束，所以会继续等待输入，这时候如果加入一个Ctrl-D就行了，在linux中这个是文件终止符。
看到这里发现输入和输出里面也有这么多技巧，我们从屏幕输入时编译器会把输入的一切东西当作一个字符串存起来，然后和匹配字符串匹配，匹配完了的才能保存到变量中，
这里面的匹配算法可以深入研究一下。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[CSDN老博文迁移-用lzw算法编码一个字符串]]></title><description><![CDATA[利用LZW算法给一个字符串编码...]]></description><link>https://joeyxf.com/posts/lzw-encoding-in-c/</link><guid isPermaLink="false">https://joeyxf.com/posts/lzw-encoding-in-c/</guid><pubDate>Sat, 15 Jun 2013 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;原文链接见：&lt;a href=&quot;http://blog.csdn.net/zazzle/article/details/9103885&quot;&gt;http://blog.csdn.net/zazzle/article/details/9103885&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;实验目的：
(1).利用LZW算法给一个字符串编码&lt;/p&gt;
&lt;p&gt;实验原理：
(1).构造一个4096个元素的字典数组，前256个初始化为ASCII字符集，即表示单个字符。
(2).逐个读入测试字符串中的字符。
(3).判断这个字符是否在字典中
(4).由于先初始化了前256个元素，所以单个字符肯定是在字典中的。
(5).读入下一个字符，添加到前一个字符后面，判断字符串在不在字典中，如果在不做什么，否则更新字典，从256开始更新。&lt;/p&gt;
&lt;p&gt;实验步骤：
(1).初始化字典。
(2).读入字符串并更新字典。
(3).打印出对字符串的编码。&lt;/p&gt;
&lt;p&gt;具体实现代码：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;  &lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;lt;stdio.h&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;lt;string.h&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; STR_LEN 100&lt;/span&gt;
  &lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; DIC_LEN 4096&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;dict&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; str&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;STR_LEN&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; index&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; Dict&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;DIC_LEN&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;in_dict&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;dict&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Dict&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/* 判断一个字符串s是否在字典中 */&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;index_of&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;dict&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Dict&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;/* 通过字符串在字典中查找编号 */&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;insert_into_dict&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;dict&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Dict&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;/*把字符串添加到字典中 */&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;dict&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Dict&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/* 初始化字典 */&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; code&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;/* 输出编码与相应的字符串 */&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; code&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; ch&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;str &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;hellohellohello&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; old_string&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;STR_LEN&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; new_string&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;STR_LEN&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    old_string&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; str&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    old_string&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;\0&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token function&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Dict&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; str&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;\0&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      ch &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; str&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;strcpy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;new_string&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; old_string&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;strncat&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;new_string&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;ch&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;in_dict&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;new_string&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Dict&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;strcpy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;old_string&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; new_string&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token comment&quot;&gt;/* 更新旧字符串 */&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        code &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;index_of&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;old_string&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Dict&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/* 找到编码 */&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;code&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; old_string&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/* 输出编码 */&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;insert_into_dict&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;new_string&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Dict&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;/* 更新字典 */&lt;/span&gt;
        j&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        old_string&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; ch&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        old_string&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;\0&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    code &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;index_of&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;old_string&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Dict&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;code&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; old_string&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;in_dict&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;dict&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Dict&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; DIC_LEN&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;strcmp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Dict&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;str&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;index_of&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;dict&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Dict&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; DIC_LEN&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;strcmp&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; Dict&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;str&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; Dict&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;index&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;insert_into_dict&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;dict&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Dict&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    Dict&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;index &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; j&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;strcpy&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;Dict&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;str&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;init&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;struct&lt;/span&gt; &lt;span class=&quot;token class-name&quot;&gt;dict&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;Dict&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; j&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; DIC_LEN&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;j &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; j &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; STR_LEN&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; j&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        Dict&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;str&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;j&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;\0&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      Dict&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;index &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;256&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      Dict&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;str&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;output&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; code&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%d (%s)\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; code&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; s&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;测试字符串是“hellohellohello”
运行结果：
104(h)
101(e)
108(l)
108(l)
111(o)
256(he)
258(ll)
260(oh)
257(el)&lt;/p&gt;
&lt;p&gt;用这种方法也能实现文本压缩，只要把字典输出到文件中，再把上述对文本的编码也附加到压缩文件中，解压的时候把编码从字典中对比就能实现解压了。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[CSDN老博文迁移-用python做一个简易的图形界面]]></title><description><![CDATA[这里使用Tkinter库，还有很多别的图形库，但是我觉得Tkinter比较简单，我才学几天，但是就有点入门了，一些基本的思想，基本函数的意思也大致弄清了，所以Tkinter还是比较简单易用的...]]></description><link>https://joeyxf.com/posts/python-tkinter-simple-gui/</link><guid isPermaLink="false">https://joeyxf.com/posts/python-tkinter-simple-gui/</guid><pubDate>Fri, 31 May 2013 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;原文链接见：&lt;a href=&quot;http://blog.csdn.net/zazzle/article/details/8998612&quot;&gt;http://blog.csdn.net/zazzle/article/details/8998612&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;这里使用Tkinter库，还有很多别的图形库，但是我觉得Tkinter比较简单，我才学几天，但是就有点入门了，一些基本的思想，基本函数的意思也大致弄清了，所以Tkinter还是比较简单易用的。&lt;/p&gt;
&lt;p&gt;别的不多说，先上代码：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;  &lt;span class=&quot;token comment&quot;&gt;#!/usr/bin/python&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;#-*- coding:utf-8 –*-&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; Tkinter &lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;
  win &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Tk&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;#win.title(&apos;google search engine optimal&apos;)&lt;/span&gt;
  win&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;title&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;一个测试程序&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;token comment&quot;&gt;# the top level of the window&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;report&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;text&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token comment&quot;&gt;#print(v.get())&lt;/span&gt;
      entry2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Label&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; text &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; v&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
      entry2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;grid&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;row &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; column &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  root &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Frame&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;win&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  root&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pack&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  label1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Label&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; text &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;d 取值手动滑动条&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; width &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  label1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pack&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;side &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; LEFT&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  label1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;grid&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;row &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; column &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  v &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; StringVar&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  scl &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Scale&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; from_ &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; to &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; tickinterval &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; resolution &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0.01&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; orient &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;horizontal&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; variable&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;v&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; sliderlength&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; width &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;40&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; length &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;200&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; command&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;report&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  scl&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;grid&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;row &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; column &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;scl&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;get&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  label2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Label&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; text &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;d当前取值:&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; height &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  label2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;grid&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;row &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; column &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;


  label3 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Label&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;root&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; text &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;PR=d*GPR+10*(1-d)*FPR ：d越大则排序考虑人气越多。&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; height &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  label3&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;grid&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;row &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
  root&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mainloop&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;效果如下：&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/106d1a03a3f32c32d38011d138c1a216/e30d5/20130531113037092-python-tkinter-1.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 536px;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 78.35820895522389%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAABMElEQVQoz41SW26EMAzk/rdh4atNQVDEewPhtSSEu3SIdyWWJmpHwhg7YzuDvXFZld63TW3v4Jx/fLL0O4UvpVRK7S9seh/WTUwPbxgG5FaDh8GyLLAmKInWtA37Yi1eTVPXNez9zuF44zgiDSZ1S5IkTVNYlKCiiAshfN+/GYRhePMPBEHwJEsDHKW2sKvpS2S0iuO4FwKtGWNd16FNFEVvZBeOy5gqOIm6JMo4TVcyolrrSzllQA6y5KDKldz3PZSY59k6DiboeEdknLneGdfLsgy/4DeZuuGAnUxj40+6VDiPbSGvL7jEo5STLP+BJxkPJjkvJs12jjjJeZ5D3qqqWgM4ELwoirIsYSnlJCNHG4MdBA0+HLO9BxBHxb/Hxrd1bJLXTrau51lwq4RE/gEfzSB/ILhTRAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;./20130531113037092-python-tkinter-1.png&quot;
        title=&quot;&quot;
        src=&quot;/static/106d1a03a3f32c32d38011d138c1a216/e30d5/20130531113037092-python-tkinter-1.png&quot;
        srcset=&quot;/static/106d1a03a3f32c32d38011d138c1a216/0783d/20130531113037092-python-tkinter-1.png 240w,
/static/106d1a03a3f32c32d38011d138c1a216/782f4/20130531113037092-python-tkinter-1.png 480w,
/static/106d1a03a3f32c32d38011d138c1a216/e30d5/20130531113037092-python-tkinter-1.png 536w&quot;
        sizes=&quot;(max-width: 536px) 100vw, 536px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;说说我的看法吧，
用Tkinter画图首先要创建一个根挂件，可以用Tk()产生
然后要产生不同类型的小挂件，有标签Label，按钮Button，接口Entry 之类的，具体的查看网上的详细文档。
比如说用widget = Label(None, text = ‘hello’)产生了一个内容为hello的标签之后还要确定把这个标签放在哪个位置，所以就要用到pack()
pack有很多选项，比如说要不要随着屏幕缩放expand，要不要填充fill，还可以设置位置anchor。
pack完了之后要维持这个窗口的运行，root.mainloop()或者是widget.mainloop()都行。&lt;/p&gt;
&lt;p&gt;这样产生的窗口只能有一个挂件，如果要把多个挂件放在一个窗口就要用到容器Frame()
win = Frame(root) 产生一个叫作win的容器，下面要产生的挂件都是放在这个容器里面的。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;language-python&quot;&gt;&lt;code class=&quot;language-python&quot;&gt;widget1 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Label&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;win&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; text &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;widget1&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
widget1&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pack&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;side &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; TOP&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
widget2 &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; Button&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;win&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; text &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos;button&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
widget2&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;pack&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;side &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; TOP&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;就能产生类似下图的效果：&lt;/p&gt;
&lt;p&gt;&lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4ef24e11f2b09867e0346a78dbff1986/04655/20130531112728114-python-tkinter-2.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
    &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 431px;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 42.45939675174014%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAIAAAB2/0i6AAAACXBIWXMAAAsSAAALEgHS3X78AAAAcElEQVQY08WPQQ6AIAwE+f+XUPGsRkhsgRbwLaJe1KDGk3Nqup00K1yYPcdwJqU09MOodYyRmY8RcRiBOgNmQuFLEBFalFKqtrXWXlLeyHtBJfasrmTTKEQs3tzKGedc1gAgD5/l/f9a8oYX+Zlf5QUIlZTUzw0FmQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;&lt;/span&gt;
    &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;&quot;
        alt=&quot;./20130531112728114-python-tkinter-2.png&quot;
        title=&quot;&quot;
        src=&quot;/static/4ef24e11f2b09867e0346a78dbff1986/04655/20130531112728114-python-tkinter-2.png&quot;
        srcset=&quot;/static/4ef24e11f2b09867e0346a78dbff1986/0783d/20130531112728114-python-tkinter-2.png 240w,
/static/4ef24e11f2b09867e0346a78dbff1986/04655/20130531112728114-python-tkinter-2.png 431w&quot;
        sizes=&quot;(max-width: 431px) 100vw, 431px&quot;
      /&gt;
  &lt;/span&gt;
  &lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[CSDN老博文迁移-牛顿插值法的C语言实现]]></title><description><![CDATA[老师让我们写一个牛顿插值公式的程序，要满足如下要求...]]></description><link>https://joeyxf.com/posts/newton-interplotation-in-c/</link><guid isPermaLink="false">https://joeyxf.com/posts/newton-interplotation-in-c/</guid><pubDate>Tue, 30 Apr 2013 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;原文链接见：&lt;a href=&quot;http://blog.csdn.net/zazzle/article/details/8870810&quot;&gt;http://blog.csdn.net/zazzle/article/details/8870810&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;  &lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;lt;stdio.h&gt;&lt;/span&gt;&lt;/span&gt;

  &lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; N 100&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;diff_quot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;y&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; start&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; end&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;compute_y&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;y&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;t&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; len&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; xx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; x&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;N&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;N&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;N&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; xx&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; yy&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; mul &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; j&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; start&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; len&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; ch&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;char&lt;/span&gt; chh&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    len &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;//len 保存了数组x和y的长度&lt;/span&gt;
    start &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;//start是每一次循环之后添加元素的起始位置&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;输入要添加的点数: &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;scanf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%d&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;n&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      len &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

      &lt;span class=&quot;token comment&quot;&gt;//输入数组x和y&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;输入x: &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; start&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; start &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;scanf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%lf&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;输入y: &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; start&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; start &lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;scanf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%lf&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;y&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      start &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;//不断跟新start的位置&lt;/span&gt;

      &lt;span class=&quot;token comment&quot;&gt;//开始求各阶差商了&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; len&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        t&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;diff_quot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token comment&quot;&gt;//打印各阶差商&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; len&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%12.5lf &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

      &lt;span class=&quot;token comment&quot;&gt;//计算插入点的函数值&lt;/span&gt;
    again&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;输入要计算的x值: &quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;scanf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%lf&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;xx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

      yy &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;compute_y&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; len&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; xx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;\nxx对应的值是 %lf: \n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; yy&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

      &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;继续求值吗1继续2停止？\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;scanf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%d&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;ch&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ch &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;goto&lt;/span&gt; again&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

      &lt;span class=&quot;token comment&quot;&gt;//小技巧来了，输入一个数字来判断是否继续输入&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;继续添加点吗? 1 for yes and 2 for no\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token function&quot;&gt;scanf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%d&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;ch&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ch &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;continue&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;ch &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;system&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;pause&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;diff_quot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;y&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; start&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; end&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;start &lt;span class=&quot;token operator&quot;&gt;==&lt;/span&gt; end&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;start&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;diff_quot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; start&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; end&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;diff_quot&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; y&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; start&lt;span class=&quot;token operator&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; end&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;/&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;start&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; x&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;end&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;compute_y&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;x&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;y&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;t&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; len&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; xx&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; ret &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;double&lt;/span&gt; mul &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; len&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      mul &lt;span class=&quot;token operator&quot;&gt;*=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;xx &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; x&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      ret &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; t&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt; mul&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; ret&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;《数值逼近》老师让我们写一个牛顿插值公式的程序，要满足如下要求：1. 输入一串点，能输出它们的各阶差商。2. 输入一个x值，通过插值函数能计算出它对应的y值。3.提示是否要继续加点，因为牛顿插值比起拉格朗日插值的最大优点就是新增加点不需要重新计算前面点的差商。4. 添加点之后继续回到第二步，重复。对程序要求的分析：1.有2个子函数要写，一个是求差商的，暂且叫作diff&lt;em&gt;quot吧，另一个是计算函数值的，把它叫作compute&lt;/em&gt;y吧。2.之后还有一个小技巧要实现，就是实现一些交互功能，能判断是否要继续输入，继续输入之后还要继续计算。这里可以使用while(1) 结合break&amp;#x26; continue来实现。
diff_quot这个函数是用来求牛顿插值的插值多项式系数的，用的是递归的方法实现，也可以用循环迭代来实现，但是这样就要写更多代码了，递归的话8行搞定。简洁又明了。
如果要迭代的话就要不断更新牛顿差商表，不断更新那个下三角矩阵。&lt;/p&gt;
&lt;p&gt;compute_y是用来求已知插值多项式系数的情况下给定一个x的y值的函数，比较简单，就是简单的累加累乘。
博客难写啊，连个代码怎么放上去都不熟悉，郁闷。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[CSDN老博文迁移-棋盘中走n步的所有可能走法]]></title><description><![CDATA[棋盘中走n步的所有可能走法...]]></description><link>https://joeyxf.com/posts/possible-steps-in-a-chessboard/</link><guid isPermaLink="false">https://joeyxf.com/posts/possible-steps-in-a-chessboard/</guid><pubDate>Fri, 19 Apr 2013 00:00:00 GMT</pubDate><content:encoded>&lt;p&gt;原文链接见：&lt;a href=&quot;http://blog.csdn.net/zazzle/article/details/8825150&quot;&gt;http://blog.csdn.net/zazzle/article/details/8825150&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;问题，求下列递推式值：
= 3&lt;em&gt;-2&lt;/em&gt;+2,
a1=3,a2=7,a3=17,a4=41, 求&lt;/p&gt;
&lt;p&gt;来源：
a1 = 3, a2 = 7, a3 = 17, a4 = 41, a5 =99&lt;/p&gt;
&lt;p&gt;b1 = 1, b2 = 2, b3 = 5, b4 = 12, b5 =29&lt;/p&gt;
&lt;p&gt;更深的来源：走棋盘问题，一个无限大的棋盘上有人在走路，可以往3个方向走，上，左，右。
向前走之后原来那个格子就不能走了，问如果走n步有几种可能的走法。&lt;/p&gt;
&lt;p&gt;我的思路是按照排列组合的方法来数情况，如果可能就列出递归式来。
第一步如果是上，第二步有3种走法。
第一步如果是左或者右，第二步有2种走法。
…&lt;/p&gt;
&lt;p&gt;到最后肯定能列举出走n步的可能数，但是不可能单纯的数数，可以利用数列的思想来做。
设走n步有an种可能，an由3部分组成，b1,n b2,n b3,n
an = b1,n + b2,n + b3,n ，其中b2,n= b3,n&lt;/p&gt;
&lt;p&gt;这样下去就能得到递归式了。&lt;/p&gt;
&lt;p&gt;其中是an的前n-3项和，到此递归式出来了，可以编程求解了。&lt;/p&gt;
&lt;p&gt;因为a1= 3, a2 = 7, a3 = 17, a4 = 41, a5 = 99 …&lt;/p&gt;
&lt;p&gt;下面开始写程序：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;c&quot;&gt;&lt;pre class=&quot;language-c&quot;&gt;&lt;code class=&quot;language-c&quot;&gt;  &lt;span class=&quot;token comment&quot;&gt;/*
   * count the probable outcome for nstep in a matrix
   * algorithms: an = 3*a(n-1)-2*S(n-3)-4
   * a1 = 3, a2 = 7, a3 = 17,a4 = 41, a5 = 99
   */&lt;/span&gt;
  &lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&amp;lt;stdio.h&gt;&lt;/span&gt;&lt;/span&gt;
  &lt;span class=&quot;token macro property&quot;&gt;#&lt;span class=&quot;token directive keyword&quot;&gt;define&lt;/span&gt; MAX 100&lt;/span&gt;

  &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token keyword&quot;&gt;void&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;MAX&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;17&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;41&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;99&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; S&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;int&lt;/span&gt; i&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;input the steps n:&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;scanf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;%d&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;&amp;amp;&lt;/span&gt;n&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    S &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;token keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;i &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i &lt;span class=&quot;token operator&quot;&gt;&amp;lt;&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; i&lt;span class=&quot;token operator&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      S &lt;span class=&quot;token operator&quot;&gt;+=&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
      a&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;a&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;*&lt;/span&gt;S &lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token function&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&quot;n = %d, methods =%lld\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; n&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; a&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;i&lt;span class=&quot;token operator&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;结果：n= 5, 99 methods
n = 6, 239 methods&lt;/p&gt;
&lt;p&gt;算小数据还可以，就是说n&amp;#x3C; 40以下可以算，超过40连longlong int都溢出，日子真是没法过了，增长的怎么会这么快啊。
大数据运算真是重头戏啊。&lt;/p&gt;</content:encoded></item></channel></rss>